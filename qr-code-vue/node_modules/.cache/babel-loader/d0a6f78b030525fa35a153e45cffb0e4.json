{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\mp\\components\\wx-msg\\main.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\mp\\components\\wx-msg\\main.vue","mtime":1704630438008},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\babel.config.js","mtime":1704630437199},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCJDOi9Vc2Vycy84OTQyNS9JZGVhUHJvamVjdHMvcXItY29kZS12dWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvaW50ZXJvcFJlcXVpcmVEZWZhdWx0LmpzIikuZGVmYXVsdDsKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7CnZhciBfdG9Db25zdW1hYmxlQXJyYXkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJDOi9Vc2Vycy84OTQyNS9JZGVhUHJvamVjdHMvcXItY29kZS12dWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdG9Db25zdW1hYmxlQXJyYXkuanMiKSk7CnZhciBfb2JqZWN0U3ByZWFkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiQzovVXNlcnMvODk0MjUvSWRlYVByb2plY3RzL3FyLWNvZGUtdnVlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL29iamVjdFNwcmVhZDIuanMiKSk7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyIpOwp2YXIgX21lc3NhZ2UgPSByZXF1aXJlKCJAL2FwaS9tcC9tZXNzYWdlIik7CnZhciBfbWFpbiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiQC92aWV3cy9tcC9jb21wb25lbnRzL3d4LXJlcGx5L21haW4udnVlIikpOwp2YXIgX21haW4yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJAL3ZpZXdzL21wL2NvbXBvbmVudHMvd3gtdmlkZW8tcGxheS9tYWluLnZ1ZSIpKTsKdmFyIF9tYWluMyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiQC92aWV3cy9tcC9jb21wb25lbnRzL3d4LXZvaWNlLXBsYXkvbWFpbi52dWUiKSk7CnZhciBfbWFpbjQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIkAvdmlld3MvbXAvY29tcG9uZW50cy93eC1uZXdzL21haW4udnVlIikpOwp2YXIgX21haW41ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJAL3ZpZXdzL21wL2NvbXBvbmVudHMvd3gtbG9jYXRpb24vbWFpbi52dWUiKSk7CnZhciBfbWFpbjYgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIkAvdmlld3MvbXAvY29tcG9uZW50cy93eC1tdXNpYy9tYWluLnZ1ZSIpKTsKdmFyIF9tcHVzZXIgPSByZXF1aXJlKCJAL2FwaS9tcC9tcHVzZXIiKTsKdmFyIF9kZWZhdWx0ID0gZXhwb3J0cy5kZWZhdWx0ID0gewogIG5hbWU6ICJ3eE1zZyIsCiAgY29tcG9uZW50czogewogICAgV3hSZXBseVNlbGVjdDogX21haW4uZGVmYXVsdCwKICAgIFd4VmlkZW9QbGF5ZXI6IF9tYWluMi5kZWZhdWx0LAogICAgV3hWb2ljZVBsYXllcjogX21haW4zLmRlZmF1bHQsCiAgICBXeE5ld3M6IF9tYWluNC5kZWZhdWx0LAogICAgV3hMb2NhdGlvbjogX21haW41LmRlZmF1bHQsCiAgICBXeE11c2ljOiBfbWFpbjYuZGVmYXVsdAogIH0sCiAgcHJvcHM6IHsKICAgIHVzZXJJZDogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbm93U3RyOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSwKICAgICAgLy8g5b2T5YmN55qE5pe26Ze05oiz77yM55So5LqO5q+P5qyh5raI5oGv5Yqg6L295ZCO77yM5Zue5Yiw5Y6f5L2N572u77yb5YW35L2T6KeBIDppZD0iJ21zZy1kaXYnICsgbm93U3RyIiDlpIQKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIC8vIOa2iOaBr+WIl+ihqOaYr+WQpuato+WcqOWKoOi9veS4rQogICAgICBsb2FkTW9yZTogdHJ1ZSwKICAgICAgLy8g5piv5ZCm5Y+v5Lul5Yqg6L295pu05aSaCiAgICAgIGxpc3Q6IFtdLAogICAgICAvLyDmtojmga/liJfooagKICAgICAgcXVlcnlQYXJhbXM6IHsKICAgICAgICBwYWdlTm86IDEsCiAgICAgICAgLy8g5b2T5YmN6aG15pWwCiAgICAgICAgcGFnZVNpemU6IDE0LAogICAgICAgIC8vIOavj+mhteaYvuekuuWkmuWwkeadoQogICAgICAgIGFjY291bnRJZDogdW5kZWZpbmVkCiAgICAgIH0sCiAgICAgIHVzZXI6IHsKICAgICAgICAvLyDnlLHkuo7lvq7kv6HkuI3lho3mj5DkvpvmmLXnp7DvvIznm7TmjqXkvb/nlKjigJznlKjmiLfigJ3lsZXnpLoKICAgICAgICBuaWNrbmFtZTogJ+eUqOaItycsCiAgICAgICAgYXZhdGFyOiByZXF1aXJlKCJAL2Fzc2V0cy9pbWFnZXMvcHJvZmlsZS5qcGciKSwKICAgICAgICBhY2NvdW50SWQ6IDAgLy8g5YWs5LyX5Y+36LSm5Y+357yW5Y+3CiAgICAgIH0sCiAgICAgIG1wOiB7CiAgICAgICAgbmlja25hbWU6ICflhazkvJflj7cnLAogICAgICAgIGF2YXRhcjogcmVxdWlyZSgiQC9hc3NldHMvaW1hZ2VzL3dlY2hhdC5wbmciKQogICAgICB9LAogICAgICAvLyA9PT09PT09PT0g5raI5oGv5Y+R6YCBID09PT09PT09PQogICAgICBzZW5kTG9hZGluZzogZmFsc2UsCiAgICAgIC8vIOWPkemAgea2iOaBr+aYr+WQpuWKoOi9veS4rQogICAgICBvYmpEYXRhOiB7CiAgICAgICAgLy8g5b6u5L+h5Y+R6YCB5raI5oGvCiAgICAgICAgdHlwZTogJ3RleHQnCiAgICAgIH0KICAgIH07CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKICAgIC8vIOiOt+W+l+eUqOaIt+S/oeaBrwogICAgKDAsIF9tcHVzZXIuZ2V0VXNlcikodGhpcy51c2VySWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgIF90aGlzLnVzZXIubmlja25hbWUgPSByZXNwb25zZS5kYXRhLm5pY2tuYW1lICYmIHJlc3BvbnNlLmRhdGEubmlja25hbWUubGVuZ3RoID4gMCA/IHJlc3BvbnNlLmRhdGEubmlja25hbWUgOiBfdGhpcy51c2VyLm5pY2tuYW1lOwogICAgICBfdGhpcy51c2VyLmF2YXRhciA9IHJlc3BvbnNlLmRhdGEuYXZhdGFyICYmIF90aGlzLnVzZXIuYXZhdGFyLmxlbmd0aCA+IDAgPyByZXNwb25zZS5kYXRhLmF2YXRhciA6IF90aGlzLnVzZXIuYXZhdGFyOwogICAgICBfdGhpcy51c2VyLmFjY291bnRJZCA9IHJlc3BvbnNlLmRhdGEuYWNjb3VudElkOwogICAgICAvLyDorr7nva7lhazkvJflj7fotKblj7fnvJblj7cKICAgICAgX3RoaXMucXVlcnlQYXJhbXMuYWNjb3VudElkID0gcmVzcG9uc2UuZGF0YS5hY2NvdW50SWQ7CiAgICAgIF90aGlzLm9iakRhdGEuYWNjb3VudElkID0gcmVzcG9uc2UuZGF0YS5hY2NvdW50SWQ7CgogICAgICAvLyDliqDovb3mtojmga8KICAgICAgY29uc29sZS5sb2coX3RoaXMucXVlcnlQYXJhbXMpOwogICAgICBfdGhpcy5yZWZyZXNoQ2hhbmdlKCk7CiAgICB9KTsKICB9LAogIG1ldGhvZHM6IHsKICAgIHNlbmRNc2c6IGZ1bmN0aW9uIHNlbmRNc2coKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwogICAgICBpZiAoIXRoaXMub2JqRGF0YSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICAvLyDlhazkvJflj7fpmZDliLbvvJrlrqLmnI3mtojmga/vvIzlhazkvJflj7flj6rlhYHorrjlj5HpgIHkuIDmnaEKICAgICAgaWYgKHRoaXMub2JqRGF0YS50eXBlID09PSAnbmV3cycgJiYgdGhpcy5vYmpEYXRhLmFydGljbGVzLmxlbmd0aCA+IDEpIHsKICAgICAgICB0aGlzLm9iakRhdGEuYXJ0aWNsZXMgPSBbdGhpcy5vYmpEYXRhLmFydGljbGVzWzBdXTsKICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgIHNob3dDbG9zZTogdHJ1ZSwKICAgICAgICAgIG1lc3NhZ2U6ICflm77mlofmtojmga/mnaHmlbDpmZDliLblnKggMSDmnaHku6XlhoXvvIzlt7Lpu5jorqTlj5HpgIHnrKzkuIDmnaEnLAogICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIC8vIOaJp+ihjOWPkemAgQogICAgICB0aGlzLnNlbmRMb2FkaW5nID0gdHJ1ZTsKICAgICAgKDAsIF9tZXNzYWdlLnNlbmRNZXNzYWdlKShPYmplY3QuYXNzaWduKHsKICAgICAgICB1c2VySWQ6IHRoaXMudXNlcklkCiAgICAgIH0sICgwLCBfb2JqZWN0U3ByZWFkMi5kZWZhdWx0KSh7fSwgdGhpcy5vYmpEYXRhKSkpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMyLnNlbmRMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgLy8g5re75Yqg5Yiw5raI5oGv5YiX6KGo77yM5bm25rua5YqoCiAgICAgICAgX3RoaXMyLmxpc3QgPSBbXS5jb25jYXQoKDAsIF90b0NvbnN1bWFibGVBcnJheTIuZGVmYXVsdCkoX3RoaXMyLmxpc3QpLCBbcmVzcG9uc2UuZGF0YV0pOwogICAgICAgIF90aGlzMi5zY3JvbGxUb0JvdHRvbSgpOwogICAgICAgIC8vIOmHjee9riBvYmpEYXRhIOeKtuaAgQogICAgICAgIF90aGlzMi4kcmVmc1sncmVwbHlTZWxlY3QnXS5kZWxldGVPYmooKTsgLy8g6YeN572u77yM6YG/5YWNIHRhYiDnmoTmlbDmja7mnKrmuIXnkIYKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMi5zZW5kTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBsb2FkaW5nTW9yZTogZnVuY3Rpb24gbG9hZGluZ01vcmUoKSB7CiAgICAgIHRoaXMucXVlcnlQYXJhbXMucGFnZU5vKys7CiAgICAgIHRoaXMuZ2V0UGFnZSh0aGlzLnF1ZXJ5UGFyYW1zKTsKICAgIH0sCiAgICBnZXRQYWdlOiBmdW5jdGlvbiBnZXRQYWdlKHBhZ2UsIHBhcmFtcykgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgKDAsIF9tZXNzYWdlLmdldE1lc3NhZ2VQYWdlKShPYmplY3QuYXNzaWduKHsKICAgICAgICBwYWdlTm86IHBhZ2UucGFnZU5vLAogICAgICAgIHBhZ2VTaXplOiBwYWdlLnBhZ2VTaXplLAogICAgICAgIHVzZXJJZDogdGhpcy51c2VySWQsCiAgICAgICAgYWNjb3VudElkOiBwYWdlLmFjY291bnRJZAogICAgICB9LCBwYXJhbXMpKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIC8vIOiuoeeul+W9k+WJjeeahOa7muWKqOmrmOW6pgogICAgICAgIHZhciBtc2dEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbXNnLWRpdicgKyBfdGhpczMubm93U3RyKTsKICAgICAgICB2YXIgc2Nyb2xsSGVpZ2h0ID0gMDsKICAgICAgICBpZiAobXNnRGl2KSB7CiAgICAgICAgICBzY3JvbGxIZWlnaHQgPSBtc2dEaXYuc2Nyb2xsSGVpZ2h0OwogICAgICAgIH0KCiAgICAgICAgLy8g5aSE55CG5pWw5o2uCiAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhLmxpc3QucmV2ZXJzZSgpOwogICAgICAgIF90aGlzMy5saXN0ID0gW10uY29uY2F0KCgwLCBfdG9Db25zdW1hYmxlQXJyYXkyLmRlZmF1bHQpKGRhdGEpLCAoMCwgX3RvQ29uc3VtYWJsZUFycmF5Mi5kZWZhdWx0KShfdGhpczMubGlzdCkpOwogICAgICAgIF90aGlzMy5sb2FkaW5nID0gZmFsc2U7CiAgICAgICAgaWYgKGRhdGEubGVuZ3RoIDwgX3RoaXMzLnF1ZXJ5UGFyYW1zLnBhZ2VTaXplIHx8IGRhdGEubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICBfdGhpczMubG9hZE1vcmUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgX3RoaXMzLnF1ZXJ5UGFyYW1zLnBhZ2VObyA9IHBhZ2UucGFnZU5vOwogICAgICAgIF90aGlzMy5xdWVyeVBhcmFtcy5wYWdlU2l6ZSA9IHBhZ2UucGFnZVNpemU7CgogICAgICAgIC8vIOa7muWKqOWIsOWOn+adpeeahOS9jee9rgogICAgICAgIGlmIChfdGhpczMucXVlcnlQYXJhbXMucGFnZU5vID09PSAxKSB7CiAgICAgICAgICAvLyDlrprkvY3liLDmtojmga/lupXpg6gKICAgICAgICAgIF90aGlzMy5zY3JvbGxUb0JvdHRvbSgpOwogICAgICAgIH0gZWxzZSBpZiAoZGF0YS5sZW5ndGggIT09IDApIHsKICAgICAgICAgIC8vIOWumuS9jea7muWKqOadoQogICAgICAgICAgX3RoaXMzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChzY3JvbGxIZWlnaHQgIT09IDApIHsKICAgICAgICAgICAgICBtc2dEaXYuc2Nyb2xsVG9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21zZy1kaXYnICsgX3RoaXMzLm5vd1N0cikuc2Nyb2xsSGVpZ2h0IC0gc2Nyb2xsSGVpZ2h0IC0gMTAwOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIC8qKg0KICAgICAqIOWIt+aWsOWbnuiwgw0KICAgICAqLwogICAgcmVmcmVzaENoYW5nZTogZnVuY3Rpb24gcmVmcmVzaENoYW5nZSgpIHsKICAgICAgdGhpcy5nZXRQYWdlKHRoaXMucXVlcnlQYXJhbXMpOwogICAgfSwKICAgIC8qKiDlrprkvY3liLDmtojmga/lupXpg6ggKi8KICAgIHNjcm9sbFRvQm90dG9tOiBmdW5jdGlvbiBzY3JvbGxUb0JvdHRvbSgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CiAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21zZy1kaXYnICsgX3RoaXM0Lm5vd1N0cik7CiAgICAgICAgZGl2LnNjcm9sbFRvcCA9IGRpdi5zY3JvbGxIZWlnaHQ7CiAgICAgIH0pOwogICAgfQogIH0KfTs="},{"version":3,"names":["_message","require","_main","_interopRequireDefault","_main2","_main3","_main4","_main5","_main6","_mpuser","_default","exports","default","name","components","WxReplySelect","WxVideoPlayer","WxVoicePlayer","WxNews","WxLocation","WxMusic","props","userId","type","Number","required","data","nowStr","Date","getTime","loading","loadMore","list","queryParams","pageNo","pageSize","accountId","undefined","user","nickname","avatar","mp","sendLoading","objData","created","_this","getUser","then","response","length","console","log","refreshChange","methods","sendMsg","_this2","articles","$message","showClose","message","sendMessage","Object","assign","_objectSpread2","concat","_toConsumableArray2","scrollToBottom","$refs","deleteObj","catch","loadingMore","getPage","page","params","_this3","getMessagePage","msgDiv","document","getElementById","scrollHeight","reverse","$nextTick","scrollTop","_this4","div"],"sources":["src/views/mp/components/wx-msg/main.vue"],"sourcesContent":["<!--\r\n  - Copyright (C) 2018-2019\r\n  - All rights reserved, Designed By www.joolun.com\r\n  芋道源码：\r\n  ① 移除暂时用不到的 websocket\r\n  ② 代码优化，补充注释，提升阅读性\r\n-->\r\n<template>\r\n  <div class=\"msg-main\">\r\n    <div class=\"msg-div\" :id=\"'msg-div' + nowStr\">\r\n      <!-- 加载更多 -->\r\n      <div v-loading=\"loading\"></div>\r\n      <div v-if=\"!loading\">\r\n        <div class=\"el-table__empty-block\" v-if=\"loadMore\" @click=\"loadingMore\"><span class=\"el-table__empty-text\">点击加载更多</span></div>\r\n        <div class=\"el-table__empty-block\" v-if=\"!loadMore\"><span class=\"el-table__empty-text\">没有更多了</span></div>\r\n      </div>\r\n      <!-- 消息列表 -->\r\n      <div class=\"execution\" v-for=\"item in list\" :key='item.id'>\r\n        <div class=\"avue-comment\" :class=\"item.sendFrom === 2 ? 'avue-comment--reverse' : ''\">\r\n          <div class=\"avatar-div\">\r\n            <img :src=\"item.sendFrom === 1 ? user.avatar : mp.avatar\" class=\"avue-comment__avatar\">\r\n            <div class=\"avue-comment__author\">{{item.sendFrom === 1 ? user.nickname : mp.nickname }}</div>\r\n          </div>\r\n          <div class=\"avue-comment__main\">\r\n            <div class=\"avue-comment__header\">\r\n              <div class=\"avue-comment__create_time\">{{ parseTime(item.createTime) }}</div>\r\n            </div>\r\n            <div class=\"avue-comment__body\" :style=\"item.sendFrom === 2 ? 'background: #6BED72;' : ''\">\r\n              <!-- 【事件】区域 -->\r\n              <div v-if=\"item.type === 'event' && item.event === 'subscribe'\">\r\n                <el-tag type=\"success\" size=\"mini\">关注</el-tag>\r\n              </div>\r\n              <div v-else-if=\"item.type === 'event' && item.event === 'unsubscribe'\">\r\n                <el-tag type=\"danger\" size=\"mini\">取消关注</el-tag>\r\n              </div>\r\n              <div v-else-if=\"item.type === 'event' && item.event === 'CLICK'\">\r\n                <el-tag size=\"mini\">点击菜单</el-tag>【{{ item.eventKey }}】\r\n              </div>\r\n              <div v-else-if=\"item.type === 'event' && item.event === 'VIEW'\">\r\n                <el-tag size=\"mini\">点击菜单链接</el-tag>【{{ item.eventKey }}】\r\n              </div>\r\n              <div v-else-if=\"item.type === 'event' && item.event === 'scancode_waitmsg'\">\r\n                <el-tag size=\"mini\">扫码结果</el-tag>【{{ item.eventKey }}】\r\n              </div>\r\n              <div v-else-if=\"item.type === 'event' && item.event === 'scancode_push'\">\r\n                <el-tag size=\"mini\">扫码结果</el-tag>【{{ item.eventKey }}】\r\n              </div>\r\n              <div v-else-if=\"item.type === 'event' && item.event === 'pic_sysphoto'\">\r\n                <el-tag size=\"mini\">系统拍照发图</el-tag>\r\n              </div>\r\n              <div v-else-if=\"item.type === 'event' && item.event === 'pic_photo_or_album'\">\r\n                <el-tag size=\"mini\">拍照或者相册</el-tag>\r\n              </div>\r\n              <div v-else-if=\"item.type === 'event' && item.event === 'pic_weixin'\">\r\n                <el-tag size=\"mini\">微信相册</el-tag>\r\n              </div>\r\n              <div v-else-if=\"item.type === 'event' && item.event === 'location_select'\">\r\n                <el-tag size=\"mini\">选择地理位置</el-tag>\r\n              </div>\r\n              <div v-else-if=\"item.type === 'event'\">\r\n                <el-tag type=\"danger\" size=\"mini\">未知事件类型</el-tag>\r\n              </div>\r\n              <!-- 【消息】区域 -->\r\n              <div v-else-if=\"item.type === 'text'\">{{ item.content }}</div>\r\n              <div v-else-if=\"item.type === 'voice'\">\r\n                <wx-voice-player :url=\"item.mediaUrl\" :content=\"item.recognition\" />\r\n              </div>\r\n              <div v-else-if=\"item.type === 'image'\">\r\n                <a target=\"_blank\" :href=\"item.mediaUrl\">\r\n                  <img :src=\"item.mediaUrl\" style=\"width: 100px\">\r\n                </a>\r\n              </div>\r\n              <div v-else-if=\"item.type === 'video' || item.type === 'shortvideo'\" style=\"text-align: center\">\r\n                <wx-video-player :url=\"item.mediaUrl\" />\r\n              </div>\r\n              <div v-else-if=\"item.type === 'link'\" class=\"avue-card__detail\">\r\n                <el-link type=\"success\" :underline=\"false\" target=\"_blank\" :href=\"item.url\">\r\n                  <div class=\"avue-card__title\"><i class=\"el-icon-link\"></i>{{ item.title }}</div>\r\n                </el-link>\r\n                <div class=\"avue-card__info\" style=\"height: unset\">{{item.description}}</div>\r\n              </div>\r\n              <!-- TODO 芋艿：待完善 -->\r\n              <div v-else-if=\"item.type === 'location'\">\r\n                <wx-location :label=\"item.label\" :location-y=\"item.locationY\" :location-x=\"item.locationX\" />\r\n              </div>\r\n              <div v-else-if=\"item.type === 'news'\" style=\"width: 300px\"> <!-- TODO 芋艿：待测试；详情页也存在类似的情况 -->\r\n                <wx-news :articles=\"item.articles\" />\r\n              </div>\r\n              <div v-else-if=\"item.type === 'music'\">\r\n                <wx-music :title=\"item.title\" :description=\"item.description\" :thumb-media-url=\"item.thumbMediaUrl\"\r\n                  :music-url=\"item.musicUrl\" :hq-music-url=\"item.hqMusicUrl\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"msg-send\" v-loading=\"sendLoading\">\r\n      <wx-reply-select ref=\"replySelect\" :objData=\"objData\" />\r\n      <el-button type=\"success\" size=\"small\" class=\"send-but\" @click=\"sendMsg\">发送(S)</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getMessagePage, sendMessage } from '@/api/mp/message'\r\n  import WxReplySelect from '@/views/mp/components/wx-reply/main.vue'\r\n  import WxVideoPlayer from '@/views/mp/components/wx-video-play/main.vue';\r\n  import WxVoicePlayer from '@/views/mp/components/wx-voice-play/main.vue';\r\n  import WxNews from '@/views/mp/components/wx-news/main.vue';\r\n  import WxLocation from '@/views/mp/components/wx-location/main.vue';\r\n  import WxMusic from '@/views/mp/components/wx-music/main.vue';\r\nimport { getUser } from \"@/api/mp/mpuser\";\r\n\r\nexport default {\r\n  name: \"wxMsg\",\r\n  components: {\r\n    WxReplySelect,\r\n    WxVideoPlayer,\r\n    WxVoicePlayer,\r\n    WxNews,\r\n    WxLocation,\r\n    WxMusic\r\n  },\r\n  props: {\r\n    userId: {\r\n      type: Number,\r\n      required: true\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      nowStr: new Date().getTime(), // 当前的时间戳，用于每次消息加载后，回到原位置；具体见 :id=\"'msg-div' + nowStr\" 处\r\n      loading: false, // 消息列表是否正在加载中\r\n      loadMore: true, // 是否可以加载更多\r\n      list: [], // 消息列表\r\n      queryParams: {\r\n        pageNo: 1, // 当前页数\r\n        pageSize: 14, // 每页显示多少条\r\n        accountId: undefined,\r\n      },\r\n      user: { // 由于微信不再提供昵称，直接使用“用户”展示\r\n        nickname: '用户',\r\n        avatar: require(\"@/assets/images/profile.jpg\"),\r\n        accountId: 0, // 公众号账号编号\r\n      },\r\n      mp: {\r\n        nickname: '公众号',\r\n        avatar: require(\"@/assets/images/wechat.png\"),\r\n      },\r\n\r\n      // ========= 消息发送 =========\r\n      sendLoading: false, // 发送消息是否加载中\r\n      objData: { // 微信发送消息\r\n        type: 'text',\r\n      },\r\n    }\r\n  },\r\n  created() {\r\n    // 获得用户信息\r\n    getUser(this.userId).then(response => {\r\n      this.user.nickname = response.data.nickname && response.data.nickname.length > 0 ?\r\n          response.data.nickname : this.user.nickname;\r\n      this.user.avatar = response.data.avatar && this.user.avatar.length > 0 ?\r\n          response.data.avatar : this.user.avatar;\r\n      this.user.accountId = response.data.accountId;\r\n      // 设置公众号账号编号\r\n      this.queryParams.accountId = response.data.accountId;\r\n      this.objData.accountId = response.data.accountId;\r\n\r\n      // 加载消息\r\n      console.log(this.queryParams)\r\n      this.refreshChange()\r\n    })\r\n  },\r\n  methods:{\r\n    sendMsg(){\r\n      if (!this.objData) {\r\n        return;\r\n      }\r\n      // 公众号限制：客服消息，公众号只允许发送一条\r\n      if (this.objData.type === 'news'\r\n        && this.objData.articles.length > 1) {\r\n        this.objData.articles = [this.objData.articles[0]]\r\n        this.$message({\r\n          showClose: true,\r\n          message: '图文消息条数限制在 1 条以内，已默认发送第一条',\r\n          type: 'success'\r\n        })\r\n      }\r\n\r\n      // 执行发送\r\n      this.sendLoading = true\r\n      sendMessage(Object.assign({\r\n        userId: this.userId\r\n      }, {\r\n        ...this.objData\r\n      })).then(response => {\r\n        this.sendLoading = false\r\n        // 添加到消息列表，并滚动\r\n        this.list = [...this.list , ...[response.data] ]\r\n        this.scrollToBottom()\r\n        // 重置 objData 状态\r\n        this.$refs['replySelect'].deleteObj(); // 重置，避免 tab 的数据未清理\r\n      }).catch(() => {\r\n        this.sendLoading = false\r\n      })\r\n    },\r\n    loadingMore() {\r\n      this.queryParams.pageNo++\r\n      this.getPage(this.queryParams)\r\n    },\r\n    getPage(page, params) {\r\n      this.loading = true\r\n      getMessagePage(Object.assign({\r\n        pageNo: page.pageNo,\r\n        pageSize: page.pageSize,\r\n        userId: this.userId,\r\n        accountId: page.accountId,\r\n      }, params)).then(response => {\r\n        // 计算当前的滚动高度\r\n        const msgDiv = document.getElementById('msg-div' + this.nowStr);\r\n        let scrollHeight = 0\r\n        if(msgDiv){\r\n          scrollHeight = msgDiv.scrollHeight\r\n        }\r\n\r\n        // 处理数据\r\n        const data = response.data.list.reverse();\r\n        this.list = [...data, ...this.list]\r\n        this.loading = false\r\n        if (data.length < this.queryParams.pageSize || data.length === 0){\r\n          this.loadMore = false\r\n        }\r\n        this.queryParams.pageNo = page.pageNo\r\n        this.queryParams.pageSize = page.pageSize\r\n\r\n        // 滚动到原来的位置\r\n        if(this.queryParams.pageNo === 1) { // 定位到消息底部\r\n          this.scrollToBottom()\r\n        } else if (data.length !== 0) { // 定位滚动条\r\n          this.$nextTick(() => {\r\n            if (scrollHeight !== 0){\r\n              msgDiv.scrollTop = document.getElementById('msg-div'+this.nowStr).scrollHeight - scrollHeight - 100\r\n            }\r\n          })\r\n        }\r\n      })\r\n    },\r\n    /**\r\n     * 刷新回调\r\n     */\r\n    refreshChange() {\r\n      this.getPage(this.queryParams)\r\n    },\r\n    /** 定位到消息底部 */\r\n    scrollToBottom: function () {\r\n      this.$nextTick(() => {\r\n        let div = document.getElementById('msg-div' + this.nowStr)\r\n        div.scrollTop = div.scrollHeight\r\n      })\r\n    },\r\n  }\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n/* 因为 joolun 实现依赖 avue 组件，该页面使用了 comment.scss、card.scc  */\r\n@import './comment.scss';\r\n@import './card.scss';\r\n\r\n.msg-main {\r\n  margin-top: -30px;\r\n  padding: 10px;\r\n}\r\n.msg-div {\r\n  height: 50vh;\r\n  overflow: auto;\r\n  background-color: #eaeaea;\r\n  margin-left: 10px;\r\n  margin-right: 10px;\r\n}\r\n.msg-send {\r\n  padding: 10px;\r\n}\r\n.avatar-div {\r\n  text-align: center;\r\n  width: 80px;\r\n}\r\n.send-but {\r\n  float: right;\r\n  margin-top: 8px!important;\r\n}\r\n</style>\r\n\r\n"],"mappings":"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"}]}