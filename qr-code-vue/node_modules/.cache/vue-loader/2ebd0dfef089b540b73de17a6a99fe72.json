{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\pay\\app\\components\\weixinChannelForm.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\pay\\app\\components\\weixinChannelForm.vue","mtime":1704630438041},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgeyBjcmVhdGVDaGFubmVsLCBnZXRDaGFubmVsLCB1cGRhdGVDaGFubmVsIH0gZnJvbSAiQC9hcGkvcGF5L2NoYW5uZWwiOw0KaW1wb3J0IHsgQ29tbW9uU3RhdHVzRW51bSB9IGZyb20gIkAvdXRpbHMvY29uc3RhbnRzIjsNCg0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAid2VpeGluQ2hhbm5lbEZvcm0iLA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBkaWFsb2dWaXNpYmxlOiBmYWxzZSwNCiAgICAgIGZvcm1Mb2FkaW5nOiBmYWxzZSwNCiAgICAgIHRpdGxlOicnLA0KICAgICAgZm9ybURhdGE6IHsNCiAgICAgICAgYXBwSWQ6ICcnLA0KICAgICAgICBjb2RlOiAnJywNCiAgICAgICAgc3RhdHVzOiB1bmRlZmluZWQsDQogICAgICAgIGZlZVJhdGU6IHVuZGVmaW5lZCwNCiAgICAgICAgcmVtYXJrOiAnJywNCiAgICAgICAgY29uZmlnOiB7DQogICAgICAgICAgYXBwSWQ6ICcnLA0KICAgICAgICAgIG1jaElkOiAnJywNCiAgICAgICAgICBhcGlWZXJzaW9uOiAnJywNCiAgICAgICAgICBtY2hLZXk6ICcnLA0KICAgICAgICAgIGtleUNvbnRlbnQ6ICcnLA0KICAgICAgICAgIHByaXZhdGVLZXlDb250ZW50OiAnJywNCiAgICAgICAgICBwcml2YXRlQ2VydENvbnRlbnQ6ICcnLA0KICAgICAgICAgIGFwaVYzS2V5OicnLA0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgcnVsZXM6IHsNCiAgICAgICAgZmVlUmF0ZTogW3sgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fovpPlhaXmuKDpgZPotLnnjocnLCB0cmlnZ2VyOiAnYmx1cicgfV0sDQogICAgICAgIHN0YXR1czogW3sgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfmuKDpgZPnirbmgIHkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnYmx1cid9XSwNCiAgICAgICAgJ2NvbmZpZy5tY2hJZCc6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+35Lyg5YWl5ZWG5oi35Y+3JywgdHJpZ2dlcjogJ2JsdXInfV0sDQogICAgICAgICdjb25maWcuYXBwSWQnOiBbeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+i+k+WFpeWFrOS8l+WPt0FQUElEJywgdHJpZ2dlcjogJ2JsdXInfV0sDQogICAgICAgICdjb25maWcuYXBpVmVyc2lvbic6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAnQVBJ54mI5pys5LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2JsdXInfV0sDQogICAgICAgICdjb25maWcubWNoS2V5JzogW3sgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fovpPlhaXllYbmiLflr4bpkqUnLCB0cmlnZ2VyOiAnYmx1cicgfV0sDQogICAgICAgICdjb25maWcua2V5Q29udGVudCc6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+35LiK5LygIGFwaWNsaWVudF9jZXJ0LnAxMiDor4HkuaYnLCB0cmlnZ2VyOiAnYmx1cicgfV0sDQogICAgICAgICdjb25maWcucHJpdmF0ZUtleUNvbnRlbnQnOiBbeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+S4iuS8oCBhcGljbGllbnRfa2V5LnBlbSDor4HkuaYnLCB0cmlnZ2VyOiAnYmx1cicgfV0sDQogICAgICAgICdjb25maWcucHJpdmF0ZUNlcnRDb250ZW50JzogW3sgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fkuIrkvKAgYXBpY2xpZW50X2NlcnQucGVybeivgSDkuaYnLCB0cmlnZ2VyOiAnYmx1cicgfV0sDQogICAgICAgICdjb25maWcuYXBpVjNLZXknOiBbeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+S4iuS8oCBhcGkgVjMg5a+G6ZKl5YC8JywgdHJpZ2dlcjogJ2JsdXInIH1dLA0KICAgICAgfSwNCiAgICB9DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBvcGVuKGFwcElkLCBjb2RlKSB7DQogICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSB0cnVlOw0KICAgICAgdGhpcy5mb3JtTG9hZGluZyA9IHRydWU7DQogICAgICB0aGlzLnJlc2V0KGFwcElkLCBjb2RlKTsNCiAgICAgIGdldENoYW5uZWwoYXBwSWQsIGNvZGUpLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmlkKSB7DQogICAgICAgICAgdGhpcy5mb3JtRGF0YSA9IHJlc3BvbnNlLmRhdGE7DQogICAgICAgICAgdGhpcy5mb3JtRGF0YS5jb25maWcgPSBKU09OLnBhcnNlKHJlc3BvbnNlLmRhdGEuY29uZmlnKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnRpdGxlID0gIXRoaXMuZm9ybURhdGEuaWQgPyAn5Yib5bu65pSv5LuY5rig6YGTJyA6ICfnvJbovpHmlK/ku5jmuKDpgZMnDQogICAgICB9KS5maW5hbGx5KCgpID0+IHsNCiAgICAgICAgdGhpcy5mb3JtTG9hZGluZyA9IGZhbHNlOw0KICAgICAgfSk7DQogICAgfSwNCiAgICBjbG9zZSgpIHsNCiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IGZhbHNlOw0KICAgICAgdGhpcy5yZXNldCh1bmRlZmluZWQsIHVuZGVmaW5lZCk7DQogICAgfSwNCiAgICBzdWJtaXRGb3JtKCkgew0KICAgICAgdGhpcy4kcmVmc1snZm9ybSddLnZhbGlkYXRlKHZhbGlkID0+IHsNCiAgICAgICAgaWYgKCF2YWxpZCkgew0KICAgICAgICAgIHJldHVybg0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGRhdGEgPSB7IC4uLnRoaXMuZm9ybURhdGEgfTsNCiAgICAgICAgZGF0YS5jb25maWcgPSBKU09OLnN0cmluZ2lmeSh0aGlzLmZvcm1EYXRhLmNvbmZpZyk7DQogICAgICAgIGlmICghZGF0YS5pZCkgew0KICAgICAgICAgIGNyZWF0ZUNoYW5uZWwoZGF0YSkudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgICAgICB0aGlzLiRtb2RhbC5tc2dTdWNjZXNzKCLmlrDlop7miJDlip8iKTsNCiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ3N1Y2Nlc3MnKQ0KICAgICAgICAgICAgdGhpcy5jbG9zZSgpOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHVwZGF0ZUNoYW5uZWwoZGF0YSkudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgICAgICB0aGlzLiRtb2RhbC5tc2dTdWNjZXNzKCLkv67mlLnmiJDlip8iKTsNCiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ3N1Y2Nlc3MnKQ0KICAgICAgICAgICAgdGhpcy5jbG9zZSgpOw0KICAgICAgICAgIH0pDQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0sDQogICAgLyoqIOmHjee9ruihqOWNlSAqLw0KICAgIHJlc2V0KGFwcElkLCBjb2RlKSB7DQogICAgICB0aGlzLmZvcm1EYXRhID0gew0KICAgICAgICBhcHBJZDogYXBwSWQsDQogICAgICAgIGNvZGU6IGNvZGUsDQogICAgICAgIHN0YXR1czogQ29tbW9uU3RhdHVzRW51bS5FTkFCTEUsDQogICAgICAgIGZlZVJhdGU6IHVuZGVmaW5lZCwNCiAgICAgICAgcmVtYXJrOiAnJywNCiAgICAgICAgY29uZmlnOiB7DQogICAgICAgICAgYXBwSWQ6ICcnLA0KICAgICAgICAgIG1jaElkOiAnJywNCiAgICAgICAgICBhcGlWZXJzaW9uOiAnJywNCiAgICAgICAgICBtY2hLZXk6ICcnLA0KICAgICAgICAgIGtleUNvbnRlbnQ6ICcnLA0KICAgICAgICAgIHByaXZhdGVLZXlDb250ZW50OiAnJywNCiAgICAgICAgICBwcml2YXRlQ2VydENvbnRlbnQ6ICcnLA0KICAgICAgICAgIGFwaVYzS2V5OicnLA0KICAgICAgICB9DQogICAgICB9DQogICAgICB0aGlzLnJlc2V0Rm9ybSgnZm9ybScpDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBhcGljbGllbnRfY2VydC5wMTLjgIFhcGljbGllbnRfY2VydC5wZW3jgIFhcGljbGllbnRfa2V5LnBlbSDkuIrkvKDliY3nmoTmoKHpqowNCiAgICAgKi8NCiAgICBmaWxlQmVmb3JlVXBsb2FkKGZpbGUsIGZpbGVBY2NlcHQpIHsNCiAgICAgIGxldCBmb3JtYXQgPSAnLicgKyBmaWxlLm5hbWUuc3BsaXQoIi4iKVsxXTsNCiAgICAgIGlmIChmb3JtYXQgIT09IGZpbGVBY2NlcHQpIHsNCiAgICAgICAgZGVidWdnZXINCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign6K+35LiK5Lyg5oyH5a6a5qC85byPIicgKyBmaWxlQWNjZXB0ICsgJyLmlofku7YnKTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KICAgICAgbGV0IGlzUmlnaHRTaXplID0gZmlsZS5zaXplIC8gMTAyNCAvIDEwMjQgPCAyDQogICAgICBpZiAoIWlzUmlnaHRTaXplKSB7DQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+aWh+S7tuWkp+Wwj+i2hei/hyAyTUInKQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIGlzUmlnaHRTaXplDQogICAgfSwNCiAgICBwMTJGaWxlQmVmb3JlVXBsb2FkKGZpbGUpIHsNCiAgICAgIHRoaXMuZmlsZUJlZm9yZVVwbG9hZChmaWxlLCAnLnAxMicpDQogICAgfSwNCiAgICBwZW1GaWxlQmVmb3JlVXBsb2FkKGZpbGUpIHsNCiAgICAgIHRoaXMuZmlsZUJlZm9yZVVwbG9hZChmaWxlLCAnLnBlbScpDQogICAgfSwNCiAgICAvKioNCiAgICAgKiDor7vlj5YgYXBpY2xpZW50X2tleS5wZW0g5YiwIHByaXZhdGVLZXlDb250ZW50IOWtl+autQ0KICAgICAqLw0KICAgIHByaXZhdGVLZXlDb250ZW50VXBsb2FkKGV2ZW50KSB7DQogICAgICBjb25zdCByZWFkRmlsZSA9IG5ldyBGaWxlUmVhZGVyKCkNCiAgICAgIHJlYWRGaWxlLm9ubG9hZCA9IChlKSA9PiB7DQogICAgICAgIHRoaXMuZm9ybURhdGEuY29uZmlnLnByaXZhdGVLZXlDb250ZW50ID0gZS50YXJnZXQucmVzdWx0DQogICAgICB9DQogICAgICByZWFkRmlsZS5yZWFkQXNUZXh0KGV2ZW50LmZpbGUpOw0KICAgIH0sDQogICAgLyoqDQogICAgICog6K+75Y+WIGFwaWNsaWVudF9jZXJ0LnBlbSDliLAgcHJpdmF0ZUNlcnRDb250ZW50IOWtl+autQ0KICAgICAqLw0KICAgIHByaXZhdGVDZXJ0Q29udGVudFVwbG9hZChldmVudCkgew0KICAgICAgY29uc3QgcmVhZEZpbGUgPSBuZXcgRmlsZVJlYWRlcigpDQogICAgICByZWFkRmlsZS5vbmxvYWQgPSAoZSkgPT4gew0KICAgICAgICB0aGlzLmZvcm1EYXRhLmNvbmZpZy5wcml2YXRlQ2VydENvbnRlbnQgPSBlLnRhcmdldC5yZXN1bHQNCiAgICAgIH0NCiAgICAgIHJlYWRGaWxlLnJlYWRBc1RleHQoZXZlbnQuZmlsZSk7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiDor7vlj5YgYXBpY2xpZW50X2NlcnQucDEyIOWIsCBrZXlDb250ZW50IOWtl+autQ0KICAgICAqLw0KICAgIGtleUNvbnRlbnRVcGxvYWQoZXZlbnQpIHsNCiAgICAgIGNvbnN0IHJlYWRGaWxlID0gbmV3IEZpbGVSZWFkZXIoKQ0KICAgICAgcmVhZEZpbGUub25sb2FkID0gKGUpID0+IHsNCiAgICAgICAgdGhpcy5mb3JtRGF0YS5jb25maWcua2V5Q29udGVudCA9IGUudGFyZ2V0LnJlc3VsdC5zcGxpdCgnLCcpWzFdDQogICAgICB9DQogICAgICByZWFkRmlsZS5yZWFkQXNEYXRhVVJMKGV2ZW50LmZpbGUpOyAvLyDor7vmiJAgYmFzZTY0DQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["weixinChannelForm.vue"],"names":[],"mappings":";AAmGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"weixinChannelForm.vue","sourceRoot":"src/views/pay/app/components","sourcesContent":["<template>\r\n  <div>\r\n    <el-dialog :visible.sync=\"dialogVisible\" :title=\"title\" @close=\"close\" append-to-body width=\"800px\">\r\n      <el-form ref=\"form\" :model=\"formData\" :rules=\"rules\" size=\"medium\" label-width=\"120px\"\r\n               v-loading=\"formLoading\">\r\n        <el-form-item label-width=\"180px\" label=\"渠道费率\" prop=\"feeRate\">\r\n          <el-input v-model=\"formData.feeRate\" placeholder=\"请输入渠道费率\" clearable :style=\"{width: '100%'}\">\r\n            <template slot=\"append\">%</template>\r\n          </el-input>\r\n        </el-form-item>\r\n        <el-form-item label-width=\"180px\" label=\"公众号 APPID\" prop=\"config.appId\">\r\n          <el-input v-model=\"formData.config.appId\" placeholder=\"请输入公众号 APPID\" clearable :style=\"{width: '100%'}\">\r\n          </el-input>\r\n        </el-form-item>\r\n        <el-form-item label-width=\"180px\" label=\"商户号\" prop=\"config.mchId\">\r\n          <el-input v-model=\"formData.config.mchId\" :style=\"{width: '100%'}\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label-width=\"180px\" label=\"渠道状态\" prop=\"status\">\r\n          <el-radio-group v-model=\"formData.status\" size=\"medium\">\r\n            <el-radio v-for=\"dict in this.getDictDatas(DICT_TYPE.COMMON_STATUS)\" :key=\"parseInt(dict.value)\"\r\n                      :label=\"parseInt(dict.value)\">\r\n              {{ dict.label }}\r\n            </el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n        <el-form-item label-width=\"180px\" label=\"API 版本\" prop=\"config.apiVersion\">\r\n          <el-radio-group v-model=\"formData.config.apiVersion\" size=\"medium\">\r\n            <el-radio label=\"v2\">v2</el-radio>\r\n            <el-radio label=\"v3\">v3</el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n        <div v-if=\"formData.config.apiVersion === 'v2'\">\r\n          <el-form-item label-width=\"180px\" label=\"商户密钥\" prop=\"config.mchKey\">\r\n            <el-input v-model=\"formData.config.mchKey\" placeholder=\"请输入商户密钥\" clearable\r\n                      :style=\"{width: '100%'}\" type=\"textarea\" :autosize=\"{minRows: 8, maxRows: 8}\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label-width=\"180px\" label=\"apiclient_cert.p12 证书\" prop=\"config.keyContent\">\r\n            <el-input v-model=\"formData.config.keyContent\" type=\"textarea\"\r\n                      placeholder=\"请上传 apiclient_cert.p12 证书\"\r\n                      readonly :autosize=\"{minRows: 8, maxRows: 8}\" :style=\"{width: '100%'}\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label-width=\"180px\" label=\"\">\r\n            <el-upload :limit=\"1\" accept=\".p12\" action=\"\"\r\n                       :before-upload=\"p12FileBeforeUpload\"\r\n                       :http-request=\"keyContentUpload\">\r\n              <el-button size=\"small\" type=\"primary\" icon=\"el-icon-upload\">点击上传</el-button>\r\n            </el-upload>\r\n          </el-form-item>\r\n        </div>\r\n        <div v-if=\"formData.config.apiVersion === 'v3'\">\r\n          <el-form-item label-width=\"180px\" label=\"API V3 密钥\" prop=\"config.apiV3Key\">\r\n            <el-input v-model=\"formData.config.apiV3Key\" placeholder=\"请输入 API V3 密钥\" clearable\r\n                      :style=\"{width: '100%'}\" type=\"textarea\" :autosize=\"{minRows: 8, maxRows: 8}\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label-width=\"180px\" label=\"apiclient_key.pem 证书\" prop=\"config.privateKeyContent\">\r\n            <el-input v-model=\"formData.config.privateKeyContent\" type=\"textarea\"\r\n                      placeholder=\"请上传 apiclient_key.pem 证书\"\r\n                      readonly :autosize=\"{minRows: 8, maxRows: 8}\" :style=\"{width: '100%'}\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label-width=\"180px\" label=\"\" prop=\"privateKeyContentFile\">\r\n            <el-upload ref=\"privateKeyContentFile\"\r\n                       :limit=\"1\"\r\n                       accept=\".pem\"\r\n                       action=\"\"\r\n                       :before-upload=\"pemFileBeforeUpload\"\r\n                       :http-request=\"privateKeyContentUpload\"\r\n            >\r\n              <el-button size=\"small\" type=\"primary\" icon=\"el-icon-upload\">点击上传</el-button>\r\n            </el-upload>\r\n          </el-form-item>\r\n          <el-form-item label-width=\"180px\" label=\"apiclient_cert.perm证书\" prop=\"config.privateCertContent\">\r\n            <el-input v-model=\"formData.config.privateCertContent\" type=\"textarea\"\r\n                      placeholder=\"请上传apiclient_cert.perm证书\"\r\n                      readonly :autosize=\"{minRows: 8, maxRows: 8}\" :style=\"{width: '100%'}\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label-width=\"180px\" label=\"\" prop=\"privateCertContentFile\">\r\n            <el-upload ref=\"privateCertContentFile\"\r\n                       :limit=\"1\"\r\n                       accept=\".pem\"\r\n                       action=\"\"\r\n                       :before-upload=\"pemFileBeforeUpload\"\r\n                       :http-request=\"privateCertContentUpload\"\r\n            >\r\n              <el-button size=\"small\" type=\"primary\" icon=\"el-icon-upload\">点击上传</el-button>\r\n            </el-upload>\r\n          </el-form-item>\r\n        </div>\r\n        <el-form-item label-width=\"180px\" label=\"备注\" prop=\"remark\">\r\n          <el-input v-model=\"formData.remark\" :style=\"{width: '100%'}\" />\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"close\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"submitForm\">确定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { createChannel, getChannel, updateChannel } from \"@/api/pay/channel\";\r\nimport { CommonStatusEnum } from \"@/utils/constants\";\r\n\r\nexport default {\r\n  name: \"weixinChannelForm\",\r\n  data() {\r\n    return {\r\n      dialogVisible: false,\r\n      formLoading: false,\r\n      title:'',\r\n      formData: {\r\n        appId: '',\r\n        code: '',\r\n        status: undefined,\r\n        feeRate: undefined,\r\n        remark: '',\r\n        config: {\r\n          appId: '',\r\n          mchId: '',\r\n          apiVersion: '',\r\n          mchKey: '',\r\n          keyContent: '',\r\n          privateKeyContent: '',\r\n          privateCertContent: '',\r\n          apiV3Key:'',\r\n        }\r\n      },\r\n      rules: {\r\n        feeRate: [{ required: true, message: '请输入渠道费率', trigger: 'blur' }],\r\n        status: [{ required: true, message: '渠道状态不能为空', trigger: 'blur'}],\r\n        'config.mchId': [{ required: true, message: '请传入商户号', trigger: 'blur'}],\r\n        'config.appId': [{ required: true, message: '请输入公众号APPID', trigger: 'blur'}],\r\n        'config.apiVersion': [{ required: true, message: 'API版本不能为空', trigger: 'blur'}],\r\n        'config.mchKey': [{ required: true, message: '请输入商户密钥', trigger: 'blur' }],\r\n        'config.keyContent': [{ required: true, message: '请上传 apiclient_cert.p12 证书', trigger: 'blur' }],\r\n        'config.privateKeyContent': [{ required: true, message: '请上传 apiclient_key.pem 证书', trigger: 'blur' }],\r\n        'config.privateCertContent': [{ required: true, message: '请上传 apiclient_cert.perm证 书', trigger: 'blur' }],\r\n        'config.apiV3Key': [{ required: true, message: '请上传 api V3 密钥值', trigger: 'blur' }],\r\n      },\r\n    }\r\n  },\r\n  methods: {\r\n    open(appId, code) {\r\n      this.dialogVisible = true;\r\n      this.formLoading = true;\r\n      this.reset(appId, code);\r\n      getChannel(appId, code).then(response => {\r\n        if (response.data && response.data.id) {\r\n          this.formData = response.data;\r\n          this.formData.config = JSON.parse(response.data.config);\r\n        }\r\n        this.title = !this.formData.id ? '创建支付渠道' : '编辑支付渠道'\r\n      }).finally(() => {\r\n        this.formLoading = false;\r\n      });\r\n    },\r\n    close() {\r\n      this.dialogVisible = false;\r\n      this.reset(undefined, undefined);\r\n    },\r\n    submitForm() {\r\n      this.$refs['form'].validate(valid => {\r\n        if (!valid) {\r\n          return\r\n        }\r\n        const data = { ...this.formData };\r\n        data.config = JSON.stringify(this.formData.config);\r\n        if (!data.id) {\r\n          createChannel(data).then(response => {\r\n            this.$modal.msgSuccess(\"新增成功\");\r\n            this.$emit('success')\r\n            this.close();\r\n          });\r\n        } else {\r\n          updateChannel(data).then(response => {\r\n            this.$modal.msgSuccess(\"修改成功\");\r\n            this.$emit('success')\r\n            this.close();\r\n          })\r\n        }\r\n      });\r\n    },\r\n    /** 重置表单 */\r\n    reset(appId, code) {\r\n      this.formData = {\r\n        appId: appId,\r\n        code: code,\r\n        status: CommonStatusEnum.ENABLE,\r\n        feeRate: undefined,\r\n        remark: '',\r\n        config: {\r\n          appId: '',\r\n          mchId: '',\r\n          apiVersion: '',\r\n          mchKey: '',\r\n          keyContent: '',\r\n          privateKeyContent: '',\r\n          privateCertContent: '',\r\n          apiV3Key:'',\r\n        }\r\n      }\r\n      this.resetForm('form')\r\n    },\r\n    /**\r\n     * apiclient_cert.p12、apiclient_cert.pem、apiclient_key.pem 上传前的校验\r\n     */\r\n    fileBeforeUpload(file, fileAccept) {\r\n      let format = '.' + file.name.split(\".\")[1];\r\n      if (format !== fileAccept) {\r\n        debugger\r\n        this.$message.error('请上传指定格式\"' + fileAccept + '\"文件');\r\n        return false;\r\n      }\r\n      let isRightSize = file.size / 1024 / 1024 < 2\r\n      if (!isRightSize) {\r\n        this.$message.error('文件大小超过 2MB')\r\n      }\r\n      return isRightSize\r\n    },\r\n    p12FileBeforeUpload(file) {\r\n      this.fileBeforeUpload(file, '.p12')\r\n    },\r\n    pemFileBeforeUpload(file) {\r\n      this.fileBeforeUpload(file, '.pem')\r\n    },\r\n    /**\r\n     * 读取 apiclient_key.pem 到 privateKeyContent 字段\r\n     */\r\n    privateKeyContentUpload(event) {\r\n      const readFile = new FileReader()\r\n      readFile.onload = (e) => {\r\n        this.formData.config.privateKeyContent = e.target.result\r\n      }\r\n      readFile.readAsText(event.file);\r\n    },\r\n    /**\r\n     * 读取 apiclient_cert.pem 到 privateCertContent 字段\r\n     */\r\n    privateCertContentUpload(event) {\r\n      const readFile = new FileReader()\r\n      readFile.onload = (e) => {\r\n        this.formData.config.privateCertContent = e.target.result\r\n      }\r\n      readFile.readAsText(event.file);\r\n    },\r\n    /**\r\n     * 读取 apiclient_cert.p12 到 keyContent 字段\r\n     */\r\n    keyContentUpload(event) {\r\n      const readFile = new FileReader()\r\n      readFile.onload = (e) => {\r\n        this.formData.config.keyContent = e.target.result.split(',')[1]\r\n      }\r\n      readFile.readAsDataURL(event.file); // 读成 base64\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}