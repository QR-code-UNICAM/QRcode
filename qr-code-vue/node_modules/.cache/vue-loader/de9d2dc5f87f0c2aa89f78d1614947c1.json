{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\mp\\components\\wx-voice-play\\main.vue?vue&type=style&index=0&id=47f56598&lang=scss&scoped=true","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\mp\\components\\wx-voice-play\\main.vue","mtime":1704630438016},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci53eC12b2ljZS1kaXYgewogIHBhZGRpbmc6IDVweDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZWFlYWVhOwogIGJvcmRlci1yYWRpdXM6IDEwcHg7Cn0KLmFtci1kdXJhdGlvbiB7CiAgZm9udC1zaXplOiAxMXB4OwogIG1hcmdpbi1sZWZ0OiA1cHg7Cn0K"},{"version":3,"sources":["main.vue"],"names":[],"mappings":";AAmGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"main.vue","sourceRoot":"src/views/mp/components/wx-voice-play","sourcesContent":["<!--\r\n  - Copyright (C) 2018-2019\r\n  - All rights reserved, Designed By www.joolun.com\r\n  【微信消息 - 语音】\r\n   芋道源码：\r\n  ① bug 修复：\r\n    1）joolun 的做法：使用 mediaId 从微信公众号，下载对应的 mp4 素材，从而播放内容；\r\n      存在的问题：mediaId 有效期是 3 天，超过时间后无法播放\r\n    2）重构后的做法：后端接收到微信公众号的视频消息后，将视频消息的 media_id 的文件内容保存到文件服务器中，这样前端可以直接使用 URL 播放。\r\n  ② 代码优化：将 props 中的 objData 调成为 data 中对应的属性，并补充相关注释\r\n-->\r\n<template>\r\n  <div class=\"wx-voice-div\" @click=\"playVoice\">\r\n    <i :class=\"playing !== true ? 'el-icon-video-play': 'el-icon-video-pause'\">\r\n      <span class=\"amr-duration\" v-if=\"duration\">{{ duration }} 秒</span>\r\n    </i>\r\n    <div v-if=\"content\">\r\n      <el-tag type=\"success\" size=\"mini\">语音识别</el-tag>\r\n      {{ content }}\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// 因为微信语音是 amr 格式，所以需要用到 amr 解码器：https://www.npmjs.com/package/benz-amr-recorder\r\nconst BenzAMRRecorder = require('benz-amr-recorder')\r\n\r\nexport default {\r\n  name: \"wxVoicePlayer\",\r\n  props: {\r\n    url: { // 语音地址，例如说：https://www.iocoder.cn/xxx.amr\r\n      type: String,\r\n      required: true\r\n    },\r\n    content: { // 语音文本\r\n      type: String,\r\n      required: false\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      amr: undefined, // BenzAMRRecorder 对象\r\n      playing: false, // 是否在播放中\r\n      duration: undefined, // 播放时长\r\n    }\r\n  },\r\n  methods:{\r\n    playVoice() {\r\n      debugger\r\n      // 情况一：未初始化，则创建 BenzAMRRecorder\r\n      if (this.amr === undefined){\r\n        this.amrInit();\r\n        return;\r\n      }\r\n\r\n      if (this.amr.isPlaying()) {\r\n        this.amrStop();\r\n      } else {\r\n        this.amrPlay();\r\n      }\r\n    },\r\n    amrInit() {\r\n      const amr = new BenzAMRRecorder();\r\n      this.amr = amr;\r\n      // 设置播放\r\n      const that = this\r\n      amr.initWithUrl(this.url).then(function() {\r\n        that.amrPlay()\r\n        that.duration = amr.getDuration();\r\n      })\r\n      // 监听暂停\r\n      amr.onEnded(function() {\r\n        that.playing = false;\r\n      })\r\n    },\r\n    amrPlay() {\r\n      this.playing = true;\r\n      this.amr.play()\r\n    },\r\n    amrStop() {\r\n      this.playing = false;\r\n      this.amr.stop()\r\n    },\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n  .wx-voice-div {\r\n    padding: 5px;\r\n    background-color: #eaeaea;\r\n    border-radius: 10px;\r\n  }\r\n  .amr-duration {\r\n    font-size: 11px;\r\n    margin-left: 5px;\r\n  }\r\n</style>\r\n"]}]}