{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\bpm\\processInstance\\create.vue?vue&type=style&index=0&id=64c5a191&lang=scss","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\bpm\\processInstance\\create.vue","mtime":1704630437845},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoubXktcHJvY2Vzcy1kZXNpZ25lciB7DQogIGhlaWdodDogY2FsYygxMDB2aCAtIDIwMHB4KTsNCn0NCg0KLmJveC1jYXJkIHsNCiAgd2lkdGg6IDEwMCU7DQogIG1hcmdpbi1ib3R0b206IDIwcHg7DQp9DQo="},{"version":3,"sources":["create.vue"],"names":[],"mappings":";AA+JA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"create.vue","sourceRoot":"src/views/bpm/processInstance","sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <!-- 第一步，通过流程定义的列表，选择对应的流程 -->\r\n    <div v-if=\"!selectProcessInstance\">\r\n      <el-table v-loading=\"loading\" :data=\"list\">\r\n        <el-table-column label=\"流程名称\" align=\"center\" prop=\"name\" width=\"200\">\r\n          <template v-slot=\"scope\">\r\n            <el-button type=\"text\" @click=\"handleBpmnDetail(scope.row)\">\r\n              <span>{{ scope.row.name }}</span>\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"流程分类\" align=\"center\" prop=\"category\" width=\"100\">\r\n          <template v-slot=\"scope\">\r\n            <dict-tag :type=\"DICT_TYPE.BPM_MODEL_CATEGORY\" :value=\"scope.row.category\" />\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"流程版本\" align=\"center\" prop=\"processDefinition.version\" width=\"80\">\r\n          <template v-slot=\"scope\">\r\n            <el-tag size=\"medium\" v-if=\"scope.row\">v{{ scope.row.version }}</el-tag>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"流程描述\" align=\"center\" prop=\"description\" width=\"300\" show-overflow-tooltip />\r\n        <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\">\r\n          <template v-slot=\"scope\">\r\n            <el-button type=\"text\" size=\"small\" icon=\"el-icon-plus\" @click=\"handleSelect(scope.row)\">选择</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </div>\r\n    <!-- 第二步，填写表单，进行流程的提交 -->\r\n    <div v-else>\r\n      <el-card class=\"box-card\" >\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span class=\"el-icon-document\">申请信息【{{ selectProcessInstance.name }}】</span>\r\n          <el-button style=\"float: right;\" type=\"primary\" @click=\"selectProcessInstance = undefined\">选择其它流程</el-button>\r\n        </div>\r\n        <el-col :span=\"16\" :offset=\"6\">\r\n          <div>\r\n            <parser :key=\"new Date().getTime()\" :form-conf=\"detailForm\" @submit=\"submitForm\" />\r\n          </div>\r\n        </el-col>\r\n      </el-card>\r\n      <el-card class=\"box-card\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span class=\"el-icon-picture-outline\">流程图</span>\r\n        </div>\r\n        <my-process-viewer key=\"designer\" v-model=\"bpmnXML\" v-bind=\"bpmnControlForm\" />\r\n      </el-card>\r\n    </div>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {getProcessDefinitionBpmnXML, getProcessDefinitionList} from \"@/api/bpm/definition\";\r\nimport {DICT_TYPE, getDictDatas} from \"@/utils/dict\";\r\nimport {decodeFields} from \"@/utils/formGenerator\";\r\nimport Parser from '@/components/parser/Parser'\r\nimport {createProcessInstance} from \"@/api/bpm/processInstance\";\r\n\r\n// 流程实例的发起\r\nexport default {\r\n  name: \"ProcessInstanceCreate\",\r\n  components: {\r\n    Parser\r\n  },\r\n  data() {\r\n    return {\r\n      // 遮罩层\r\n      loading: true,\r\n      // 表格数据\r\n      list: [],\r\n\r\n      // 流程表单详情\r\n      detailForm: {\r\n        fields: []\r\n      },\r\n\r\n      // BPMN 数据\r\n      bpmnXML: null,\r\n      bpmnControlForm: {\r\n        prefix: \"flowable\"\r\n      },\r\n\r\n      // 流程表单\r\n      selectProcessInstance: undefined, // 选择的流程实例\r\n\r\n      // 数据字典\r\n      categoryDictDatas: getDictDatas(DICT_TYPE.BPM_MODEL_CATEGORY),\r\n    };\r\n  },\r\n  created() {\r\n    this.getList();\r\n  },\r\n  methods: {\r\n    /** 查询流程定义列表 */\r\n    getList() {\r\n      this.loading = true;\r\n      getProcessDefinitionList({\r\n        suspensionState: 1\r\n      }).then(response => {\r\n          this.list = response.data\r\n          this.loading = false\r\n        }\r\n      );\r\n    },\r\n    /** 处理选择流程的按钮操作 **/\r\n    handleSelect(row) {\r\n      // 设置选择的流程\r\n      this.selectProcessInstance = row;\r\n\r\n      // 流程表单\r\n      if (row.formId) {\r\n        // 设置对应的表单\r\n        this.detailForm = {\r\n          ...JSON.parse(row.formConf),\r\n          fields: decodeFields(row.formFields)\r\n        }\r\n\r\n        // 加载流程图\r\n        getProcessDefinitionBpmnXML(row.id).then(response => {\r\n          this.bpmnXML = response.data\r\n        })\r\n      } else if (row.formCustomCreatePath) {\r\n        this.$router.push({ path: row.formCustomCreatePath});\r\n        // 这里暂时无需加载流程图，因为跳出到另外个 Tab；\r\n      }\r\n    },\r\n    /** 提交按钮 */\r\n    submitForm(params) {\r\n      if (!params) {\r\n        return;\r\n      }\r\n      // 设置表单禁用\r\n      const conf = params.conf;\r\n      conf.disabled = true; // 表单禁用\r\n      conf.formBtns = false; // 按钮隐藏\r\n\r\n      // 提交表单，创建流程\r\n      const variables = params.values;\r\n      createProcessInstance({\r\n        processDefinitionId: this.selectProcessInstance.id,\r\n        variables: variables\r\n      }).then(response => {\r\n        this.$modal.msgSuccess(\"发起流程成功\");\r\n        // 关闭当前窗口\r\n        this.$tab.closeOpenPage();\r\n        this.$router.go(-1);\r\n      }).catch(() => {\r\n        conf.disabled = false; // 表单开启\r\n        conf.formBtns = true; // 按钮展示\r\n      })\r\n    },\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.my-process-designer {\r\n  height: calc(100vh - 200px);\r\n}\r\n\r\n.box-card {\r\n  width: 100%;\r\n  margin-bottom: 20px;\r\n}\r\n</style>\r\n"]}]}