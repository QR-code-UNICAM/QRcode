{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\components\\bpmnProcessDesigner\\package\\penal\\properties\\ElementProperties.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\components\\bpmnProcessDesigner\\package\\penal\\properties\\ElementProperties.vue","mtime":1704630437724},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJFbGVtZW50UHJvcGVydGllcyIsDQogIHByb3BzOiB7DQogICAgaWQ6IFN0cmluZywNCiAgICB0eXBlOiBTdHJpbmcNCiAgfSwNCiAgaW5qZWN0OiB7DQogICAgcHJlZml4OiAicHJlZml4IiwNCiAgICB3aWR0aDogIndpZHRoIg0KICB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBlbGVtZW50UHJvcGVydHlMaXN0OiBbXSwNCiAgICAgIHByb3BlcnR5Rm9ybToge30sDQogICAgICBlZGl0aW5nUHJvcGVydHlJbmRleDogLTEsDQogICAgICBwcm9wZXJ0eUZvcm1Nb2RlbFZpc2libGU6IGZhbHNlDQogICAgfTsNCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICBpZDogew0KICAgICAgaW1tZWRpYXRlOiB0cnVlLA0KICAgICAgaGFuZGxlcih2YWwpIHsNCiAgICAgICAgdmFsICYmIHZhbC5sZW5ndGggJiYgdGhpcy5yZXNldEF0dHJpYnV0ZXNMaXN0KCk7DQogICAgICB9DQogICAgfQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgcmVzZXRBdHRyaWJ1dGVzTGlzdCgpIHsNCiAgICAgIHRoaXMuYnBtbkVsZW1lbnQgPSB3aW5kb3cuYnBtbkluc3RhbmNlcy5icG1uRWxlbWVudDsNCiAgICAgIHRoaXMub3RoZXJFeHRlbnNpb25MaXN0ID0gW107IC8vIOWFtuS7luaJqeWxlemFjee9rg0KICAgICAgdGhpcy5icG1uRWxlbWVudFByb3BlcnRpZXMgPQ0KICAgICAgICB0aGlzLmJwbW5FbGVtZW50LmJ1c2luZXNzT2JqZWN0Py5leHRlbnNpb25FbGVtZW50cz8udmFsdWVzPy5maWx0ZXIoZXggPT4gew0KICAgICAgICAgIGlmIChleC4kdHlwZSAhPT0gYCR7dGhpcy5wcmVmaXh9OlByb3BlcnRpZXNgKSB7DQogICAgICAgICAgICB0aGlzLm90aGVyRXh0ZW5zaW9uTGlzdC5wdXNoKGV4KTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIGV4LiR0eXBlID09PSBgJHt0aGlzLnByZWZpeH06UHJvcGVydGllc2A7DQogICAgICAgIH0pID8/IFtdOw0KDQogICAgICAvLyDkv53lrZjmiYDmnInnmoQg5omp5bGV5bGe5oCn5a2X5q61DQogICAgICB0aGlzLmJwbW5FbGVtZW50UHJvcGVydHlMaXN0ID0gdGhpcy5icG1uRWxlbWVudFByb3BlcnRpZXMucmVkdWNlKChwcmUsIGN1cnJlbnQpID0+IHByZS5jb25jYXQoY3VycmVudC52YWx1ZXMpLCBbXSk7DQogICAgICAvLyDlpI3liLYg5pi+56S6DQogICAgICB0aGlzLmVsZW1lbnRQcm9wZXJ0eUxpc3QgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuYnBtbkVsZW1lbnRQcm9wZXJ0eUxpc3QgPz8gW10pKTsNCiAgICB9LA0KICAgIG9wZW5BdHRyaWJ1dGVzRm9ybShhdHRyLCBpbmRleCkgew0KICAgICAgdGhpcy5lZGl0aW5nUHJvcGVydHlJbmRleCA9IGluZGV4Ow0KICAgICAgdGhpcy5wcm9wZXJ0eUZvcm0gPSBpbmRleCA9PT0gLTEgPyB7fSA6IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoYXR0cikpOw0KICAgICAgdGhpcy5wcm9wZXJ0eUZvcm1Nb2RlbFZpc2libGUgPSB0cnVlOw0KICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICBpZiAodGhpcy4kcmVmc1siYXR0cmlidXRlRm9ybVJlZiJdKSB0aGlzLiRyZWZzWyJhdHRyaWJ1dGVGb3JtUmVmIl0uY2xlYXJWYWxpZGF0ZSgpOw0KICAgICAgfSk7DQogICAgfSwNCiAgICByZW1vdmVBdHRyaWJ1dGVzKGF0dHIsIGluZGV4KSB7DQogICAgICB0aGlzLiRjb25maXJtKCLnoa7orqTnp7vpmaTor6XlsZ7mgKflkJfvvJ8iLCAi5o+Q56S6Iiwgew0KICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIuehriDorqQiLA0KICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAi5Y+WIOa2iCINCiAgICAgIH0pDQogICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICB0aGlzLmVsZW1lbnRQcm9wZXJ0eUxpc3Quc3BsaWNlKGluZGV4LCAxKTsNCiAgICAgICAgICB0aGlzLmJwbW5FbGVtZW50UHJvcGVydHlMaXN0LnNwbGljZShpbmRleCwgMSk7DQogICAgICAgICAgLy8g5paw5bu65LiA5Liq5bGe5oCn5a2X5q6155qE5L+d5a2Y5YiX6KGoDQogICAgICAgICAgY29uc3QgcHJvcGVydGllc09iamVjdCA9IHdpbmRvdy5icG1uSW5zdGFuY2VzLm1vZGRsZS5jcmVhdGUoYCR7dGhpcy5wcmVmaXh9OlByb3BlcnRpZXNgLCB7DQogICAgICAgICAgICB2YWx1ZXM6IHRoaXMuYnBtbkVsZW1lbnRQcm9wZXJ0eUxpc3QNCiAgICAgICAgICB9KTsNCiAgICAgICAgICB0aGlzLnVwZGF0ZUVsZW1lbnRFeHRlbnNpb25zKHByb3BlcnRpZXNPYmplY3QpOw0KICAgICAgICAgIHRoaXMucmVzZXRBdHRyaWJ1dGVzTGlzdCgpOw0KICAgICAgICB9KQ0KICAgICAgICAuY2F0Y2goKCkgPT4gY29uc29sZS5pbmZvKCLmk43kvZzlj5bmtogiKSk7DQogICAgfSwNCiAgICBzYXZlQXR0cmlidXRlKCkgew0KICAgICAgY29uc3QgeyBuYW1lLCB2YWx1ZSB9ID0gdGhpcy5wcm9wZXJ0eUZvcm07DQogICAgICBjb25zb2xlLmxvZyh0aGlzLmJwbW5FbGVtZW50UHJvcGVydHlMaXN0KTsNCiAgICAgIGlmICh0aGlzLmVkaXRpbmdQcm9wZXJ0eUluZGV4ICE9PSAtMSkgew0KICAgICAgICB3aW5kb3cuYnBtbkluc3RhbmNlcy5tb2RlbGluZy51cGRhdGVNb2RkbGVQcm9wZXJ0aWVzKHRoaXMuYnBtbkVsZW1lbnQsIHRoaXMuYnBtbkVsZW1lbnRQcm9wZXJ0eUxpc3RbdGhpcy5lZGl0aW5nUHJvcGVydHlJbmRleF0sIHsNCiAgICAgICAgICBuYW1lLA0KICAgICAgICAgIHZhbHVlDQogICAgICAgIH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8g5paw5bu65bGe5oCn5a2X5q61DQogICAgICAgIGNvbnN0IG5ld1Byb3BlcnR5T2JqZWN0ID0gd2luZG93LmJwbW5JbnN0YW5jZXMubW9kZGxlLmNyZWF0ZShgJHt0aGlzLnByZWZpeH06UHJvcGVydHlgLCB7IG5hbWUsIHZhbHVlIH0pOw0KICAgICAgICAvLyDmlrDlu7rkuIDkuKrlsZ7mgKflrZfmrrXnmoTkv53lrZjliJfooagNCiAgICAgICAgY29uc3QgcHJvcGVydGllc09iamVjdCA9IHdpbmRvdy5icG1uSW5zdGFuY2VzLm1vZGRsZS5jcmVhdGUoYCR7dGhpcy5wcmVmaXh9OlByb3BlcnRpZXNgLCB7DQogICAgICAgICAgdmFsdWVzOiB0aGlzLmJwbW5FbGVtZW50UHJvcGVydHlMaXN0LmNvbmNhdChbbmV3UHJvcGVydHlPYmplY3RdKQ0KICAgICAgICB9KTsNCiAgICAgICAgdGhpcy51cGRhdGVFbGVtZW50RXh0ZW5zaW9ucyhwcm9wZXJ0aWVzT2JqZWN0KTsNCiAgICAgIH0NCiAgICAgIHRoaXMucHJvcGVydHlGb3JtTW9kZWxWaXNpYmxlID0gZmFsc2U7DQogICAgICB0aGlzLnJlc2V0QXR0cmlidXRlc0xpc3QoKTsNCiAgICB9LA0KICAgIHVwZGF0ZUVsZW1lbnRFeHRlbnNpb25zKHByb3BlcnRpZXMpIHsNCiAgICAgIGNvbnN0IGV4dGVuc2lvbnMgPSB3aW5kb3cuYnBtbkluc3RhbmNlcy5tb2RkbGUuY3JlYXRlKCJicG1uOkV4dGVuc2lvbkVsZW1lbnRzIiwgew0KICAgICAgICB2YWx1ZXM6IHRoaXMub3RoZXJFeHRlbnNpb25MaXN0LmNvbmNhdChbcHJvcGVydGllc10pDQogICAgICB9KTsNCiAgICAgIHdpbmRvdy5icG1uSW5zdGFuY2VzLm1vZGVsaW5nLnVwZGF0ZVByb3BlcnRpZXModGhpcy5icG1uRWxlbWVudCwgew0KICAgICAgICBleHRlbnNpb25FbGVtZW50czogZXh0ZW5zaW9ucw0KICAgICAgfSk7DQogICAgfQ0KICB9DQp9Ow0K"},{"version":3,"sources":["ElementProperties.vue"],"names":[],"mappings":";AAoCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ElementProperties.vue","sourceRoot":"src/components/bpmnProcessDesigner/package/penal/properties","sourcesContent":["<template>\r\n  <div class=\"panel-tab__content\">\r\n    <el-table :data=\"elementPropertyList\" size=\"mini\" max-height=\"240\" border fit>\r\n      <el-table-column label=\"序号\" width=\"50px\" type=\"index\" />\r\n      <el-table-column label=\"属性名\" prop=\"name\" min-width=\"100px\" show-overflow-tooltip />\r\n      <el-table-column label=\"属性值\" prop=\"value\" min-width=\"100px\" show-overflow-tooltip />\r\n      <el-table-column label=\"操作\" width=\"90px\">\r\n        <template v-slot=\"{ row, $index }\">\r\n          <el-button size=\"mini\" type=\"text\" @click=\"openAttributesForm(row, $index)\">编辑</el-button>\r\n          <el-divider direction=\"vertical\" />\r\n          <el-button size=\"mini\" type=\"text\" style=\"color: #ff4d4f\" @click=\"removeAttributes(row, $index)\">移除</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <div class=\"element-drawer__button\">\r\n      <el-button size=\"mini\" type=\"primary\" icon=\"el-icon-plus\" @click=\"openAttributesForm(null, -1)\">添加属性</el-button>\r\n    </div>\r\n\r\n    <el-dialog :visible.sync=\"propertyFormModelVisible\" title=\"属性配置\" width=\"600px\" append-to-body destroy-on-close>\r\n      <el-form :model=\"propertyForm\" label-width=\"80px\" size=\"mini\" ref=\"attributeFormRef\" @submit.native.prevent>\r\n        <el-form-item label=\"属性名：\" prop=\"name\">\r\n          <el-input v-model=\"propertyForm.name\" clearable />\r\n        </el-form-item>\r\n        <el-form-item label=\"属性值：\" prop=\"value\">\r\n          <el-input v-model=\"propertyForm.value\" clearable />\r\n        </el-form-item>\r\n      </el-form>\r\n      <template slot=\"footer\">\r\n        <el-button size=\"mini\" @click=\"propertyFormModelVisible = false\">取 消</el-button>\r\n        <el-button size=\"mini\" type=\"primary\" @click=\"saveAttribute\">确 定</el-button>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"ElementProperties\",\r\n  props: {\r\n    id: String,\r\n    type: String\r\n  },\r\n  inject: {\r\n    prefix: \"prefix\",\r\n    width: \"width\"\r\n  },\r\n  data() {\r\n    return {\r\n      elementPropertyList: [],\r\n      propertyForm: {},\r\n      editingPropertyIndex: -1,\r\n      propertyFormModelVisible: false\r\n    };\r\n  },\r\n  watch: {\r\n    id: {\r\n      immediate: true,\r\n      handler(val) {\r\n        val && val.length && this.resetAttributesList();\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    resetAttributesList() {\r\n      this.bpmnElement = window.bpmnInstances.bpmnElement;\r\n      this.otherExtensionList = []; // 其他扩展配置\r\n      this.bpmnElementProperties =\r\n        this.bpmnElement.businessObject?.extensionElements?.values?.filter(ex => {\r\n          if (ex.$type !== `${this.prefix}:Properties`) {\r\n            this.otherExtensionList.push(ex);\r\n          }\r\n          return ex.$type === `${this.prefix}:Properties`;\r\n        }) ?? [];\r\n\r\n      // 保存所有的 扩展属性字段\r\n      this.bpmnElementPropertyList = this.bpmnElementProperties.reduce((pre, current) => pre.concat(current.values), []);\r\n      // 复制 显示\r\n      this.elementPropertyList = JSON.parse(JSON.stringify(this.bpmnElementPropertyList ?? []));\r\n    },\r\n    openAttributesForm(attr, index) {\r\n      this.editingPropertyIndex = index;\r\n      this.propertyForm = index === -1 ? {} : JSON.parse(JSON.stringify(attr));\r\n      this.propertyFormModelVisible = true;\r\n      this.$nextTick(() => {\r\n        if (this.$refs[\"attributeFormRef\"]) this.$refs[\"attributeFormRef\"].clearValidate();\r\n      });\r\n    },\r\n    removeAttributes(attr, index) {\r\n      this.$confirm(\"确认移除该属性吗？\", \"提示\", {\r\n        confirmButtonText: \"确 认\",\r\n        cancelButtonText: \"取 消\"\r\n      })\r\n        .then(() => {\r\n          this.elementPropertyList.splice(index, 1);\r\n          this.bpmnElementPropertyList.splice(index, 1);\r\n          // 新建一个属性字段的保存列表\r\n          const propertiesObject = window.bpmnInstances.moddle.create(`${this.prefix}:Properties`, {\r\n            values: this.bpmnElementPropertyList\r\n          });\r\n          this.updateElementExtensions(propertiesObject);\r\n          this.resetAttributesList();\r\n        })\r\n        .catch(() => console.info(\"操作取消\"));\r\n    },\r\n    saveAttribute() {\r\n      const { name, value } = this.propertyForm;\r\n      console.log(this.bpmnElementPropertyList);\r\n      if (this.editingPropertyIndex !== -1) {\r\n        window.bpmnInstances.modeling.updateModdleProperties(this.bpmnElement, this.bpmnElementPropertyList[this.editingPropertyIndex], {\r\n          name,\r\n          value\r\n        });\r\n      } else {\r\n        // 新建属性字段\r\n        const newPropertyObject = window.bpmnInstances.moddle.create(`${this.prefix}:Property`, { name, value });\r\n        // 新建一个属性字段的保存列表\r\n        const propertiesObject = window.bpmnInstances.moddle.create(`${this.prefix}:Properties`, {\r\n          values: this.bpmnElementPropertyList.concat([newPropertyObject])\r\n        });\r\n        this.updateElementExtensions(propertiesObject);\r\n      }\r\n      this.propertyFormModelVisible = false;\r\n      this.resetAttributesList();\r\n    },\r\n    updateElementExtensions(properties) {\r\n      const extensions = window.bpmnInstances.moddle.create(\"bpmn:ExtensionElements\", {\r\n        values: this.otherExtensionList.concat([properties])\r\n      });\r\n      window.bpmnInstances.modeling.updateProperties(this.bpmnElement, {\r\n        extensionElements: extensions\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n"]}]}