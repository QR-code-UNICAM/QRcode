{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\infra\\file\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\infra\\file\\index.vue","mtime":1704630437912},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQge2RlbGV0ZUZpbGUsIGdldEZpbGVQYWdlfSBmcm9tICJAL2FwaS9pbmZyYS9maWxlIjsNCmltcG9ydCB7Z2V0QWNjZXNzVG9rZW59IGZyb20gIkAvdXRpbHMvYXV0aCI7DQppbXBvcnQgSW1hZ2VQcmV2aWV3IGZyb20gIkAvY29tcG9uZW50cy9JbWFnZVByZXZpZXciOw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJJbmZyYUZpbGUiLA0KICBjb21wb25lbnRzOiB7DQogICAgSW1hZ2VQcmV2aWV3DQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGdldEZpbGVVcmw6IHByb2Nlc3MuZW52LlZVRV9BUFBfQkFTRV9BUEkgKyAnL2FkbWluLWFwaS9pbmZyYS9maWxlLycsDQogICAgICAvLyDpga7nvanlsYINCiAgICAgIGxvYWRpbmc6IHRydWUsDQogICAgICAvLyDmmL7npLrmkJzntKLmnaHku7YNCiAgICAgIHNob3dTZWFyY2g6IHRydWUsDQogICAgICAvLyDmgLvmnaHmlbANCiAgICAgIHRvdGFsOiAwLA0KICAgICAgLy8g5paH5Lu25YiX6KGoDQogICAgICBsaXN0OiBbXSwNCiAgICAgIC8vIOW8ueWHuuWxguagh+mimA0KICAgICAgdGl0bGU6ICIiLA0KICAgICAgLy8g5p+l6K+i5Y+C5pWwDQogICAgICBxdWVyeVBhcmFtczogew0KICAgICAgICBwYWdlTm86IDEsDQogICAgICAgIHBhZ2VTaXplOiAxMCwNCiAgICAgICAgcGF0aDogbnVsbCwNCiAgICAgICAgdHlwZTogbnVsbCwNCiAgICAgICAgY3JlYXRlVGltZTogW10NCiAgICAgIH0sDQogICAgICAvLyDnlKjmiLflr7zlhaXlj4LmlbANCiAgICAgIHVwbG9hZDogew0KICAgICAgICBvcGVuOiBmYWxzZSwgLy8g5piv5ZCm5pi+56S65by55Ye65bGCDQogICAgICAgIHRpdGxlOiAiIiwgLy8g5by55Ye65bGC5qCH6aKYDQogICAgICAgIGlzVXBsb2FkaW5nOiBmYWxzZSwgLy8g5piv5ZCm56aB55So5LiK5LygDQogICAgICAgIHVybDogcHJvY2Vzcy5lbnYuVlVFX0FQUF9CQVNFX0FQSSArICIvYWRtaW4tYXBpL2luZnJhL2ZpbGUvdXBsb2FkIiwgLy8g6K+35rGC5Zyw5Z2ADQogICAgICAgIGhlYWRlcnM6IHtBdXRob3JpemF0aW9uOiAiQmVhcmVyICIgKyBnZXRBY2Nlc3NUb2tlbigpfSwgLy8g6K6+572u5LiK5Lyg55qE6K+35rGC5aS06YOoDQogICAgICAgIGRhdGE6IHt9IC8vIOS4iuS8oOeahOmineWkluaVsOaNru+8jOeUqOS6juaWh+S7tuWQjQ0KICAgICAgfSwNCiAgICB9Ow0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuZ2V0TGlzdCgpOw0KICB9LA0KICBtZXRob2RzOiB7DQogICAgLyoqIOafpeivouWIl+ihqCAqLw0KICAgIGdldExpc3QoKSB7DQogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOw0KICAgICAgLy8g5omn6KGM5p+l6K+iDQogICAgICBnZXRGaWxlUGFnZSh0aGlzLnF1ZXJ5UGFyYW1zKS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgdGhpcy5saXN0ID0gcmVzcG9uc2UuZGF0YS5saXN0Ow0KICAgICAgICB0aGlzLnRvdGFsID0gcmVzcG9uc2UuZGF0YS50b3RhbDsNCiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7DQogICAgICB9KTsNCiAgICB9LA0KICAgIC8qKiDlj5bmtojmjInpkq4gKi8NCiAgICBjYW5jZWwoKSB7DQogICAgICB0aGlzLm9wZW4gPSBmYWxzZTsNCiAgICAgIHRoaXMucmVzZXQoKTsNCiAgICB9LA0KICAgIC8qKiDooajljZXph43nva4gKi8NCiAgICByZXNldCgpIHsNCiAgICAgIHRoaXMuZm9ybSA9IHsNCiAgICAgICAgY29udGVudDogdW5kZWZpbmVkLA0KICAgICAgfTsNCiAgICAgIHRoaXMucmVzZXRGb3JtKCJmb3JtIik7DQogICAgfSwNCiAgICAvKiog5pCc57Si5oyJ6ZKu5pON5L2cICovDQogICAgaGFuZGxlUXVlcnkoKSB7DQogICAgICB0aGlzLnF1ZXJ5UGFyYW1zLnBhZ2VObyA9IDE7DQogICAgICB0aGlzLmdldExpc3QoKTsNCiAgICB9LA0KICAgIC8qKiDph43nva7mjInpkq7mk43kvZwgKi8NCiAgICByZXNldFF1ZXJ5KCkgew0KICAgICAgdGhpcy5yZXNldEZvcm0oInF1ZXJ5Rm9ybSIpOw0KICAgICAgdGhpcy5oYW5kbGVRdWVyeSgpOw0KICAgIH0sDQogICAgLyoqIOaWsOWinuaMiemSruaTjeS9nCAqLw0KICAgIGhhbmRsZUFkZCgpIHsNCiAgICAgIHRoaXMudXBsb2FkLm9wZW4gPSB0cnVlOw0KICAgICAgdGhpcy51cGxvYWQudGl0bGUgPSAi5LiK5Lyg5paH5Lu2IjsNCiAgICB9LA0KICAgIC8qKiDlpITnkIbkuIrkvKDnmoTmlofku7blj5HnlJ/lj5jljJYgKi8NCiAgICBoYW5kbGVGaWxlQ2hhbmdlKGZpbGUsIGZpbGVMaXN0KSB7DQoNCiAgICB9LA0KICAgIC8qKiDlpITnkIbmlofku7bkuIrkvKDkuK0gKi8NCiAgICBoYW5kbGVGaWxlVXBsb2FkUHJvZ3Jlc3MoZXZlbnQsIGZpbGUsIGZpbGVMaXN0KSB7DQogICAgICB0aGlzLnVwbG9hZC5pc1VwbG9hZGluZyA9IHRydWU7IC8vIOemgeatouS/ruaUuQ0KICAgIH0sDQogICAgLyoqIOWPkei1t+aWh+S7tuS4iuS8oCAqLw0KICAgIHN1Ym1pdEZpbGVGb3JtKCkgew0KICAgICAgdGhpcy4kcmVmcy51cGxvYWQuc3VibWl0KCk7DQogICAgfSwNCiAgICAvKiog5paH5Lu25LiK5Lyg5oiQ5Yqf5aSE55CGICovDQogICAgaGFuZGxlRmlsZVN1Y2Nlc3MocmVzcG9uc2UsIGZpbGUsIGZpbGVMaXN0KSB7DQogICAgICAvLyDmuIXnkIYNCiAgICAgIHRoaXMudXBsb2FkLm9wZW4gPSBmYWxzZTsNCiAgICAgIHRoaXMudXBsb2FkLmlzVXBsb2FkaW5nID0gZmFsc2U7DQogICAgICB0aGlzLiRyZWZzLnVwbG9hZC5jbGVhckZpbGVzKCk7DQogICAgICAvLyDmj5DnpLrmiJDlip/vvIzlubbliLfmlrANCiAgICAgIHRoaXMuJG1vZGFsLm1zZ1N1Y2Nlc3MoIuS4iuS8oOaIkOWKnyIpOw0KICAgICAgdGhpcy5nZXRMaXN0KCk7DQogICAgfSwNCiAgICAvKiog5Yig6Zmk5oyJ6ZKu5pON5L2cICovDQogICAgaGFuZGxlRGVsZXRlKHJvdykgew0KICAgICAgY29uc3QgaWQgPSByb3cuaWQ7DQogICAgICB0aGlzLiRtb2RhbC5jb25maXJtKCfmmK/lkKbnoa7orqTliKDpmaTmlofku7bnvJblj7fkuLoiJyArIGlkICsgJyLnmoTmlbDmja7pobk/JykudGhlbihmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiBkZWxldGVGaWxlKGlkKTsNCiAgICAgIH0pLnRoZW4oKCkgPT4gew0KICAgICAgICB0aGlzLmdldExpc3QoKTsNCiAgICAgICAgdGhpcy4kbW9kYWwubXNnU3VjY2Vzcygi5Yig6Zmk5oiQ5YqfIik7DQogICAgICB9KS5jYXRjaCgoKSA9PiB7DQogICAgICB9KTsNCiAgICB9LA0KICAgIC8vIOeUqOaIt+aYteensOWxleekug0KICAgIHNpemVGb3JtYXQocm93LCBjb2x1bW4pIHsNCiAgICAgIGNvbnN0IHVuaXRBcnIgPSBbIkJ5dGVzIiwgIktCIiwgIk1CIiwgIkdCIiwgIlRCIiwgIlBCIiwgIkVCIiwgIlpCIiwgIllCIl07DQogICAgICBjb25zdCBzcmNTaXplID0gcGFyc2VGbG9hdChyb3cuc2l6ZSk7DQogICAgICBjb25zdCBpbmRleCA9IE1hdGguZmxvb3IoTWF0aC5sb2coc3JjU2l6ZSkgLyBNYXRoLmxvZygxMDI0KSk7DQogICAgICBsZXQgc2l6ZSA9IHNyY1NpemUgLyBNYXRoLnBvdygxMDI0LCBpbmRleCk7DQogICAgICBzaXplID0gc2l6ZS50b0ZpeGVkKDIpOy8v5L+d55WZ55qE5bCP5pWw5L2N5pWwDQogICAgICByZXR1cm4gc2l6ZSArICcgJyArIHVuaXRBcnJbaW5kZXhdOw0KICAgIH0sDQogIH0NCn07DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAyFA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/infra/file","sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <doc-alert title=\"上传下载\" url=\"https://doc.iocoder.cn/file/\"/>\r\n    <!-- 搜索工作栏 -->\r\n    <el-form :model=\"queryParams\" ref=\"queryForm\" size=\"small\" :inline=\"true\" v-show=\"showSearch\" label-width=\"68px\">\r\n      <el-form-item label=\"文件路径\" prop=\"path\">\r\n        <el-input v-model=\"queryParams.path\" placeholder=\"请输入文件路径\" clearable @keyup.enter.native=\"handleQuery\"/>\r\n      </el-form-item>\r\n      <el-form-item label=\"创建时间\" prop=\"createTime\">\r\n        <el-date-picker v-model=\"queryParams.createTime\" style=\"width: 240px\" value-format=\"yyyy-MM-dd HH:mm:ss\"\r\n                        type=\"daterange\"\r\n                        range-separator=\"-\" start-placeholder=\"开始日期\" end-placeholder=\"结束日期\"\r\n                        :default-time=\"['00:00:00', '23:59:59']\"/>\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" icon=\"el-icon-search\" @click=\"handleQuery\">搜索</el-button>\r\n        <el-button icon=\"el-icon-refresh\" @click=\"resetQuery\">重置</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n\r\n    <!-- 操作工具栏 -->\r\n    <el-row :gutter=\"10\" class=\"mb8\">\r\n      <el-col :span=\"1.5\">\r\n        <el-button type=\"primary\" plain icon=\"el-icon-plus\" size=\"mini\" @click=\"handleAdd\">上传文件</el-button>\r\n      </el-col>\r\n      <right-toolbar :showSearch.sync=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\r\n    </el-row>\r\n\r\n    <!-- 列表 -->\r\n    <el-table v-loading=\"loading\" :data=\"list\">\r\n      <el-table-column label=\"文件名\" :show-overflow-tooltip=\"true\" align=\"center\" min-width=\"200px\" prop=\"name\"/>\r\n      <el-table-column label=\"文件路径\" :show-overflow-tooltip=\"true\" align=\"center\" min-width=\"250px\" prop=\"path\"/>\r\n      <el-table-column label=\"文件 URL\" :show-overflow-tooltip=\"true\" align=\"center\" min-width=\"300px\" prop=\"url\"/>\r\n      <el-table-column label=\"文件大小\" align=\"center\" prop=\"size\" min-width=\"120px\" :formatter=\"sizeFormat\"/>\r\n      <el-table-column label=\"文件类型\" :show-overflow-tooltip=\"true\" align=\"center\" prop=\"type\" width=\"180px\"/>\r\n      <el-table-column label=\"文件内容\" align=\"center\" prop=\"content\" min-width=\"150px\">\r\n        <template v-slot=\"scope\">\r\n          <image-preview v-if=\"scope.row.type&&scope.row.type.indexOf('image/') === 0\" :src=\"scope.row.url\"\r\n                         :width=\"'100px'\"></image-preview>\r\n          <video v-else-if=\"scope.row.type&&scope.row.type.indexOf('video/') === 0\" :width=\"'100px'\">\r\n            <source :src=\"scope.row.url\"/>\r\n          </video>\r\n          <i v-else>无法预览，点击\r\n            <el-link type=\"primary\" :underline=\"false\" style=\"font-size:12px;vertical-align: baseline;\" target=\"_blank\"\r\n                     :href=\"getFileUrl + scope.row.configId + '/get/' + scope.row.path\">下载\r\n            </el-link>\r\n          </i>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"上传时间\" align=\"center\" prop=\"createTime\" min-width=\"170px\">\r\n        <template v-slot=\"scope\">\r\n          <span>{{ parseTime(scope.row.createTime) }}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\" min-width=\"100px\">\r\n        <template v-slot=\"scope\">\r\n          <el-button size=\"mini\" type=\"text\" icon=\"el-icon-delete\" @click=\"handleDelete(scope.row)\"\r\n                     v-hasPermi=\"['infra:file:delete']\">删除\r\n          </el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <!-- 分页组件 -->\r\n    <pagination v-show=\"total > 0\" :total=\"total\" :page.sync=\"queryParams.pageNo\" :limit.sync=\"queryParams.pageSize\"\r\n                @pagination=\"getList\"/>\r\n\r\n    <!-- 对话框(添加 / 修改) -->\r\n    <el-dialog :title=\"upload.title\" :visible.sync=\"upload.open\" width=\"400px\" append-to-body>\r\n      <el-upload ref=\"upload\" :limit=\"1\" accept=\".jpg, .png, .gif\" :auto-upload=\"false\" drag\r\n                 :headers=\"upload.headers\" :action=\"upload.url\" :data=\"upload.data\" :disabled=\"upload.isUploading\"\r\n                 :on-change=\"handleFileChange\"\r\n                 :on-progress=\"handleFileUploadProgress\"\r\n                 :on-success=\"handleFileSuccess\">\r\n        <i class=\"el-icon-upload\"></i>\r\n        <div class=\"el-upload__text\">\r\n          将文件拖到此处，或 <em>点击上传</em>\r\n        </div>\r\n        <div class=\"el-upload__tip\" style=\"color:red\" slot=\"tip\">提示：仅允许导入 jpg、png、gif 格式文件！</div>\r\n      </el-upload>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button type=\"primary\" @click=\"submitFileForm\">确 定</el-button>\r\n        <el-button @click=\"upload.open = false\">取 消</el-button>\r\n      </div>\r\n    </el-dialog>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {deleteFile, getFilePage} from \"@/api/infra/file\";\r\nimport {getAccessToken} from \"@/utils/auth\";\r\nimport ImagePreview from \"@/components/ImagePreview\";\r\n\r\nexport default {\r\n  name: \"InfraFile\",\r\n  components: {\r\n    ImagePreview\r\n  },\r\n  data() {\r\n    return {\r\n      getFileUrl: process.env.VUE_APP_BASE_API + '/admin-api/infra/file/',\r\n      // 遮罩层\r\n      loading: true,\r\n      // 显示搜索条件\r\n      showSearch: true,\r\n      // 总条数\r\n      total: 0,\r\n      // 文件列表\r\n      list: [],\r\n      // 弹出层标题\r\n      title: \"\",\r\n      // 查询参数\r\n      queryParams: {\r\n        pageNo: 1,\r\n        pageSize: 10,\r\n        path: null,\r\n        type: null,\r\n        createTime: []\r\n      },\r\n      // 用户导入参数\r\n      upload: {\r\n        open: false, // 是否显示弹出层\r\n        title: \"\", // 弹出层标题\r\n        isUploading: false, // 是否禁用上传\r\n        url: process.env.VUE_APP_BASE_API + \"/admin-api/infra/file/upload\", // 请求地址\r\n        headers: {Authorization: \"Bearer \" + getAccessToken()}, // 设置上传的请求头部\r\n        data: {} // 上传的额外数据，用于文件名\r\n      },\r\n    };\r\n  },\r\n  created() {\r\n    this.getList();\r\n  },\r\n  methods: {\r\n    /** 查询列表 */\r\n    getList() {\r\n      this.loading = true;\r\n      // 执行查询\r\n      getFilePage(this.queryParams).then(response => {\r\n        this.list = response.data.list;\r\n        this.total = response.data.total;\r\n        this.loading = false;\r\n      });\r\n    },\r\n    /** 取消按钮 */\r\n    cancel() {\r\n      this.open = false;\r\n      this.reset();\r\n    },\r\n    /** 表单重置 */\r\n    reset() {\r\n      this.form = {\r\n        content: undefined,\r\n      };\r\n      this.resetForm(\"form\");\r\n    },\r\n    /** 搜索按钮操作 */\r\n    handleQuery() {\r\n      this.queryParams.pageNo = 1;\r\n      this.getList();\r\n    },\r\n    /** 重置按钮操作 */\r\n    resetQuery() {\r\n      this.resetForm(\"queryForm\");\r\n      this.handleQuery();\r\n    },\r\n    /** 新增按钮操作 */\r\n    handleAdd() {\r\n      this.upload.open = true;\r\n      this.upload.title = \"上传文件\";\r\n    },\r\n    /** 处理上传的文件发生变化 */\r\n    handleFileChange(file, fileList) {\r\n\r\n    },\r\n    /** 处理文件上传中 */\r\n    handleFileUploadProgress(event, file, fileList) {\r\n      this.upload.isUploading = true; // 禁止修改\r\n    },\r\n    /** 发起文件上传 */\r\n    submitFileForm() {\r\n      this.$refs.upload.submit();\r\n    },\r\n    /** 文件上传成功处理 */\r\n    handleFileSuccess(response, file, fileList) {\r\n      // 清理\r\n      this.upload.open = false;\r\n      this.upload.isUploading = false;\r\n      this.$refs.upload.clearFiles();\r\n      // 提示成功，并刷新\r\n      this.$modal.msgSuccess(\"上传成功\");\r\n      this.getList();\r\n    },\r\n    /** 删除按钮操作 */\r\n    handleDelete(row) {\r\n      const id = row.id;\r\n      this.$modal.confirm('是否确认删除文件编号为\"' + id + '\"的数据项?').then(function () {\r\n        return deleteFile(id);\r\n      }).then(() => {\r\n        this.getList();\r\n        this.$modal.msgSuccess(\"删除成功\");\r\n      }).catch(() => {\r\n      });\r\n    },\r\n    // 用户昵称展示\r\n    sizeFormat(row, column) {\r\n      const unitArr = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\", \"EB\", \"ZB\", \"YB\"];\r\n      const srcSize = parseFloat(row.size);\r\n      const index = Math.floor(Math.log(srcSize) / Math.log(1024));\r\n      let size = srcSize / Math.pow(1024, index);\r\n      size = size.toFixed(2);//保留的小数位数\r\n      return size + ' ' + unitArr[index];\r\n    },\r\n  }\r\n};\r\n</script>\r\n"]}]}