{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\infra\\codegen\\editTable.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\infra\\codegen\\editTable.vue","mtime":1704630437877},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQge2dldENvZGVnZW5EZXRhaWwsIHVwZGF0ZUNvZGVnZW59IGZyb20gIkAvYXBpL2luZnJhL2NvZGVnZW4iOw0KaW1wb3J0IHtsaXN0QWxsU2ltcGxlIGFzIGxpc3RBbGxTaW1wbGVEaWN0VHlwZX0gZnJvbSAiQC9hcGkvc3lzdGVtL2RpY3QvdHlwZSI7DQppbXBvcnQge2xpc3RTaW1wbGVNZW51c30gZnJvbSAiQC9hcGkvc3lzdGVtL21lbnUiOw0KaW1wb3J0IGJhc2ljSW5mb0Zvcm0gZnJvbSAiLi9iYXNpY0luZm9Gb3JtIjsNCmltcG9ydCBnZW5JbmZvRm9ybSBmcm9tICIuL2dlbkluZm9Gb3JtIjsNCmltcG9ydCBTb3J0YWJsZSBmcm9tICdzb3J0YWJsZWpzJw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJHZW5FZGl0IiwNCiAgY29tcG9uZW50czogew0KICAgIGJhc2ljSW5mb0Zvcm0sDQogICAgZ2VuSW5mb0Zvcm0NCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgLy8g6YCJ5Lit6YCJ6aG55Y2h55qEIG5hbWUNCiAgICAgIGFjdGl2ZU5hbWU6ICJjbG91bSIsDQogICAgICAvLyDooajmoLznmoTpq5jluqYNCiAgICAgIHRhYmxlSGVpZ2h0OiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0IC0gMjQ1ICsgInB4IiwNCiAgICAgIC8vIOWtl+WFuOS/oeaBrw0KICAgICAgZGljdE9wdGlvbnM6IFtdLA0KICAgICAgZm9ybURhdGE6IHt9LA0KICAgICAgLy8g6I+c5Y2V5L+h5oGvDQogICAgICBtZW51czogW10NCiAgICB9Ow0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIGNvbnN0IHRhYmxlSWQgPSB0aGlzLiRyb3V0ZS5wYXJhbXMgJiYgdGhpcy4kcm91dGUucGFyYW1zLnRhYmxlSWQ7DQogICAgaWYgKHRhYmxlSWQpIHsNCiAgICAgIC8vIOiOt+WPluihqOivpue7huS/oeaBrw0KICAgICAgZ2V0Q29kZWdlbkRldGFpbCh0YWJsZUlkKS50aGVuKHJlcyA9PiB7DQogICAgICAgIHRoaXMuZm9ybURhdGEgPSByZXMuZGF0YTsNCiAgICAgIH0pOw0KICAgICAgLyoqIOafpeivouWtl+WFuOS4i+aLieWIl+ihqCAqLw0KICAgICAgbGlzdEFsbFNpbXBsZURpY3RUeXBlKCkudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgIHRoaXMuZGljdE9wdGlvbnMgPSByZXNwb25zZS5kYXRhOw0KICAgICAgfSk7DQogICAgICAvKiog5p+l6K+i6I+c5Y2V5LiL5ouJ5YiX6KGoICovDQogICAgICBsaXN0U2ltcGxlTWVudXMoKS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgdGhpcy5tZW51cyA9IFtdOw0KICAgICAgICB0aGlzLm1lbnVzLnB1c2goLi4udGhpcy5oYW5kbGVUcmVlKHJlc3BvbnNlLmRhdGEsICJpZCIpKTsNCiAgICAgIH0pOw0KICAgIH0NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIC8qKiDmj5DkuqTmjInpkq4gKi8NCiAgICBzdWJtaXRGb3JtKCkgew0KICAgICAgY29uc3QgYmFzaWNGb3JtID0gdGhpcy4kcmVmcy5iYXNpY0luZm8uJHJlZnMuYmFzaWNJbmZvRm9ybTsNCiAgICAgIGNvbnN0IGdlbkZvcm0gPSB0aGlzLiRyZWZzLmdlbkluZm8uJHJlZnMuZ2VuSW5mb0Zvcm07DQogICAgICBQcm9taXNlLmFsbChbYmFzaWNGb3JtLCBnZW5Gb3JtXS5tYXAodGhpcy5nZXRGb3JtUHJvbWlzZSkpLnRoZW4ocmVzID0+IHsNCiAgICAgICAgY29uc3QgdmFsaWRhdGVSZXN1bHQgPSByZXMuZXZlcnkoaXRlbSA9PiAhIWl0ZW0pOw0KICAgICAgICBpZiAodmFsaWRhdGVSZXN1bHQpIHsNCiAgICAgICAgICBjb25zdCBnZW5UYWJsZSA9IHt9Ow0KICAgICAgICAgIGdlblRhYmxlLnRhYmxlID0gT2JqZWN0LmFzc2lnbih7fSwgYmFzaWNGb3JtLm1vZGVsLCBnZW5Gb3JtLm1vZGVsKTsNCiAgICAgICAgICBnZW5UYWJsZS5jb2x1bW5zID0gdGhpcy5mb3JtRGF0YS5jb2x1bW5zOw0KICAgICAgICAgIGdlblRhYmxlLnBhcmFtcyA9IHsNCiAgICAgICAgICAgIHRyZWVDb2RlOiBnZW5UYWJsZS50cmVlQ29kZSwNCiAgICAgICAgICAgIHRyZWVOYW1lOiBnZW5UYWJsZS50cmVlTmFtZSwNCiAgICAgICAgICAgIHRyZWVQYXJlbnRDb2RlOiBnZW5UYWJsZS50cmVlUGFyZW50Q29kZSwNCiAgICAgICAgICAgIHBhcmVudE1lbnVJZDogZ2VuVGFibGUucGFyZW50TWVudUlkDQogICAgICAgICAgfTsNCiAgICAgICAgICB1cGRhdGVDb2RlZ2VuKGdlblRhYmxlKS50aGVuKHJlcyA9PiB7DQogICAgICAgICAgICB0aGlzLiRtb2RhbC5tc2dTdWNjZXNzKCLkv67mlLnmiJDlip/vvIEiKTsNCiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aGlzLiRtb2RhbC5tc2dFcnJvcigi6KGo5Y2V5qCh6aqM5pyq6YCa6L+H77yM6K+36YeN5paw5qOA5p+l5o+Q5Lqk5YaF5a65Iik7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0sDQogICAgZ2V0Rm9ybVByb21pc2UoZm9ybSkgew0KICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gew0KICAgICAgICBmb3JtLnZhbGlkYXRlKHJlcyA9PiB7DQogICAgICAgICAgcmVzb2x2ZShyZXMpOw0KICAgICAgICB9KTsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgLyoqIOWFs+mXreaMiemSriAqLw0KICAgIGNsb3NlKCkgew0KICAgICAgdGhpcy4kdGFiLmNsb3NlT3BlblBhZ2Uoew0KICAgICAgICAgIHBhdGg6ICIvaW5mcmEvY29kZWdlbiIsDQogICAgICAgICAgcXVlcnk6IHt0OiBEYXRlLm5vdygpLCBwYWdlTnVtOiB0aGlzLiRyb3V0ZS5xdWVyeS5wYWdlTnVtfQ0KICAgICAgICB9DQogICAgICApOw0KICAgIH0NCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICBjb25zdCBlbCA9IHRoaXMuJHJlZnMuZHJhZ1RhYmxlLiRlbC5xdWVyeVNlbGVjdG9yQWxsKCIuZWwtdGFibGVfX2JvZHktd3JhcHBlciA+IHRhYmxlID4gdGJvZHkiKVswXTsNCiAgICBjb25zdCBzb3J0YWJsZSA9IFNvcnRhYmxlLmNyZWF0ZShlbCwgew0KICAgICAgaGFuZGxlOiAiLmFsbG93RHJhZyIsDQogICAgICBvbkVuZDogZXZ0ID0+IHsNCiAgICAgICAgY29uc3QgdGFyZ2V0Um93ID0gdGhpcy5jb2x1bW5zLnNwbGljZShldnQub2xkSW5kZXgsIDEpWzBdOw0KICAgICAgICB0aGlzLmNvbHVtbnMuc3BsaWNlKGV2dC5uZXdJbmRleCwgMCwgdGFyZ2V0Um93KTsNCiAgICAgICAgZm9yIChsZXQgaW5kZXggaW4gdGhpcy5jb2x1bW5zKSB7DQogICAgICAgICAgdGhpcy5jb2x1bW5zW2luZGV4XS5zb3J0ID0gcGFyc2VJbnQoaW5kZXgpICsgMTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0pOw0KICB9DQp9Ow0K"},{"version":3,"sources":["editTable.vue"],"names":[],"mappings":";AAkIA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"editTable.vue","sourceRoot":"src/views/infra/codegen","sourcesContent":["<template>\r\n  <el-card>\r\n    <el-tabs v-model=\"activeName\">\r\n      <el-tab-pane label=\"基本信息\" name=\"basic\">\r\n        <basic-info-form ref=\"basicInfo\" :info=\"formData.table\"/>\r\n      </el-tab-pane>\r\n      <el-tab-pane label=\"字段信息\" name=\"cloum\">\r\n        <el-table ref=\"dragTable\" :data=\"formData.columns\" row-key=\"columnId\"\r\n                  :max-height=\"tableHeight\">\r\n          <el-table-column\r\n            label=\"字段列名\"\r\n            prop=\"columnName\"\r\n            min-width=\"10%\"\r\n            :show-overflow-tooltip=\"true\"\r\n          />\r\n          <el-table-column label=\"字段描述\" min-width=\"10%\">\r\n            <template v-slot=\"scope\">\r\n              <el-input v-model=\"scope.row.columnComment\"></el-input>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column\r\n            label=\"物理类型\"\r\n            prop=\"dataType\"\r\n            min-width=\"10%\"\r\n            :show-overflow-tooltip=\"true\"\r\n          />\r\n          <el-table-column label=\"Java类型\" min-width=\"11%\">\r\n            <template v-slot=\"scope\">\r\n              <el-select v-model=\"scope.row.javaType\">\r\n                <el-option label=\"Long\" value=\"Long\"/>\r\n                <el-option label=\"String\" value=\"String\"/>\r\n                <el-option label=\"Integer\" value=\"Integer\"/>\r\n                <el-option label=\"Double\" value=\"Double\"/>\r\n                <el-option label=\"BigDecimal\" value=\"BigDecimal\"/>\r\n                <el-option label=\"LocalDateTime\" value=\"LocalDateTime\"/>\r\n                <el-option label=\"Boolean\" value=\"Boolean\"/>\r\n              </el-select>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"java属性\" min-width=\"10%\">\r\n            <template v-slot=\"scope\">\r\n              <el-input v-model=\"scope.row.javaField\"></el-input>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"插入\" min-width=\"4%\">\r\n            <template v-slot=\"scope\">\r\n              <el-checkbox true-label=\"true\" false-label=\"false\" v-model=\"scope.row.createOperation\"></el-checkbox>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"编辑\" min-width=\"4%\">\r\n            <template v-slot=\"scope\">\r\n              <el-checkbox true-label=\"true\" false-label=\"false\" v-model=\"scope.row.updateOperation\"></el-checkbox>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"列表\" min-width=\"4%\">\r\n            <template v-slot=\"scope\">\r\n              <el-checkbox true-label=\"true\" false-label=\"false\" v-model=\"scope.row.listOperationResult\"></el-checkbox>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"查询\" min-width=\"4%\">\r\n            <template v-slot=\"scope\">\r\n              <el-checkbox true-label=\"true\" false-label=\"false\" v-model=\"scope.row.listOperation\"></el-checkbox>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"查询方式\" min-width=\"10%\">\r\n            <template v-slot=\"scope\">\r\n              <el-select v-model=\"scope.row.listOperationCondition\">\r\n                <el-option label=\"=\" value=\"=\"/>\r\n                <el-option label=\"!=\" value=\"!=\"/>\r\n                <el-option label=\">\" value=\">\"/>\r\n                <el-option label=\">=\" value=\">=\"/>\r\n                <el-option label=\"<\" value=\"<>\"/>\r\n                <el-option label=\"<=\" value=\"<=\"/>\r\n                <el-option label=\"LIKE\" value=\"LIKE\"/>\r\n                <el-option label=\"BETWEEN\" value=\"BETWEEN\"/>\r\n              </el-select>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"允许空\" min-width=\"5%\">\r\n            <template v-slot=\"scope\">\r\n              <el-checkbox true-label=\"true\" false-label=\"false\" v-model=\"scope.row.nullable\"></el-checkbox>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"显示类型\" min-width=\"12%\">\r\n            <template v-slot=\"scope\">\r\n              <el-select v-model=\"scope.row.htmlType\">\r\n                <el-option label=\"文本框\" value=\"input\"/>\r\n                <el-option label=\"文本域\" value=\"textarea\"/>\r\n                <el-option label=\"下拉框\" value=\"select\"/>\r\n                <el-option label=\"单选框\" value=\"radio\"/>\r\n                <el-option label=\"复选框\" value=\"checkbox\"/>\r\n                <el-option label=\"日期控件\" value=\"datetime\"/>\r\n                <el-option label=\"图片上传\" value=\"imageUpload\"/>\r\n                <el-option label=\"文件上传\" value=\"fileUpload\"/>\r\n                <el-option label=\"富文本控件\" value=\"editor\"/>\r\n              </el-select>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"字典类型\" min-width=\"12%\">\r\n            <template v-slot=\"scope\">\r\n              <el-select v-model=\"scope.row.dictType\" clearable filterable placeholder=\"请选择\">\r\n                <el-option\r\n                  v-for=\"dict in dictOptions\"\r\n                  :key=\"dict.id\"\r\n                  :label=\"dict.name\"\r\n                  :value=\"dict.type\"\r\n                />\r\n              </el-select>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"示例\" min-width=\"10%\">\r\n            <template v-slot=\"scope\">\r\n              <el-input v-model=\"scope.row.example\"></el-input>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n      </el-tab-pane>\r\n      <el-tab-pane label=\"生成信息\" name=\"genInfo\">\r\n        <gen-info-form ref=\"genInfo\" :form-data=\"formData.table\" :columns=\"formData.columns\" :menus=\"menus\"/>\r\n      </el-tab-pane>\r\n    </el-tabs>\r\n    <el-form label-width=\"100px\">\r\n      <el-form-item style=\"text-align: center;margin-left:-100px;margin-top:10px;\">\r\n        <el-button type=\"primary\" @click=\"submitForm()\">提交</el-button>\r\n        <el-button @click=\"close()\">返回</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n  </el-card>\r\n</template>\r\n<script>\r\nimport {getCodegenDetail, updateCodegen} from \"@/api/infra/codegen\";\r\nimport {listAllSimple as listAllSimpleDictType} from \"@/api/system/dict/type\";\r\nimport {listSimpleMenus} from \"@/api/system/menu\";\r\nimport basicInfoForm from \"./basicInfoForm\";\r\nimport genInfoForm from \"./genInfoForm\";\r\nimport Sortable from 'sortablejs'\r\n\r\nexport default {\r\n  name: \"GenEdit\",\r\n  components: {\r\n    basicInfoForm,\r\n    genInfoForm\r\n  },\r\n  data() {\r\n    return {\r\n      // 选中选项卡的 name\r\n      activeName: \"cloum\",\r\n      // 表格的高度\r\n      tableHeight: document.documentElement.scrollHeight - 245 + \"px\",\r\n      // 字典信息\r\n      dictOptions: [],\r\n      formData: {},\r\n      // 菜单信息\r\n      menus: []\r\n    };\r\n  },\r\n  created() {\r\n    const tableId = this.$route.params && this.$route.params.tableId;\r\n    if (tableId) {\r\n      // 获取表详细信息\r\n      getCodegenDetail(tableId).then(res => {\r\n        this.formData = res.data;\r\n      });\r\n      /** 查询字典下拉列表 */\r\n      listAllSimpleDictType().then(response => {\r\n        this.dictOptions = response.data;\r\n      });\r\n      /** 查询菜单下拉列表 */\r\n      listSimpleMenus().then(response => {\r\n        this.menus = [];\r\n        this.menus.push(...this.handleTree(response.data, \"id\"));\r\n      });\r\n    }\r\n  },\r\n  methods: {\r\n    /** 提交按钮 */\r\n    submitForm() {\r\n      const basicForm = this.$refs.basicInfo.$refs.basicInfoForm;\r\n      const genForm = this.$refs.genInfo.$refs.genInfoForm;\r\n      Promise.all([basicForm, genForm].map(this.getFormPromise)).then(res => {\r\n        const validateResult = res.every(item => !!item);\r\n        if (validateResult) {\r\n          const genTable = {};\r\n          genTable.table = Object.assign({}, basicForm.model, genForm.model);\r\n          genTable.columns = this.formData.columns;\r\n          genTable.params = {\r\n            treeCode: genTable.treeCode,\r\n            treeName: genTable.treeName,\r\n            treeParentCode: genTable.treeParentCode,\r\n            parentMenuId: genTable.parentMenuId\r\n          };\r\n          updateCodegen(genTable).then(res => {\r\n            this.$modal.msgSuccess(\"修改成功！\");\r\n            this.close();\r\n          });\r\n        } else {\r\n          this.$modal.msgError(\"表单校验未通过，请重新检查提交内容\");\r\n        }\r\n      });\r\n    },\r\n    getFormPromise(form) {\r\n      return new Promise(resolve => {\r\n        form.validate(res => {\r\n          resolve(res);\r\n        });\r\n      });\r\n    },\r\n    /** 关闭按钮 */\r\n    close() {\r\n      this.$tab.closeOpenPage({\r\n          path: \"/infra/codegen\",\r\n          query: {t: Date.now(), pageNum: this.$route.query.pageNum}\r\n        }\r\n      );\r\n    }\r\n  },\r\n  mounted() {\r\n    const el = this.$refs.dragTable.$el.querySelectorAll(\".el-table__body-wrapper > table > tbody\")[0];\r\n    const sortable = Sortable.create(el, {\r\n      handle: \".allowDrag\",\r\n      onEnd: evt => {\r\n        const targetRow = this.columns.splice(evt.oldIndex, 1)[0];\r\n        this.columns.splice(evt.newIndex, 0, targetRow);\r\n        for (let index in this.columns) {\r\n          this.columns[index].sort = parseInt(index) + 1;\r\n        }\r\n      }\r\n    });\r\n  }\r\n};\r\n</script>\r\n"]}]}