{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\components\\VideoUpload\\index.vue?vue&type=style&index=0&id=6b32f042&lang=scss","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\components\\VideoUpload\\index.vue","mtime":1704630437684},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgouZWRpdFBhZ2VfX3ZpZGVvIHsKICAuaGlkZXsKICAgIHZpc2liaWxpdHk6aGlkZGVuOwogIH0KICAuc3VjY2Vzc3sKICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgIHdpZHRoOiA3OHB4OwogICAgaGVpZ2h0OiA3OHB4OwogICAgbGluZS1oZWlnaHQ6IDc4cHg7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsMCwwLC41KTsKICAgIHRyYW5zaXRpb246IG9wYWNpdHkgLjNzOwogICAgY3Vyc29yOiBkZWZhdWx0OwoKICAgIC5pdGVtLXByZXZpZXcgLmVsLWljb24tem9vbS1pbnsKICAgICAgd2lkdGg6IDMwcHg7CiAgICAgIGZvbnQtc2l6ZTogMjBweDsKICAgICAgY29sb3I6ICNmMmYyZjI7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIH0KICAgIC5pdGVtLWRlbGV0ZSAuZWwtaWNvbi1kZWxldGV7CiAgICAgIHdpZHRoOiAzMHB4OwogICAgICBmb250LXNpemU6IDIwcHg7CiAgICAgIGNvbG9yOiAjZjJmMmYyOwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICB9CiAgfQoKICAudXBsb2FkZXItaWNvbiB7CiAgICBmb250LXNpemU6IDI4cHg7CiAgICBjb2xvcjogIzhjOTM5ZDsKICAgIHdpZHRoOiA4MHB4OwogICAgaGVpZ2h0OiA4MHB4OwogICAgbGluZS1oZWlnaHQ6IDgwcHg7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBsZWZ0OiAwOwogIH0KICAuc3VjY2Vzcy1pY29uIHsKICAgIGZvbnQtc2l6ZTogMjhweDsKICAgIGNvbG9yOiBncmVlbjsKICAgIHdpZHRoOiA4MHB4OwogICAgaGVpZ2h0OiA4MHB4OwogICAgbGluZS1oZWlnaHQ6IDgwcHg7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBsZWZ0OiAwOwogIH0KCiAgLmVsLXVwbG9hZHsKICAgIHdpZHRoOiA4MHB4OwogICAgaGVpZ2h0OiA4MHB4OwogIH0KCn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;AAwNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA","file":"index.vue","sourceRoot":"src/components/VideoUpload","sourcesContent":["<template>\r\n  <div class=\"editPage__video\">\r\n      <el-upload\r\n        class=\"uploader\"\r\n        list-type=\"picture-card\"\r\n        :action=\"uploadUrl\"\r\n        :on-success=\"handleSuccess\"\r\n        :before-upload=\"beforeUpload\"\r\n        :headers=\"headers\"\r\n        :on-error=\"handleError\"\r\n        :show-file-list=\"false\"\r\n      >\r\n\r\n        <div v-if=\"uploadFlag\" @mouseenter=\"mouseover\" @mouseleave=\"mouseout\">\r\n          <i class=\"el-icon-success success-icon\"></i>\r\n          <div :class=\"{'hide': activeHover, 'success': !activeHover}\">\r\n            <span class=\"item-actions\">\r\n              <span\r\n                class=\"item-preview\"\r\n                @click.stop=\"handlePreview()\"\r\n              >\r\n                <i class=\"el-icon-zoom-in\"></i>\r\n              </span>\r\n              <span\r\n                class=\"item-delete\"\r\n                @click.stop=\"handleRemove()\"\r\n              >\r\n                <i class=\"el-icon-delete\"></i>\r\n              </span>\r\n            </span>\r\n          </div>\r\n        </div>\r\n        <i v-else-if=\"uploadFlag === null\" class=\"el-icon-plus uploader-icon\"></i>\r\n        <i v-else-if=\"!uploadFlag\" class=\"el-icon-circle-close uploader-icon\" style=\"color: red\"></i>\r\n    </el-upload>\r\n    <!-- 上传提示 -->\r\n    <div class=\"el-upload__tip\" slot=\"tip\" v-if=\"showTip\">\r\n      请上传\r\n      <template v-if=\"fileSize\"> 大小不超过 <b style=\"color: #f56c6c\">{{ fileSize }}MB</b> </template>\r\n      <template v-if=\"fileType\"> 格式为 <b style=\"color: #f56c6c\">{{ fileType.join(\"/\") }}</b> </template>\r\n      的文件\r\n    </div>\r\n\r\n    <el-dialog :visible.sync=\"dialogVisible\" append-to-body  width=\"800\"  title=\"预览\">\r\n      <video width=\"100%\" v-if=\"videoUrl\" controls=\"controls\" :key=\"menuKey\">\r\n          <source :src=\"videoUrl\" type=\"video/mp4\" />\r\n      </video>\r\n    </el-dialog>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\nimport { getAccessToken } from \"@/utils/auth\";\r\n\r\nexport default {\r\n  props: {\r\n    value: [String, Object],\r\n    // 大小限制(MB)\r\n    fileSize: {\r\n      type: Number,\r\n      default: 300,\r\n    },\r\n    // 文件类型, 例如\"video/mp4\"\r\n    fileType: {\r\n      type: [String, Array],\r\n      default: () =>[\"video/mp4\"],\r\n    },\r\n    // 是否显示提示\r\n    isShowTip: {\r\n      type: Boolean,\r\n      default: true\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      uploadFlag: null,\r\n      activeHover: true,\r\n      dialogVisible: false,\r\n      videoUrl: null,\r\n      // 视频上传\r\n      uploadUrl: process.env.VUE_APP_BASE_API + \"/admin-api/infra/file/upload\", // 请求地址\r\n      headers: { Authorization: \"Bearer \" + getAccessToken() }, // 设置上传的请求头部\r\n      // 应付多个组件的情况 记录当前组件的key值\r\n      menuKey: 1, // 用来强制刷新,\r\n    }\r\n  },\r\n  watch: {\r\n    value: {\r\n      handler(val) {\r\n        if (val) {\r\n          this.videoUrl = val;\r\n          this.uploadFlag = true;\r\n        } else {\r\n          this.videoUrl = null;\r\n          this.uploadFlag = null;\r\n        }\r\n      },\r\n      deep: true,\r\n      immediate: true\r\n    }\r\n  },\r\n  computed: {\r\n    // 是否显示提示\r\n    showTip() {\r\n      return this.isShowTip && (this.fileType || this.fileSize);\r\n    },\r\n  },\r\n  methods: {\r\n     // 上传成功的函数\r\n     handleSuccess(res) {\r\n      ++this.menuKey;\r\n      if(res.code === 0){\r\n        this.uploadFlag = true;\r\n        this.videoUrl = res.data;\r\n        this.$emit(\"input\", this.videoUrl);\r\n      }else{\r\n        this.uploadFlag = false;\r\n        this.$message.error(\"错误！\"+ res.msg);\r\n      }\r\n    },\r\n    handleError(){\r\n      this.uploadFlag = false;\r\n    },\r\n    beforeUpload(file) {\r\n      const isMp4 = this.fileType.includes(file.type);\r\n      const isLt300MB = file.size / 1024 / 1024 < 300;\r\n      if (!isMp4) {\r\n        this.$message.error(\"视频只能是\"+ this.fileType.join(\"/\") +\"格式!\");\r\n      }\r\n      if (!isLt300MB) {\r\n        this.$message.error(\"上传视频大小不能超过 300MB!\");\r\n      }\r\n      return isMp4 && isLt300MB;\r\n    },\r\n     // 预览\r\n     handlePreview() {\r\n      this.dialogVisible = true;\r\n    },\r\n     // 删除视频\r\n    handleRemove() {\r\n      this.videoUrl = null;\r\n      this.uploadFlag = null;\r\n      this.$emit(\"input\", null);\r\n    },\r\n    mouseover(){\r\n      this.activeHover = false;\r\n    },\r\n    mouseout(){\r\n      this.activeHover = true;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n\r\n<style lang=\"scss\">\r\n\r\n  .editPage__video {\r\n    .hide{\r\n      visibility:hidden;\r\n    }\r\n    .success{\r\n      position: relative;\r\n      width: 78px;\r\n      height: 78px;\r\n      line-height: 78px;\r\n      background-color: rgba(0,0,0,.5);\r\n      transition: opacity .3s;\r\n      cursor: default;\r\n\r\n      .item-preview .el-icon-zoom-in{\r\n        width: 30px;\r\n        font-size: 20px;\r\n        color: #f2f2f2;\r\n        cursor: pointer;\r\n      }\r\n      .item-delete .el-icon-delete{\r\n        width: 30px;\r\n        font-size: 20px;\r\n        color: #f2f2f2;\r\n        cursor: pointer;\r\n      }\r\n    }\r\n\r\n    .uploader-icon {\r\n      font-size: 28px;\r\n      color: #8c939d;\r\n      width: 80px;\r\n      height: 80px;\r\n      line-height: 80px;\r\n      text-align: center;\r\n      position: absolute;\r\n      left: 0;\r\n    }\r\n    .success-icon {\r\n      font-size: 28px;\r\n      color: green;\r\n      width: 80px;\r\n      height: 80px;\r\n      line-height: 80px;\r\n      text-align: center;\r\n      position: absolute;\r\n      left: 0;\r\n    }\r\n\r\n    .el-upload{\r\n      width: 80px;\r\n      height: 80px;\r\n    }\r\n\r\n  }\r\n</style>\r\n"]}]}