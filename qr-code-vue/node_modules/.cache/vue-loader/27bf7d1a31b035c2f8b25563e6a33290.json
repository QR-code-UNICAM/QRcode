{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\sso.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\sso.vue","mtime":1704630438057},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQge2F1dGhvcml6ZSwgZ2V0QXV0aG9yaXplfSBmcm9tICJAL2FwaS9sb2dpbiI7DQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogIkxvZ2luIiwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgbG9naW5Gb3JtOiB7DQogICAgICAgIHNjb3BlczogW10sIC8vIOW3sumAieS4reeahCBzY29wZSDmlbDnu4QNCiAgICAgIH0sDQogICAgICBwYXJhbXM6IHsgLy8gVVJMIOS4iueahCBjbGllbnRfaWTjgIFzY29wZSDnrYnlj4LmlbANCiAgICAgICAgcmVzcG9uc2VUeXBlOiB1bmRlZmluZWQsDQogICAgICAgIGNsaWVudElkOiB1bmRlZmluZWQsDQogICAgICAgIHJlZGlyZWN0VXJpOiB1bmRlZmluZWQsDQogICAgICAgIHN0YXRlOiB1bmRlZmluZWQsDQogICAgICAgIHNjb3BlczogW10sIC8vIOS8mOWFiOS7jiBxdWVyeSDlj4LmlbDojrflj5bvvJvlpoLmnpzmnKrkvKDpgJLvvIzku47lkI7nq6/ojrflj5YNCiAgICAgIH0sDQogICAgICBjbGllbnQ6IHsgLy8g5a6i5oi356uv5L+h5oGvDQogICAgICAgIG5hbWU6ICcnLA0KICAgICAgICBsb2dvOiAnJywNCiAgICAgIH0sDQogICAgICBsb2FkaW5nOiBmYWxzZQ0KICAgIH07DQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgLy8g6Kej5p6Q5Y+C5pWwDQogICAgLy8g5L6L5aaC6K+044CQ6Ieq5Yqo5o6I5p2D5LiN6YCa6L+H44CR77yaY2xpZW50X2lkPWRlZmF1bHQmcmVkaXJlY3RfdXJpPWh0dHBzJTNBJTJGJTJGd3d3LmlvY29kZXIuY24mcmVzcG9uc2VfdHlwZT1jb2RlJnNjb3BlPXVzZXIucmVhZCUyMHVzZXIud3JpdGUNCiAgICAvLyDkvovlpoLor7TjgJDoh6rliqjmjojmnYPpgJrov4fjgJHvvJpjbGllbnRfaWQ9ZGVmYXVsdCZyZWRpcmVjdF91cmk9aHR0cHMlM0ElMkYlMkZ3d3cuaW9jb2Rlci5jbiZyZXNwb25zZV90eXBlPWNvZGUmc2NvcGU9dXNlci5yZWFkDQogICAgdGhpcy5wYXJhbXMucmVzcG9uc2VUeXBlID0gdGhpcy4kcm91dGUucXVlcnkucmVzcG9uc2VfdHlwZQ0KICAgIHRoaXMucGFyYW1zLmNsaWVudElkID0gdGhpcy4kcm91dGUucXVlcnkuY2xpZW50X2lkDQogICAgdGhpcy5wYXJhbXMucmVkaXJlY3RVcmkgPSB0aGlzLiRyb3V0ZS5xdWVyeS5yZWRpcmVjdF91cmkNCiAgICB0aGlzLnBhcmFtcy5zdGF0ZSA9IHRoaXMuJHJvdXRlLnF1ZXJ5LnN0YXRlDQogICAgaWYgKHRoaXMuJHJvdXRlLnF1ZXJ5LnNjb3BlKSB7DQogICAgICB0aGlzLnBhcmFtcy5zY29wZXMgPSB0aGlzLiRyb3V0ZS5xdWVyeS5zY29wZS5zcGxpdCgnICcpDQogICAgfQ0KDQogICAgLy8g5aaC5p6c5pyJIHNjb3BlIOWPguaVsO+8jOWFiOaJp+ihjOS4gOasoeiHquWKqOaOiOadg++8jOeci+eci+aYr+WQpuS5i+WJjemDveaOiOadg+i/h+S6huOAgg0KICAgIGlmICh0aGlzLnBhcmFtcy5zY29wZXMubGVuZ3RoID4gMCkgew0KICAgICAgdGhpcy5kb0F1dGhvcml6ZSh0cnVlLCB0aGlzLnBhcmFtcy5zY29wZXMsIFtdKS50aGVuKHJlcyA9PiB7DQogICAgICAgIGNvbnN0IGhyZWYgPSByZXMuZGF0YQ0KICAgICAgICBpZiAoIWhyZWYpIHsNCiAgICAgICAgICBjb25zb2xlLmxvZygn6Ieq5Yqo5o6I5p2D5pyq6YCa6L+H77yBJykNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgbG9jYXRpb24uaHJlZiA9IGhyZWYNCiAgICAgIH0pDQogICAgfQ0KDQogICAgLy8g6I635Y+W5o6I5p2D6aG155qE5Z+65pys5L+h5oGvDQogICAgZ2V0QXV0aG9yaXplKHRoaXMucGFyYW1zLmNsaWVudElkKS50aGVuKHJlcyA9PiB7DQogICAgICB0aGlzLmNsaWVudCA9IHJlcy5kYXRhLmNsaWVudA0KICAgICAgLy8g6Kej5p6QIHNjb3BlDQogICAgICBsZXQgc2NvcGVzDQogICAgICAvLyAxLjEg5aaC5p6cIHBhcmFtcy5zY29wZSDpnZ7nqbrvvIzliJnov4fmu6TkuIvov5Tlm57nmoQgc2NvcGVzDQogICAgICBpZiAodGhpcy5wYXJhbXMuc2NvcGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgc2NvcGVzID0gW10NCiAgICAgICAgZm9yIChjb25zdCBzY29wZSBvZiByZXMuZGF0YS5zY29wZXMpIHsNCiAgICAgICAgICBpZiAodGhpcy5wYXJhbXMuc2NvcGVzLmluZGV4T2Yoc2NvcGUua2V5KSA+PSAwKSB7DQogICAgICAgICAgICBzY29wZXMucHVzaChzY29wZSkNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIC8vIDEuMiDlpoLmnpwgcGFyYW1zLnNjb3BlIOS4uuepuu+8jOWImeS9v+eUqOi/lOWbnueahCBzY29wZXMg6K6+572u5a6DDQogICAgICB9IGVsc2Ugew0KICAgICAgICBzY29wZXMgPSByZXMuZGF0YS5zY29wZXMNCiAgICAgICAgZm9yIChjb25zdCBzY29wZSBvZiBzY29wZXMpIHsNCiAgICAgICAgICB0aGlzLnBhcmFtcy5zY29wZXMucHVzaChzY29wZS5rZXkpDQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8vIOeUn+aIkOW3sumAieS4reeahCBjaGVja2VkU2NvcGVzDQogICAgICBmb3IgKGNvbnN0IHNjb3BlIG9mIHNjb3Blcykgew0KICAgICAgICBpZiAoc2NvcGUudmFsdWUpIHsNCiAgICAgICAgICB0aGlzLmxvZ2luRm9ybS5zY29wZXMucHVzaChzY29wZS5rZXkpDQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9KQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgaGFuZGxlQXV0aG9yaXplKGFwcHJvdmVkKSB7DQogICAgICB0aGlzLiRyZWZzLmxvZ2luRm9ybS52YWxpZGF0ZSh2YWxpZCA9PiB7DQogICAgICAgIGlmICghdmFsaWQpIHsNCiAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlDQogICAgICAgIC8vIOiuoeeulyBjaGVja2VkU2NvcGVzICsgdW5jaGVja2VkU2NvcGVzDQogICAgICAgIGxldCBjaGVja2VkU2NvcGVzOw0KICAgICAgICBsZXQgdW5jaGVja2VkU2NvcGVzOw0KICAgICAgICBpZiAoYXBwcm92ZWQpIHsgLy8g5ZCM5oSP5o6I5p2D77yM5oyJ54Wn55So5oi355qE6YCJ5oupDQogICAgICAgICAgY2hlY2tlZFNjb3BlcyA9IHRoaXMubG9naW5Gb3JtLnNjb3Blcw0KICAgICAgICAgIHVuY2hlY2tlZFNjb3BlcyA9IHRoaXMucGFyYW1zLnNjb3Blcy5maWx0ZXIoaXRlbSA9PiBjaGVja2VkU2NvcGVzLmluZGV4T2YoaXRlbSkgPT09IC0xKQ0KICAgICAgICB9IGVsc2UgeyAvLyDmi5Lnu53vvIzliJnpg73mmK/lj5bmtogNCiAgICAgICAgICBjaGVja2VkU2NvcGVzID0gW10NCiAgICAgICAgICB1bmNoZWNrZWRTY29wZXMgPSB0aGlzLnBhcmFtcy5zY29wZXMNCiAgICAgICAgfQ0KICAgICAgICAvLyDmj5DkuqTmjojmnYPnmoTor7fmsYINCiAgICAgICAgdGhpcy5kb0F1dGhvcml6ZShmYWxzZSwgY2hlY2tlZFNjb3BlcywgdW5jaGVja2VkU2NvcGVzKS50aGVuKHJlcyA9PiB7DQogICAgICAgICAgY29uc3QgaHJlZiA9IHJlcy5kYXRhDQogICAgICAgICAgaWYgKCFocmVmKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICAgIGxvY2F0aW9uLmhyZWYgPSBocmVmDQogICAgICAgIH0pLmZpbmFsbHkoKCkgPT4gew0KICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlDQogICAgICAgIH0pDQogICAgICB9KQ0KICAgIH0sDQogICAgZG9BdXRob3JpemUoYXV0b0FwcHJvdmUsIGNoZWNrZWRTY29wZXMsIHVuY2hlY2tlZFNjb3Blcykgew0KICAgICAgcmV0dXJuIGF1dGhvcml6ZSh0aGlzLnBhcmFtcy5yZXNwb25zZVR5cGUsIHRoaXMucGFyYW1zLmNsaWVudElkLCB0aGlzLnBhcmFtcy5yZWRpcmVjdFVyaSwgdGhpcy5wYXJhbXMuc3RhdGUsDQogICAgICAgICAgYXV0b0FwcHJvdmUsIGNoZWNrZWRTY29wZXMsIHVuY2hlY2tlZFNjb3BlcykNCiAgICB9LA0KICAgIGZvcm1hdFNjb3BlKHNjb3BlKSB7DQogICAgICAvLyDmoLzlvI/ljJYgc2NvcGUg5o6I5p2D6IyD5Zu077yM5pa55L6/55So5oi355CG6Kej44CCDQogICAgICAvLyDov5nph4zku4Xku4XmmK/kuIDkuKogZGVtb++8jOWPr+S7peiAg+iZkeW9leWFpeWIsOWtl+WFuOaVsOaNruS4re+8jOS+i+WmguivtOWtl+WFuOexu+WeiyAic3lzdGVtX29hdXRoMl9zY29wZSLvvIzlroPnmoTmr4/kuKogc2NvcGUg6YO95piv5LiA5p2h5a2X5YW45pWw5o2u44CCDQogICAgICBzd2l0Y2ggKHNjb3BlKSB7DQogICAgICAgIGNhc2UgJ3VzZXIucmVhZCc6IHJldHVybiAn6K6/6Zeu5L2g55qE5Liq5Lq65L+h5oGvJw0KICAgICAgICBjYXNlICd1c2VyLndyaXRlJzogcmV0dXJuICfkv67mlLnkvaDnmoTkuKrkurrkv6Hmga8nDQogICAgICAgIGRlZmF1bHQ6IHJldHVybiBzY29wZQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KfTsNCg=="},{"version":3,"sources":["sso.vue"],"names":[],"mappings":";AAqDA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"sso.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <div class=\"logo\"></div>\r\n    <!-- 登录区域 -->\r\n    <div class=\"content\">\r\n      <!-- 配图 -->\r\n      <div class=\"pic\"></div>\r\n      <!-- 表单 -->\r\n      <div class=\"field\">\r\n        <!-- [移动端]标题 -->\r\n        <h2 class=\"mobile-title\">\r\n          <h3 class=\"title\">芋道后台管理系统</h3>\r\n        </h2>\r\n\r\n        <!-- 表单 -->\r\n        <div class=\"form-cont\">\r\n          <el-tabs class=\"form\" style=\" float:none;\" value=\"uname\">\r\n            <el-tab-pane :label=\"'三方授权（' + client.name + ')'\" name=\"uname\">\r\n            </el-tab-pane>\r\n          </el-tabs>\r\n          <div>\r\n            <el-form ref=\"loginForm\" :model=\"loginForm\" class=\"login-form\">\r\n              <!-- 授权范围的选择 -->\r\n              此第三方应用请求获得以下权限：\r\n              <el-form-item prop=\"scopes\">\r\n                <el-checkbox-group v-model=\"loginForm.scopes\">\r\n                  <el-checkbox v-for=\"scope in params.scopes\" :label=\"scope\" :key=\"scope\"\r\n                               style=\"display: block; margin-bottom: -10px;\">{{formatScope(scope)}}</el-checkbox>\r\n                </el-checkbox-group>\r\n              </el-form-item>\r\n              <!-- 下方的登录按钮 -->\r\n              <el-form-item style=\"width:100%;\">\r\n                <el-button :loading=\"loading\" size=\"medium\" type=\"primary\" style=\"width:60%;\"\r\n                           @click.native.prevent=\"handleAuthorize(true)\">\r\n                  <span v-if=\"!loading\">同意授权</span>\r\n                  <span v-else>授 权 中...</span>\r\n                </el-button>\r\n                <el-button size=\"medium\" style=\"width:36%\"\r\n                           @click.native.prevent=\"handleAuthorize(false)\">拒绝</el-button>\r\n              </el-form-item>\r\n            </el-form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- footer -->\r\n    <div class=\"footer\">\r\n      Copyright © 2020-2022 iocoder.cn All Rights Reserved.\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {authorize, getAuthorize} from \"@/api/login\";\r\n\r\nexport default {\r\n  name: \"Login\",\r\n  data() {\r\n    return {\r\n      loginForm: {\r\n        scopes: [], // 已选中的 scope 数组\r\n      },\r\n      params: { // URL 上的 client_id、scope 等参数\r\n        responseType: undefined,\r\n        clientId: undefined,\r\n        redirectUri: undefined,\r\n        state: undefined,\r\n        scopes: [], // 优先从 query 参数获取；如果未传递，从后端获取\r\n      },\r\n      client: { // 客户端信息\r\n        name: '',\r\n        logo: '',\r\n      },\r\n      loading: false\r\n    };\r\n  },\r\n  created() {\r\n    // 解析参数\r\n    // 例如说【自动授权不通过】：client_id=default&redirect_uri=https%3A%2F%2Fwww.iocoder.cn&response_type=code&scope=user.read%20user.write\r\n    // 例如说【自动授权通过】：client_id=default&redirect_uri=https%3A%2F%2Fwww.iocoder.cn&response_type=code&scope=user.read\r\n    this.params.responseType = this.$route.query.response_type\r\n    this.params.clientId = this.$route.query.client_id\r\n    this.params.redirectUri = this.$route.query.redirect_uri\r\n    this.params.state = this.$route.query.state\r\n    if (this.$route.query.scope) {\r\n      this.params.scopes = this.$route.query.scope.split(' ')\r\n    }\r\n\r\n    // 如果有 scope 参数，先执行一次自动授权，看看是否之前都授权过了。\r\n    if (this.params.scopes.length > 0) {\r\n      this.doAuthorize(true, this.params.scopes, []).then(res => {\r\n        const href = res.data\r\n        if (!href) {\r\n          console.log('自动授权未通过！')\r\n          return;\r\n        }\r\n        location.href = href\r\n      })\r\n    }\r\n\r\n    // 获取授权页的基本信息\r\n    getAuthorize(this.params.clientId).then(res => {\r\n      this.client = res.data.client\r\n      // 解析 scope\r\n      let scopes\r\n      // 1.1 如果 params.scope 非空，则过滤下返回的 scopes\r\n      if (this.params.scopes.length > 0) {\r\n        scopes = []\r\n        for (const scope of res.data.scopes) {\r\n          if (this.params.scopes.indexOf(scope.key) >= 0) {\r\n            scopes.push(scope)\r\n          }\r\n        }\r\n      // 1.2 如果 params.scope 为空，则使用返回的 scopes 设置它\r\n      } else {\r\n        scopes = res.data.scopes\r\n        for (const scope of scopes) {\r\n          this.params.scopes.push(scope.key)\r\n        }\r\n      }\r\n      // 生成已选中的 checkedScopes\r\n      for (const scope of scopes) {\r\n        if (scope.value) {\r\n          this.loginForm.scopes.push(scope.key)\r\n        }\r\n      }\r\n    })\r\n  },\r\n  methods: {\r\n    handleAuthorize(approved) {\r\n      this.$refs.loginForm.validate(valid => {\r\n        if (!valid) {\r\n          return\r\n        }\r\n        this.loading = true\r\n        // 计算 checkedScopes + uncheckedScopes\r\n        let checkedScopes;\r\n        let uncheckedScopes;\r\n        if (approved) { // 同意授权，按照用户的选择\r\n          checkedScopes = this.loginForm.scopes\r\n          uncheckedScopes = this.params.scopes.filter(item => checkedScopes.indexOf(item) === -1)\r\n        } else { // 拒绝，则都是取消\r\n          checkedScopes = []\r\n          uncheckedScopes = this.params.scopes\r\n        }\r\n        // 提交授权的请求\r\n        this.doAuthorize(false, checkedScopes, uncheckedScopes).then(res => {\r\n          const href = res.data\r\n          if (!href) {\r\n            return;\r\n          }\r\n          location.href = href\r\n        }).finally(() => {\r\n          this.loading = false\r\n        })\r\n      })\r\n    },\r\n    doAuthorize(autoApprove, checkedScopes, uncheckedScopes) {\r\n      return authorize(this.params.responseType, this.params.clientId, this.params.redirectUri, this.params.state,\r\n          autoApprove, checkedScopes, uncheckedScopes)\r\n    },\r\n    formatScope(scope) {\r\n      // 格式化 scope 授权范围，方便用户理解。\r\n      // 这里仅仅是一个 demo，可以考虑录入到字典数据中，例如说字典类型 \"system_oauth2_scope\"，它的每个 scope 都是一条字典数据。\r\n      switch (scope) {\r\n        case 'user.read': return '访问你的个人信息'\r\n        case 'user.write': return '修改你的个人信息'\r\n        default: return scope\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n@import \"~@/assets/styles/login.scss\";\r\n.oauth-login {\r\n  display: flex;\r\n  align-items: center;\r\n  cursor:pointer;\r\n}\r\n.oauth-login-item {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-right: 10px;\r\n}\r\n.oauth-login-item img {\r\n  height: 25px;\r\n  width: 25px;\r\n}\r\n.oauth-login-item span:hover {\r\n  text-decoration: underline red;\r\n  color: red;\r\n}\r\n</style>\r\n"]}]}