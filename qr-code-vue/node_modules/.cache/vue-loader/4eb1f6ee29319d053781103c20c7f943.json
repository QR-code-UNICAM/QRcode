{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\socialLogin.vue?vue&type=style&index=0&id=f3fef45c&rel=stylesheet%2Fscss&lang=scss","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\socialLogin.vue","mtime":1704630438056},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpAaW1wb3J0ICJ+QC9hc3NldHMvc3R5bGVzL2xvZ2luLnNjc3MiOw0K"},{"version":3,"sources":["socialLogin.vue"],"names":[],"mappings":";AA8LA","file":"socialLogin.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <div class=\"logo\"></div>\r\n    <!-- 登录区域 -->\r\n    <div class=\"content\">\r\n      <!-- 配图 -->\r\n      <div class=\"pic\"></div>\r\n      <!-- 表单 -->\r\n      <div class=\"field\">\r\n        <!-- [移动端]标题 -->\r\n        <h2 class=\"mobile-title\">\r\n          <h3 class=\"title\">芋道后台管理系统</h3>\r\n        </h2>\r\n\r\n        <!-- 表单 -->\r\n        <div class=\"form-cont\">\r\n          <el-tabs class=\"form\" v-model=\"loginForm.loginType \" style=\" float:none;\">\r\n            <el-tab-pane label=\"绑定账号\" name=\"uname\">\r\n            </el-tab-pane>\r\n          </el-tabs>\r\n          <div>\r\n            <el-form ref=\"loginForm\" :model=\"loginForm\" :rules=\"loginRules\" class=\"login-form\">\r\n              <!-- 账号密码登录 -->\r\n              <el-form-item prop=\"username\">\r\n                <el-input v-model=\"loginForm.username\" type=\"text\" auto-complete=\"off\" placeholder=\"账号\">\r\n                  <svg-icon slot=\"prefix\" icon-class=\"user\" class=\"el-input__icon input-icon\"/>\r\n                </el-input>\r\n              </el-form-item>\r\n              <el-form-item prop=\"password\">\r\n                <el-input v-model=\"loginForm.password\" type=\"password\" auto-complete=\"off\" placeholder=\"密码\"\r\n                          @keyup.enter.native=\"handleLogin\">\r\n                  <svg-icon slot=\"prefix\" icon-class=\"password\" class=\"el-input__icon input-icon\"/>\r\n                </el-input>\r\n              </el-form-item>\r\n              <el-checkbox v-model=\"loginForm.rememberMe\" style=\"margin:0 0 25px 0;\">记住密码</el-checkbox>\r\n              <!-- 下方的登录按钮 -->\r\n              <el-form-item style=\"width:100%;\">\r\n                <el-button :loading=\"loading\" size=\"medium\" type=\"primary\" style=\"width:100%;\"\r\n                           @click.native.prevent=\"getCode\">\r\n                  <span v-if=\"!loading\">登 录</span>\r\n                  <span v-else>登 录 中...</span>\r\n                </el-button>\r\n              </el-form-item>\r\n            </el-form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 图形验证码 -->\r\n    <Verify ref=\"verify\" :captcha-type=\"'blockPuzzle'\" :img-size=\"{width:'400px',height:'200px'}\"\r\n            @success=\"handleLogin\" />\r\n\r\n    <!-- footer -->\r\n    <div class=\"footer\">\r\n      Copyright © 2020-2022 iocoder.cn All Rights Reserved.\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  getPassword, getRememberMe,\r\n  getUsername,\r\n  removePassword,\r\n  removeUsername,\r\n  setPassword,\r\n  setRememberMe,\r\n  setUsername\r\n} from \"@/utils/auth\";\r\n\r\nimport Verify from '@/components/Verifition/Verify';\r\nimport {getCaptchaEnable} from \"@/utils/ruoyi\";\r\n\r\nexport default {\r\n  name: \"ThirdLogin\",\r\n  components: {\r\n    Verify\r\n  },\r\n  data() {\r\n    return {\r\n      codeUrl: \"\",\r\n      captchaEnable: true,\r\n      loginForm: {\r\n        loginType: \"uname\",\r\n        username: \"admin\",\r\n        password: \"admin123\",\r\n        rememberMe: false,\r\n        captchaVerification: \"\",\r\n      },\r\n      loginRules: {\r\n        username: [\r\n          { required: true, trigger: \"blur\", message: \"用户名不能为空\" }\r\n        ],\r\n        password: [\r\n          { required: true, trigger: \"blur\", message: \"密码不能为空\" }\r\n        ],\r\n      },\r\n      loading: false,\r\n      redirect: undefined,\r\n      // 社交登录相关\r\n      type: undefined,\r\n      code: undefined,\r\n      state: undefined,\r\n    };\r\n  },\r\n  created() {\r\n    this.getCookie();\r\n    // 验证码开关\r\n    this.captchaEnable = getCaptchaEnable();\r\n    // 重定向地址\r\n    this.redirect = this.getUrlValue('redirect');\r\n    // 社交登录相关\r\n    this.type = this.getUrlValue('type');\r\n    this.code = this.$route.query.code;\r\n    this.state = this.$route.query.state;\r\n\r\n    // 尝试登录一下\r\n    this.loading = true;\r\n    this.$store.dispatch(\"SocialLogin\", {\r\n      code: this.code,\r\n      state: this.state,\r\n      type: this.type\r\n    }).then(() => {\r\n      this.$router.push({ path: this.redirect || \"/\" }).catch(()=>{});\r\n    }).catch(() => {\r\n      this.loading = false;\r\n    });\r\n  },\r\n  methods: {\r\n    getCode() {\r\n      // 情况一，未开启：则直接登录\r\n      if (!this.captchaEnable) {\r\n        this.handleLogin({})\r\n        return;\r\n      }\r\n\r\n      // 情况二，已开启：则展示验证码；只有完成验证码的情况，才进行登录\r\n      // 弹出验证码\r\n      this.$refs.verify.show()\r\n    },\r\n    getCookie() {\r\n      const username = getUsername();\r\n      const password = getPassword();\r\n      const rememberMe = getRememberMe();\r\n      this.loginForm = {\r\n        username: username ? username : this.loginForm.username,\r\n        password: password ? password : this.loginForm.password,\r\n        rememberMe: rememberMe ? getRememberMe() : false,\r\n        loginType: this.loginForm.loginType,\r\n      };\r\n    },\r\n    handleLogin(captchaParams) {\r\n      this.$refs.loginForm.validate(valid => {\r\n        if (valid) {\r\n          this.loading = true;\r\n          if (this.loginForm.rememberMe) {\r\n            setUsername(this.loginForm.username)\r\n            setPassword(this.loginForm.password)\r\n            setRememberMe(this.loginForm.rememberMe)\r\n          } else {\r\n            removeUsername()\r\n            removePassword()\r\n          }\r\n          this.$store.dispatch(\"Login\", {\r\n            socialCode: this.code,\r\n            socialState: this.state,\r\n            socialType: this.type,\r\n            // 账号密码登录\r\n            username: this.loginForm.username,\r\n            password: this.loginForm.password,\r\n            captchaVerification: captchaParams.captchaVerification\r\n          }).then(() => {\r\n            this.$router.push({ path: this.redirect || \"/\" }).catch(()=>{});\r\n          }).catch(() => {\r\n            this.loading = false;\r\n            this.getCode()\r\n          });\r\n        }\r\n      });\r\n    },\r\n    getUrlValue(key) {\r\n      const url = new URL(decodeURIComponent(location.href));\r\n      return url.searchParams.get(key);\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style rel=\"stylesheet/scss\" lang=\"scss\">\r\n@import \"~@/assets/styles/login.scss\";\r\n</style>\r\n"]}]}