{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\infra\\webSocket\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\infra\\webSocket\\index.vue","mtime":1704630437926},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQge2dldE5vd0RhdGVUaW1lfSBmcm9tICJAL3V0aWxzL3J1b3lpIjsNCmltcG9ydCB7Z2V0QWNjZXNzVG9rZW59IGZyb20gIkAvdXRpbHMvYXV0aCI7DQppbXBvcnQge2xpc3RTaW1wbGVVc2Vyc30gZnJvbSAiQC9hcGkvc3lzdGVtL3VzZXIiOw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHVybDogIiIsDQogICAgICBzZW5kVGV4dDogIiIsDQogICAgICBjb250ZW50OiAiIiwNCiAgICAgIHdzOiBudWxsLA0KICAgICAgdXNlckxpc3Q6IFtdLCAvLyDnlKjmiLfliJfooagNCiAgICAgIHNlbmRVc2VySWQ6IG51bGwgLy8g5Y+R57uZ6LCB77yM6buY6K6k5omA5pyJ5Lq6DQogICAgfTsNCiAgfSwNCiAgY3JlYXRlZCgpIHsNCiAgICBjb25zdCB3c1VybCA9IHByb2Nlc3MuZW52LlZVRV9BUFBfQkFTRV9BUEkgKyAiL2luZnJhL3dzIiArICc/dG9rZW49JyArIGdldEFjY2Vzc1Rva2VuKCk7DQogICAgdGhpcy51cmwgPSB3c1VybC5yZXBsYWNlKCJodHRwIiwgIndzIik7DQogICAgLy8g6I635Y+W55So5oi357K+566A5L+h5oGv5YiX6KGoDQogICAgbGlzdFNpbXBsZVVzZXJzKCkudGhlbihyZXMgPT4gew0KICAgICAgdGhpcy51c2VyTGlzdCA9IHJlcy5kYXRhOw0KICAgIH0pOw0KICB9LA0KICBtZXRob2RzOiB7DQogICAgLyoqIOWPkei1t+i/nuaOpSAqLw0KICAgIGNvbm5lY3QoKSB7DQogICAgICBpZiAoISdXZWJTb2NrZXQnIGluIHdpbmRvdykgew0KICAgICAgICB0aGlzLiRtb2RhbC5tc2dFcnJvcigi5oKo55qE5rWP6KeI5Zmo5LiN5pSv5oyBV2ViU29ja2V0Iik7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIC8vIOW7uueri+i/nuaOpQ0KICAgICAgdGhpcy53cyA9IG5ldyBXZWJTb2NrZXQodGhpcy51cmwpOw0KICAgICAgLy8g55uR5ZCsIG9wZW4g5LqL5Lu2DQogICAgICB0aGlzLndzLm9ub3BlbiA9IChldmVudCkgPT4gew0KICAgICAgICB0aGlzLmNvbnRlbnQgPSB0aGlzLmNvbnRlbnQgKyAiXG4qKioqKioqKioqKioqKioqKioqKioq6L+e5o6l5byA5aeLKioqKioqKioqKioqKioqKioqKioqKlxuIjsNCiAgICAgIH07DQogICAgICAvLyDnm5HlkKwgbWVzc2FnZSDkuovku7YNCiAgICAgIHRoaXMud3Mub25tZXNzYWdlID0gKGV2ZW50KSA9PiB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgY29uc3QgZGF0YSA9IGV2ZW50LmRhdGE7DQogICAgICAgICAgLy8gMS4g5pS25Yiw5b+D6LezDQogICAgICAgICAgaWYgKGRhdGEgPT09ICdwb25nJykgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgICAvLyAyLjEg6Kej5p6QIHR5cGUg5raI5oGv57G75Z6LDQogICAgICAgICAgY29uc3QganNvbk1lc3NhZ2UgPSBKU09OLnBhcnNlKGRhdGEpDQogICAgICAgICAgY29uc3QgdHlwZSA9IGpzb25NZXNzYWdlLnR5cGU7DQogICAgICAgICAgY29uc3QgY29udGVudCA9IEpTT04ucGFyc2UoanNvbk1lc3NhZ2UuY29udGVudCk7DQogICAgICAgICAgaWYgKCF0eXBlKSB7DQogICAgICAgICAgICB0aGlzLiRtb2RhbC5tc2dFcnJvcign5pyq55+l55qE5raI5oGv57G75Z6L77yaJyArIGRhdGEpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgICAvLyAyLjIg5raI5oGv57G75Z6L77yaZGVtby1tZXNzYWdlLXJlY2VpdmUNCiAgICAgICAgICBpZiAodHlwZSA9PT0gJ2RlbW8tbWVzc2FnZS1yZWNlaXZlJykgew0KICAgICAgICAgICAgY29uc3Qgc2luZ2xlID0gY29udGVudC5zaW5nbGU7DQogICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSB0aGlzLmNvbnRlbnQgKyAi5o6l5pS25pe26Ze077yaIiArIGdldE5vd0RhdGVUaW1lKCkgKyAiXG4iICsNCiAgICAgICAgICAgICAgICBg44CQJHtzaW5nbGUgPyAn5Y2V5Y+RJyA6ICfnvqTlj5EnfeOAkeeUqOaIt+e8luWPtygke2NvbnRlbnQuZnJvbVVzZXJJZH0p77yaJHtjb250ZW50LnRleHR9YCArICJcbiI7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICAgIC8vIDIuMyDmtojmga/nsbvlnovvvJpub3RpY2UtcHVzaA0KICAgICAgICAgIGlmICh0eXBlID09PSAnbm90aWNlLXB1c2gnKSB7DQogICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSB0aGlzLmNvbnRlbnQgKyAi5o6l5pS25pe26Ze077yaIiArIGdldE5vd0RhdGVUaW1lKCkgKyAiXG4iICsgYOOAkOezu+e7n+mAmuefpeOAke+8miR7Y29udGVudC50aXRsZX1gICsgIlxuIjsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQogICAgICAgICAgdGhpcy4kbW9kYWwubXNnRXJyb3IoJ+acquWkhOeQhua2iOaBr++8micgKyBkYXRhKTsNCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICB0aGlzLiRtb2RhbC5tc2dFcnJvcign5aSE55CG5raI5oGv5Y+R55Sf5byC5bi477yaJyArIGV2ZW50LmRhdGEpOw0KICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOw0KICAgICAgICB9DQogICAgICB9Ow0KICAgICAgLy8g55uR5ZCsIGNsb3NlIOS6i+S7tg0KICAgICAgdGhpcy53cy5vbmNsb3NlID0gKGV2ZW50KSA9PiB7DQogICAgICAgIHRoaXMuY29udGVudCA9IHRoaXMuY29udGVudCArICIqKioqKioqKioqKioqKioqKioqKioq6L+e5o6l5YWz6ZetKioqKioqKioqKioqKioqKioqKioqKlxuIjsNCiAgICAgIH07DQogICAgICAvLyDnm5HlkKwgZXJyb3Ig5LqL5Lu2DQogICAgICB0aGlzLndzLmVycm9yID0gKGV2ZW50KSA9PiB7DQogICAgICAgIHRoaXMuY29udGVudCA9IHRoaXMuY29udGVudCArICIqKioqKioqKioqKioqKioqKioqKioq6L+e5o6l5byC5bi4KioqKioqKioqKioqKioqKioqKioqKlxuIjsNCiAgICAgIH07DQogICAgfSwNCiAgICAvKiog5YWz6Zet6L+e5o6lICovDQogICAgZXhpdCgpIHsNCiAgICAgIGlmICh0aGlzLndzKSB7DQogICAgICAgIHRoaXMud3MuY2xvc2UoKTsNCiAgICAgICAgdGhpcy53cyA9IG51bGw7DQogICAgICB9DQogICAgfSwNCiAgICAvKiog5Y+R6YCB5raI5oGvICovDQogICAgc2VuZCgpIHsNCiAgICAgIGlmICghdGhpcy53cyB8fCB0aGlzLndzLnJlYWR5U3RhdGUgIT09IDEpIHsNCiAgICAgICAgdGhpcy4kbW9kYWwubXNnRXJyb3IoIuacqui/nuaOpeWIsOacjeWKoeWZqCIpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICBpZiAoIXRoaXMuc2VuZFRleHQpIHsNCiAgICAgICAgdGhpcy4kbW9kYWwubXNnRXJyb3IoIuivt+i+k+WFpeWPkemAgeWGheWuuSIpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIC8vIDEuMSDlhYggSlNPTiDljJYgbWVzc2FnZSDmtojmga/lhoXlrrkNCiAgICAgIGNvbnN0IG1lc3NhZ2VDb250ZW50ID0gSlNPTi5zdHJpbmdpZnkoew0KICAgICAgICB0ZXh0OiB0aGlzLnNlbmRUZXh0LA0KICAgICAgICB0b1VzZXJJZDogdGhpcy5zZW5kVXNlcklkDQogICAgICB9KTsNCiAgICAgIC8vIDEuMiDlho0gSlNPTiDljJbmlbTkuKrmtojmga8NCiAgICAgIGNvbnN0IGpzb25NZXNzYWdlID0gSlNPTi5zdHJpbmdpZnkoew0KICAgICAgICB0eXBlOiAnZGVtby1tZXNzYWdlLXNlbmQnLA0KICAgICAgICBjb250ZW50OiBtZXNzYWdlQ29udGVudA0KICAgICAgfSk7DQogICAgICAvLyAyLiDmnIDlkI7lj5HpgIHmtojmga8NCiAgICAgIHRoaXMud3Muc2VuZChqc29uTWVzc2FnZSk7DQogICAgICB0aGlzLnNlbmRUZXh0ID0gJyc7DQogICAgfQ0KICB9LA0KfTsNCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA8CA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/infra/webSocket","sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <el-form label-width=\"120px\">\r\n      <el-row type=\"flex\" :gutter=\"0\">\r\n        <el-col :sm=\"12\">\r\n          <el-form-item label=\"WebSocket地址\" size=\"small\">\r\n            <el-input v-model=\"url\" type=\"text\"/>\r\n          </el-form-item>\r\n        </el-col>\r\n        <el-col :offset=\"1\">\r\n          <el-form-item label=\"\" label-width=\"0px\" size=\"small\">\r\n            <el-button @click=\"connect\" type=\"primary\" :disabled=\"ws&&ws.readyState===1\">\r\n              {{ ws && ws.readyState === 1 ? \"已连接\" : \"连接\" }}\r\n            </el-button>\r\n            <el-button @click=\"exit\" type=\"danger\">断开</el-button>\r\n          </el-form-item>\r\n        </el-col>\r\n      </el-row>\r\n      <el-form-item label=\"发给谁\" size=\"small\">\r\n        <el-select v-model=\"sendUserId\" placeholder=\"请选择\">\r\n          <el-option label=\"所有人\" :value=\"null\"/>\r\n          <el-option\r\n              v-for=\"item in userList\"\r\n              :key=\"item.id\"\r\n              :label=\"item.nickname\"\r\n              :value=\"item.id\">\r\n          </el-option>\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item label=\"发送内容\" size=\"small\">\r\n        <el-input type=\"textarea\" v-model=\"sendText\" :rows=\"5\"/>\r\n      </el-form-item>\r\n      <el-form-item label=\"\" size=\"small\">\r\n        <el-button type=\"success\" @click=\"send\">发送消息</el-button>\r\n      </el-form-item>\r\n      <el-form-item label=\"接收内容\" size=\"small\">\r\n        <el-input type=\"textarea\" v-model=\"content\" :rows=\"12\" disabled/>\r\n      </el-form-item>\r\n      <el-form-item label=\"\" size=\"small\">\r\n        <el-button type=\"info\" @click=\"content=''\">清空消息</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {getNowDateTime} from \"@/utils/ruoyi\";\r\nimport {getAccessToken} from \"@/utils/auth\";\r\nimport {listSimpleUsers} from \"@/api/system/user\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      url: \"\",\r\n      sendText: \"\",\r\n      content: \"\",\r\n      ws: null,\r\n      userList: [], // 用户列表\r\n      sendUserId: null // 发给谁，默认所有人\r\n    };\r\n  },\r\n  created() {\r\n    const wsUrl = process.env.VUE_APP_BASE_API + \"/infra/ws\" + '?token=' + getAccessToken();\r\n    this.url = wsUrl.replace(\"http\", \"ws\");\r\n    // 获取用户精简信息列表\r\n    listSimpleUsers().then(res => {\r\n      this.userList = res.data;\r\n    });\r\n  },\r\n  methods: {\r\n    /** 发起连接 */\r\n    connect() {\r\n      if (!'WebSocket' in window) {\r\n        this.$modal.msgError(\"您的浏览器不支持WebSocket\");\r\n        return;\r\n      }\r\n      // 建立连接\r\n      this.ws = new WebSocket(this.url);\r\n      // 监听 open 事件\r\n      this.ws.onopen = (event) => {\r\n        this.content = this.content + \"\\n**********************连接开始**********************\\n\";\r\n      };\r\n      // 监听 message 事件\r\n      this.ws.onmessage = (event) => {\r\n        try {\r\n          const data = event.data;\r\n          // 1. 收到心跳\r\n          if (data === 'pong') {\r\n            return;\r\n          }\r\n          // 2.1 解析 type 消息类型\r\n          const jsonMessage = JSON.parse(data)\r\n          const type = jsonMessage.type;\r\n          const content = JSON.parse(jsonMessage.content);\r\n          if (!type) {\r\n            this.$modal.msgError('未知的消息类型：' + data);\r\n            return;\r\n          }\r\n          // 2.2 消息类型：demo-message-receive\r\n          if (type === 'demo-message-receive') {\r\n            const single = content.single;\r\n            this.content = this.content + \"接收时间：\" + getNowDateTime() + \"\\n\" +\r\n                `【${single ? '单发' : '群发'}】用户编号(${content.fromUserId})：${content.text}` + \"\\n\";\r\n            return;\r\n          }\r\n          // 2.3 消息类型：notice-push\r\n          if (type === 'notice-push') {\r\n            this.content = this.content + \"接收时间：\" + getNowDateTime() + \"\\n\" + `【系统通知】：${content.title}` + \"\\n\";\r\n            return;\r\n          }\r\n          this.$modal.msgError('未处理消息：' + data);\r\n        } catch (error) {\r\n          this.$modal.msgError('处理消息发生异常：' + event.data);\r\n          console.error(error);\r\n        }\r\n      };\r\n      // 监听 close 事件\r\n      this.ws.onclose = (event) => {\r\n        this.content = this.content + \"**********************连接关闭**********************\\n\";\r\n      };\r\n      // 监听 error 事件\r\n      this.ws.error = (event) => {\r\n        this.content = this.content + \"**********************连接异常**********************\\n\";\r\n      };\r\n    },\r\n    /** 关闭连接 */\r\n    exit() {\r\n      if (this.ws) {\r\n        this.ws.close();\r\n        this.ws = null;\r\n      }\r\n    },\r\n    /** 发送消息 */\r\n    send() {\r\n      if (!this.ws || this.ws.readyState !== 1) {\r\n        this.$modal.msgError(\"未连接到服务器\");\r\n        return;\r\n      }\r\n      if (!this.sendText) {\r\n        this.$modal.msgError(\"请输入发送内容\");\r\n        return;\r\n      }\r\n\r\n      // 1.1 先 JSON 化 message 消息内容\r\n      const messageContent = JSON.stringify({\r\n        text: this.sendText,\r\n        toUserId: this.sendUserId\r\n      });\r\n      // 1.2 再 JSON 化整个消息\r\n      const jsonMessage = JSON.stringify({\r\n        type: 'demo-message-send',\r\n        content: messageContent\r\n      });\r\n      // 2. 最后发送消息\r\n      this.ws.send(jsonMessage);\r\n      this.sendText = '';\r\n    }\r\n  },\r\n};\r\n</script>\r\n"]}]}