{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\layout\\components\\Message\\index.vue?vue&type=style&index=0&id=6c658e26&lang=css","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\layout\\components\\Message\\index.vue","mtime":1704630437789},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouZWwtYmFkZ2VfX2NvbnRlbnQuaXMtZml4ZWQgew0KICB0b3A6IDEwcHg7IC8qIOS/neivgeW+veeroOeahOS9jee9riAqLw0KfQ0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA+EA;AACA;AACA","file":"index.vue","sourceRoot":"src/layout/components/Message","sourcesContent":["<template>\r\n  <div>\r\n    <el-popover placement=\"bottom\" width=\"600\" trigger=\"click\">\r\n      <!-- icon 展示 -->\r\n      <el-badge slot=\"reference\" :is-dot=\"unreadCount > 0\" type=\"danger\">\r\n         <svg-icon icon-class=\"message\" @click=\"getList\"/>\r\n      </el-badge>\r\n\r\n      <!-- 弹出列表 -->\r\n      <el-table v-loading=\"loading\" :data=\"list\">\r\n        <el-table-column width=\"120\" property=\"templateNickname\" label=\"发送人\" />\r\n        <el-table-column width=\"180\" property=\"createTime\" label=\"发送时间\">\r\n          <template v-slot=\"scope\">\r\n            <span>{{ parseTime(scope.row.createTime) }}</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"类型\" align=\"center\" prop=\"templateType\" width=\"100\">\r\n          <template v-slot=\"scope\">\r\n            <dict-tag :type=\"DICT_TYPE.SYSTEM_NOTIFY_TEMPLATE_TYPE\" :value=\"scope.row.templateType\" />\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column property=\"templateContent\" label=\"内容\" />\r\n      </el-table>\r\n\r\n      <!-- 更多 -->\r\n      <div style=\"text-align: right; margin-top: 10px\">\r\n        <el-button type=\"primary\" size=\"mini\" @click=\"goMyList\">查看全部</el-button>\r\n      </div>\r\n    </el-popover>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {getUnreadNotifyMessageCount, getUnreadNotifyMessageList} from \"@/api/system/notify/message\";\r\n\r\nexport default {\r\n  name: 'NotifyMessage',\r\n  data() {\r\n    return {\r\n      // 遮罩层\r\n      loading: false,\r\n      // 列表\r\n      list: [],\r\n      // 未读数量,\r\n      unreadCount: 0,\r\n    }\r\n  },\r\n  created() {\r\n    // 首次加载小红点\r\n    this.getUnreadCount()\r\n    // 轮询刷新小红点\r\n    setInterval(() => {\r\n      this.getUnreadCount()\r\n    },1000 * 60 * 2)\r\n  },\r\n  methods: {\r\n    getList: function() {\r\n      this.loading = true;\r\n      getUnreadNotifyMessageList().then(response => {\r\n        this.list = response.data;\r\n        this.loading = false;\r\n        // 强制设置 unreadCount 为 0，避免小红点因为轮询太慢，不消除\r\n        this.unreadCount = 0\r\n      });\r\n    },\r\n    getUnreadCount: function() {\r\n      getUnreadNotifyMessageCount().then(response => {\r\n        this.unreadCount = response.data;\r\n      })\r\n    },\r\n    goMyList: function() {\r\n      this.$router.push({\r\n        name: 'MyNotifyMessage'\r\n      });\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style>\r\n.el-badge__content.is-fixed {\r\n  top: 10px; /* 保证徽章的位置 */\r\n}\r\n</style>\r\n"]}]}