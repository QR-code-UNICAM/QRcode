{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\mp\\draft\\index.vue?vue&type=style&index=0&id=25551112&lang=scss&scoped=true","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\mp\\draft\\index.vue","mtime":1704630438018},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoucGFnaW5hdGlvbiB7DQogIGZsb2F0OiByaWdodDsNCiAgbWFyZ2luLXJpZ2h0OiAyNXB4Ow0KfQ0KDQouYWRkX2J1dCB7DQogIHBhZGRpbmc6IDEwcHg7DQp9DQoNCi5vcGUtcm93IHsNCiAgbWFyZ2luLXRvcDogNXB4Ow0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZWFlYWVhOw0KICBwYWRkaW5nLXRvcDogNXB4Ow0KfQ0KDQouaXRlbS1uYW1lIHsNCiAgZm9udC1zaXplOiAxMnB4Ow0KICBvdmVyZmxvdzogaGlkZGVuOw0KICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCiAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KDQouZWwtdXBsb2FkX190aXAgew0KICBtYXJnaW4tbGVmdDogNXB4Ow0KfQ0KDQovKuaWsOWinuWbvuaWhyovDQoubGVmdCB7DQogIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgd2lkdGg6IDM1JTsNCiAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgbWFyZ2luLXRvcDogMjAwcHg7DQp9DQoNCi5yaWdodCB7DQogIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgd2lkdGg6IDYwJTsNCiAgbWFyZ2luLXRvcDogLTQwcHg7DQp9DQoNCi5hdmF0YXItdXBsb2FkZXIgew0KICB3aWR0aDogMjAlOw0KICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQp9DQoNCi5hdmF0YXItdXBsb2FkZXIgLmVsLXVwbG9hZCB7DQogIGJvcmRlci1yYWRpdXM6IDZweDsNCiAgY3Vyc29yOiBwb2ludGVyOw0KICBwb3NpdGlvbjogcmVsYXRpdmU7DQogIG92ZXJmbG93OiBoaWRkZW47DQogIHRleHQtYWxpZ246IHVuc2V0ICFpbXBvcnRhbnQ7DQp9DQoNCi5hdmF0YXItdXBsb2FkZXIgLmVsLXVwbG9hZDpob3ZlciB7DQogIGJvcmRlci1jb2xvcjogIzE2NWRmZjsNCn0NCg0KLmF2YXRhci11cGxvYWRlci1pY29uIHsNCiAgYm9yZGVyOiAxcHggc29saWQgI2Q5ZDlkOTsNCiAgZm9udC1zaXplOiAyOHB4Ow0KICBjb2xvcjogIzhjOTM5ZDsNCiAgd2lkdGg6IDEyMHB4Ow0KICBoZWlnaHQ6IDEyMHB4Ow0KICBsaW5lLWhlaWdodDogMTIwcHg7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCg0KLmF2YXRhciB7DQogIHdpZHRoOiAyMzBweDsNCiAgaGVpZ2h0OiAxMjBweDsNCn0NCg0KLmF2YXRhcjEgew0KICB3aWR0aDogMTIwcHg7DQogIGhlaWdodDogMTIwcHg7DQp9DQoNCi5kaWdlc3Qgew0KICB3aWR0aDogNjAlOw0KICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogIHZlcnRpY2FsLWFsaWduOiB0b3A7DQp9DQoNCi8q5paw5aKe5Zu+5paHKi8NCi8q54CR5biD5rWB5qC35byPKi8NCi53YXRlcmZhbGwgew0KICB3aWR0aDogMTAwJTsNCiAgY29sdW1uLWdhcDogMTBweDsNCiAgY29sdW1uLWNvdW50OiA1Ow0KICBtYXJnaW46IDAgYXV0bzsNCn0NCg0KLndhdGVyZmFsbC1pdGVtIHsNCiAgcGFkZGluZzogMTBweDsNCiAgbWFyZ2luLWJvdHRvbTogMTBweDsNCiAgYnJlYWstaW5zaWRlOiBhdm9pZDsNCiAgYm9yZGVyOiAxcHggc29saWQgI2VhZWFlYTsNCn0NCg0KcCB7DQogIGxpbmUtaGVpZ2h0OiAzMHB4Ow0KfQ0KDQpAbWVkaWEgKG1pbi13aWR0aDogOTkycHgpIGFuZCAobWF4LXdpZHRoOiAxMzAwcHgpIHsNCiAgLndhdGVyZmFsbCB7DQogICAgY29sdW1uLWNvdW50OiAzOw0KICB9DQogIHAgew0KICAgIGNvbG9yOiByZWQ7DQogIH0NCn0NCg0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSBhbmQgKG1heC13aWR0aDogOTkxcHgpIHsNCiAgLndhdGVyZmFsbCB7DQogICAgY29sdW1uLWNvdW50OiAyOw0KICB9DQogIHAgew0KICAgIGNvbG9yOiBvcmFuZ2U7DQogIH0NCn0NCg0KQG1lZGlhIChtYXgtd2lkdGg6IDc2N3B4KSB7DQogIC53YXRlcmZhbGwgew0KICAgIGNvbHVtbi1jb3VudDogMTsNCiAgfQ0KfQ0KDQovKueAkeW4g+a1geagt+W8jyovDQoubmV3cy1tYWluIHsNCiAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRkZGRjsNCiAgd2lkdGg6IDEwMCU7DQogIG1hcmdpbjogYXV0bzsNCiAgaGVpZ2h0OiAxMjBweDsNCn0NCg0KLm5ld3MtY29udGVudCB7DQogIGJhY2tncm91bmQtY29sb3I6ICNhY2FkYWU7DQogIHdpZHRoOiAxMDAlOw0KICBoZWlnaHQ6IDEyMHB4Ow0KICBwb3NpdGlvbjogcmVsYXRpdmU7DQp9DQoNCi5uZXdzLWNvbnRlbnQtdGl0bGUgew0KICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogIGZvbnQtc2l6ZTogMTVweDsNCiAgY29sb3I6ICNGRkZGRkY7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgbGVmdDogMHB4Ow0KICBib3R0b206IDBweDsNCiAgYmFja2dyb3VuZC1jb2xvcjogYmxhY2s7DQogIHdpZHRoOiA5OCU7DQogIHBhZGRpbmc6IDElOw0KICBvcGFjaXR5OiAwLjY1Ow0KICBvdmVyZmxvdzogaGlkZGVuOw0KICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCiAgaGVpZ2h0OiAyNXB4Ow0KfQ0KDQoubmV3cy1tYWluLWl0ZW0gew0KICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRkZGOw0KICBwYWRkaW5nOiA1cHggMHB4Ow0KICBib3JkZXItdG9wOiAxcHggc29saWQgI2VhZWFlYTsNCiAgd2lkdGg6IDEwMCU7DQogIG1hcmdpbjogYXV0bzsNCn0NCg0KLm5ld3MtY29udGVudC1pdGVtIHsNCiAgcG9zaXRpb246IHJlbGF0aXZlOw0KICBtYXJnaW4tbGVmdDogLTNweA0KfQ0KDQoubmV3cy1jb250ZW50LWl0ZW0tdGl0bGUgew0KICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogIGZvbnQtc2l6ZTogMTJweDsNCiAgd2lkdGg6IDcwJTsNCn0NCg0KLm5ld3MtY29udGVudC1pdGVtLWltZyB7DQogIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgd2lkdGg6IDI1JTsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2FjYWRhZQ0KfQ0KDQouaW5wdXQtdHQgew0KICBwYWRkaW5nOiA1cHg7DQp9DQoNCi5hY3RpdmVBZGROZXdzIHsNCiAgYm9yZGVyOiA1cHggc29saWQgIzJiYjY3MzsNCn0NCg0KLm5ld3MtbWFpbi1wbHVzIHsNCiAgd2lkdGg6IDI4MHB4Ow0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogIG1hcmdpbjogYXV0bzsNCiAgaGVpZ2h0OiA1MHB4Ow0KfQ0KDQouaWNvbi1wbHVzIHsNCiAgbWFyZ2luOiAxMHB4Ow0KICBmb250LXNpemU6IDI1cHg7DQp9DQoNCi5zZWxlY3QtaXRlbSB7DQogIHdpZHRoOiA2MCU7DQogIHBhZGRpbmc6IDEwcHg7DQogIG1hcmdpbjogMCBhdXRvIDEwcHggYXV0bzsNCiAgYm9yZGVyOiAxcHggc29saWQgI2VhZWFlYTsNCn0NCg0KLmZhdGhlciAuY2hpbGQgew0KICBkaXNwbGF5OiBub25lOw0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgYm90dG9tOiAyNXB4Ow0KfQ0KDQouZmF0aGVyOmhvdmVyIC5jaGlsZCB7DQogIGRpc3BsYXk6IGJsb2NrOw0KfQ0KDQoudGh1bWItZGl2IHsNCiAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICB3aWR0aDogMzAlOw0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQp9DQoNCi50aHVtYi1idXQgew0KICBtYXJnaW46IDVweDsNCn0NCg0KLm1hdGVyaWFsLWltZyB7DQogIHdpZHRoOiAxMDAlOw0KICBoZWlnaHQ6IDEwMCU7DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA6cA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/mp/draft","sourcesContent":["<!--\r\nMIT License\r\n\r\nCopyright (c) 2020 www.joolun.com\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n  芋道源码：\r\n  ① 优化代码，和项目的代码保持一致\r\n  ② 清理冗余代码，保证代码整洁\r\n  ③ 增加注释，提升可读性\r\n-->\r\n<template>\r\n  <div class=\"app-container\">\r\n    <doc-alert title=\"公众号图文\" url=\"https://doc.iocoder.cn/mp/article/\" />\r\n\r\n    <!-- 搜索工作栏 -->\r\n    <el-form :model=\"queryParams\" ref=\"queryForm\" size=\"small\" :inline=\"true\" v-show=\"showSearch\" label-width=\"68px\">\r\n      <el-form-item label=\"公众号\" prop=\"accountId\">\r\n        <el-select v-model=\"queryParams.accountId\" placeholder=\"请选择公众号\">\r\n          <el-option v-for=\"item in accounts\" :key=\"parseInt(item.id)\" :label=\"item.name\" :value=\"parseInt(item.id)\" />\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" icon=\"el-icon-search\" @click=\"handleQuery\">搜索</el-button>\r\n        <el-button icon=\"el-icon-refresh\" @click=\"resetQuery\">重置</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n\r\n    <!-- 操作工具栏 -->\r\n    <el-row :gutter=\"10\" class=\"mb8\">\r\n      <el-col :span=\"1.5\">\r\n        <el-button type=\"primary\" plain icon=\"el-icon-plus\" size=\"mini\" @click=\"handleAdd\"\r\n                   v-hasPermi=\"['mp:draft:create']\">新增\r\n        </el-button>\r\n      </el-col>\r\n      <right-toolbar :showSearch.sync=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\r\n    </el-row>\r\n\r\n    <!-- 列表 -->\r\n    <div class=\"waterfall\" v-loading=\"loading\">\r\n      <div v-if=\"item.content && item.content.newsItem\" class=\"waterfall-item\" v-for=\"item in list\"\r\n           :key='item.articleId'>\r\n        <wx-news :articles=\"item.content.newsItem\" />\r\n        <!-- 操作按钮 -->\r\n        <el-row class=\"ope-row\">\r\n          <el-button type=\"success\" circle @click=\"handlePublish(item)\" v-hasPermi=\"['mp:free-publish:submit']\">发布</el-button>\r\n          <el-button type=\"primary\" icon=\"el-icon-edit\" circle @click=\"handleUpdate(item)\" v-hasPermi=\"['mp:draft:update']\" />\r\n          <el-button type=\"danger\" icon=\"el-icon-delete\" circle @click=\"handleDelete(item)\" v-hasPermi=\"['mp:draft:delete']\" />\r\n        </el-row>\r\n      </div>\r\n    </div>\r\n    <!-- 分页记录 -->\r\n    <pagination v-show=\"total > 0\" :total=\"total\" :page.sync=\"queryParams.pageNo\" :limit.sync=\"queryParams.pageSize\"\r\n                @pagination=\"getList\"/>\r\n\r\n    <!-- 添加或修改草稿对话框 -->\r\n    <el-dialog :title=\"operateMaterial === 'add' ? '新建图文' : '修改图文'\"\r\n               append-to-body width=\"80%\" top=\"20px\" :visible.sync=\"dialogNewsVisible\"\r\n               :before-close=\"dialogNewsClose\" :close-on-click-modal=\"false\">\r\n      <div class=\"left\">\r\n        <div class=\"select-item\">\r\n          <div v-for=\"(news, index) in articlesAdd\" :key='news.id'>\r\n            <div class=\"news-main father\" v-if=\"index === 0\" :class=\"{'activeAddNews': isActiveAddNews === index}\"\r\n                 @click=\"activeNews(index)\">\r\n              <div class=\"news-content\">\r\n                <img class=\"material-img\" v-if=\"news.thumbUrl\" :src=\"news.thumbUrl\"/>\r\n                <div class=\"news-content-title\">{{news.title}}</div>\r\n              </div>\r\n              <div class=\"child\" v-if=\"articlesAdd.length>1\">\r\n                <el-button type=\"mini\" icon=\"el-icon-sort-down\" @click=\"downNews(index)\">下移</el-button>\r\n                <el-button v-if=\"operateMaterial === 'add'\" type=\"mini\" icon=\"el-icon-delete\"\r\n                           @click=\"minusNews(index)\">删除\r\n                </el-button>\r\n              </div>\r\n            </div>\r\n            <div class=\"news-main-item father\" v-if=\"index>0\" :class=\"{'activeAddNews': isActiveAddNews === index}\"\r\n                 @click=\"activeNews(index)\">\r\n              <div class=\"news-content-item\">\r\n                <div class=\"news-content-item-title \">{{news.title}}</div>\r\n                <div class=\"news-content-item-img\">\r\n                  <img class=\"material-img\" v-if=\"news.thumbUrl\" :src=\"news.thumbUrl\" height=\"100%\"/>\r\n                </div>\r\n              </div>\r\n              <div class=\"child\">\r\n                <el-button v-if=\"articlesAdd.length > index+1\" type=\"mini\" icon=\"el-icon-sort-down\"\r\n                           @click=\"downNews(index)\">下移\r\n                </el-button>\r\n                <el-button type=\"mini\" icon=\"el-icon-sort-up\" @click=\"upNews(index)\">上移</el-button>\r\n                <el-button v-if=\"operateMaterial=== 'add'\" type=\"mini\" icon=\"el-icon-delete\"\r\n                           @click=\"minusNews(index)\">删除\r\n                </el-button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"news-main-plus\" @click=\"plusNews\" v-if=\"articlesAdd.length<8 && operateMaterial==='add'\">\r\n            <i class=\"el-icon-circle-plus icon-plus\"></i>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"right\" v-loading=\"addMaterialLoading\" v-if=\"articlesAdd.length > 0\">\r\n        <br /> <br /> <br /> <br />\r\n        <!-- 标题、作者、原文地址 -->\r\n        <el-input v-model=\"articlesAdd[isActiveAddNews].title\" placeholder=\"请输入标题（必填）\" />\r\n        <el-input v-model=\"articlesAdd[isActiveAddNews].author\" placeholder=\"请输入作者\" style=\"margin-top: 5px;\" />\r\n        <el-input v-model=\"articlesAdd[isActiveAddNews].contentSourceUrl\" placeholder=\"请输入原文地址\" style=\"margin-top: 5px;\" />\r\n        <!-- 封面和摘要 -->\r\n        <div class=\"input-tt\">封面和摘要：</div>\r\n        <div>\r\n          <div class=\"thumb-div\">\r\n            <img class=\"material-img\" v-if=\"articlesAdd[isActiveAddNews].thumbUrl\"\r\n                 :src=\"articlesAdd[isActiveAddNews].thumbUrl\" :class=\"isActiveAddNews === 0 ? 'avatar':'avatar1'\">\r\n            <i v-else class=\"el-icon-plus avatar-uploader-icon\"\r\n               :class=\"isActiveAddNews === 0 ? 'avatar':'avatar1'\"></i>\r\n            <div class=\"thumb-but\">\r\n              <el-upload :action=\"actionUrl\" :headers=\"headers\" multiple :limit=\"1\" :file-list=\"fileList\" :data=\"uploadData\"\r\n                         :before-upload=\"beforeThumbImageUpload\" :on-success=\"handleUploadSuccess\">\r\n                <el-button slot=\"trigger\" size=\"mini\" type=\"primary\">本地上传</el-button>\r\n                <el-button size=\"mini\" type=\"primary\" @click=\"openMaterial\" style=\"margin-left: 5px\">素材库选择</el-button>\r\n                <div slot=\"tip\" class=\"el-upload__tip\">支持 bmp/png/jpeg/jpg/gif 格式，大小不超过 2M</div>\r\n              </el-upload>\r\n            </div>\r\n            <el-dialog title=\"选择图片\" :visible.sync=\"dialogImageVisible\" width=\"80%\" append-to-body>\r\n              <wx-material-select ref=\"materialSelect\" :objData=\"{type: 'image', accountId: this.queryParams.accountId}\"\r\n                                  @selectMaterial=\"selectMaterial\" />\r\n            </el-dialog>\r\n          </div>\r\n          <el-input :rows=\"8\" type=\"textarea\" v-model=\"articlesAdd[isActiveAddNews].digest\" placeholder=\"请输入摘要\"\r\n                    class=\"digest\" maxlength=\"120\" style=\"float: right\" />\r\n        </div>\r\n        <!--富文本编辑器组件-->\r\n        <el-row>\r\n          <wx-editor v-model=\"articlesAdd[isActiveAddNews].content\" :account-id=\"this.uploadData.accountId\"\r\n                     v-if=\"hackResetEditor\"/>\r\n        </el-row>\r\n      </div>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"dialogNewsVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"submitForm\">提 交</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport WxEditor from '@/views/mp/components/wx-editor/WxEditor.vue';\r\nimport WxNews from '@/views/mp/components/wx-news/main.vue';\r\nimport WxMaterialSelect from '@/views/mp/components/wx-material-select/main.vue'\r\nimport { getAccessToken } from '@/utils/auth'\r\nimport {createDraft, deleteDraft, getDraftPage, updateDraft} from \"@/api/mp/draft\";\r\nimport { getSimpleAccounts } from \"@/api/mp/account\";\r\nimport {deleteFreePublish, submitFreePublish} from \"@/api/mp/freePublish\";\r\n\r\nexport default {\r\n  name: 'MpDraft',\r\n  components: {\r\n    WxEditor,\r\n    WxNews,\r\n    WxMaterialSelect\r\n  },\r\n  data() {\r\n    return {\r\n      // 遮罩层\r\n      loading: false,\r\n      // 显示搜索条件\r\n      showSearch: true,\r\n      // 总条数\r\n      total: 0,\r\n      // 数据列表\r\n      list: [],\r\n      queryParams: {\r\n        pageNo: 1,\r\n        pageSize: 10,\r\n        accountId: undefined,\r\n      },\r\n\r\n      // ========== 文件上传 ==========\r\n      actionUrl: process.env.VUE_APP_BASE_API + \"/admin-api/mp/material/upload-permanent\", // 上传永久素材的地址\r\n      headers: { Authorization: \"Bearer \" + getAccessToken() }, // 设置上传的请求头部\r\n      fileList: [],\r\n      uploadData: {\r\n        \"type\": 'image',\r\n        // \"accountId\": 1,\r\n      },\r\n\r\n      // ========== 草稿新建 or 修改 ==========\r\n      dialogNewsVisible: false,\r\n      addMaterialLoading: false, // 添加草稿的 loading 标识\r\n      articlesAdd: [],\r\n      isActiveAddNews: 0,\r\n      dialogImageVisible: false,\r\n      operateMaterial: 'add',\r\n      articlesMediaId: '',\r\n      hackResetEditor: false,\r\n\r\n      // 公众号账号列表\r\n      accounts: [],\r\n    }\r\n  },\r\n  created() {\r\n    getSimpleAccounts().then(response => {\r\n      this.accounts = response.data;\r\n      // 默认选中第一个\r\n      if (this.accounts.length > 0) {\r\n        this.setAccountId(this.accounts[0].id);\r\n      }\r\n      // 加载数据\r\n      this.getList();\r\n    })\r\n  },\r\n  methods: {\r\n    // ======================== 列表查询 ========================\r\n    /** 设置账号编号 */\r\n    setAccountId(accountId) {\r\n      this.queryParams.accountId = accountId;\r\n      this.uploadData.accountId = accountId;\r\n    },\r\n    /** 查询列表 */\r\n    getList() {\r\n      // 如果没有选中公众号账号，则进行提示。\r\n      if (!this.queryParams.accountId) {\r\n        this.$message.error('未选中公众号，无法查询草稿箱')\r\n        return false\r\n      }\r\n\r\n      this.loading = true\r\n      getDraftPage(this.queryParams).then(response => {\r\n        // 将 thumbUrl 转成 picUrl，保证 wx-news 组件可以预览封面\r\n        response.data.list.forEach(item => {\r\n          const newsItem = item.content.newsItem;\r\n          newsItem.forEach(article => {\r\n            article.picUrl = article.thumbUrl;\r\n          })\r\n        })\r\n        this.list = response.data.list\r\n        this.total = response.data.total\r\n      }).finally(() => {\r\n        this.loading = false\r\n      })\r\n    },\r\n    /** 搜索按钮操作 */\r\n    handleQuery() {\r\n      this.queryParams.pageNo = 1\r\n      // 默认选中第一个\r\n      if (this.queryParams.accountId) {\r\n        this.setAccountId(this.queryParams.accountId)\r\n      }\r\n      this.getList()\r\n    },\r\n    /** 重置按钮操作 */\r\n    resetQuery() {\r\n      this.resetForm('queryForm')\r\n      // 默认选中第一个\r\n      if (this.accounts.length > 0) {\r\n        this.setAccountId(this.accounts[0].id)\r\n      }\r\n      this.handleQuery()\r\n    },\r\n\r\n    // ======================== 新增/修改草稿 ========================\r\n    /** 新增按钮操作 */\r\n    handleAdd() {\r\n      this.resetEditor();\r\n      this.reset();\r\n      // 打开表单，并设置初始化\r\n      this.operateMaterial = 'add'\r\n      this.dialogNewsVisible = true\r\n    },\r\n    /** 更新按钮操作 */\r\n    handleUpdate(item){\r\n      this.resetEditor();\r\n      this.reset();\r\n      this.articlesMediaId = item.mediaId\r\n      this.articlesAdd = JSON.parse(JSON.stringify(item.content.newsItem))\r\n      // 打开表单，并设置初始化\r\n      this.operateMaterial = 'edit'\r\n      this.dialogNewsVisible = true\r\n    },\r\n    /** 提交按钮 */\r\n    submitForm() {\r\n      this.addMaterialLoading = true\r\n      if (this.operateMaterial === 'add') {\r\n        createDraft(this.queryParams.accountId, this.articlesAdd).then(response => {\r\n          this.$modal.msgSuccess(\"新增成功\");\r\n          this.dialogNewsVisible = false;\r\n          this.getList()\r\n        }).finally(() => {\r\n          this.addMaterialLoading = false\r\n        })\r\n      } else {\r\n        updateDraft(this.queryParams.accountId, this.articlesMediaId, this.articlesAdd).then(response => {\r\n          this.$modal.msgSuccess(\"更新成功\");\r\n          this.dialogNewsVisible = false;\r\n          this.getList()\r\n        }).finally(() => {\r\n          this.addMaterialLoading = false\r\n        })\r\n      }\r\n    },\r\n    // 关闭弹窗\r\n    dialogNewsClose(done) {\r\n      this.$modal.confirm('修改内容可能还未保存，确定关闭吗?').then(() => {\r\n       this.reset()\r\n        this.resetEditor()\r\n        done()\r\n      }).catch(() => {})\r\n    },\r\n    // 表单重置\r\n    reset() {\r\n      this.isActiveAddNews = 0\r\n      this.articlesAdd = [this.buildEmptyArticle()]\r\n    },\r\n    // 表单 Editor 重置\r\n    resetEditor() {\r\n      this.hackResetEditor = false // 销毁组件\r\n      this.$nextTick(() => {\r\n        this.hackResetEditor = true // 重建组件\r\n      })\r\n    },\r\n    // 将图文向下移动\r\n    downNews(index) {\r\n      let temp = this.articlesAdd[index]\r\n      this.articlesAdd[index] = this.articlesAdd[index+1]\r\n      this.articlesAdd[index + 1] = temp\r\n      this.isActiveAddNews = index + 1\r\n    },\r\n    // 将图文向上移动\r\n    upNews(index) {\r\n      let temp = this.articlesAdd[index]\r\n      this.articlesAdd[index] = this.articlesAdd[index - 1]\r\n      this.articlesAdd[index - 1] = temp\r\n      this.isActiveAddNews = index - 1\r\n    },\r\n    // 选中指定 index 的图文\r\n    activeNews(index) {\r\n      this.resetEditor();\r\n      this.isActiveAddNews = index\r\n    },\r\n    // 删除指定 index 的图文\r\n    minusNews(index) {\r\n      this.$modal.confirm('确定删除该图文吗?').then(() => {\r\n        this.articlesAdd.splice(index,1);\r\n        if (this.isActiveAddNews ===  index) {\r\n          this.isActiveAddNews = 0\r\n        }\r\n      }).catch(() => {})\r\n    },\r\n    // 添加一个图文\r\n    plusNews() {\r\n      this.articlesAdd.push(this.buildEmptyArticle())\r\n      this.isActiveAddNews = this.articlesAdd.length - 1\r\n    },\r\n    // 创建空的 article\r\n    buildEmptyArticle() {\r\n      return {\r\n        \"title\": '',\r\n        \"thumbMediaId\": '',\r\n        \"author\": '',\r\n        \"digest\": '',\r\n        \"showCoverPic\": '',\r\n        \"content\": '',\r\n        \"contentSourceUrl\": '',\r\n        \"needOpenComment\":'',\r\n        \"onlyFansCanComment\":'',\r\n        \"thumbUrl\":''\r\n      }\r\n    },\r\n\r\n    // ======================== 文件上传 ========================\r\n    beforeThumbImageUpload(file) {\r\n      this.addMaterialLoading = true\r\n      const isType = file.type === 'image/jpeg'\r\n          || file.type === 'image/png'\r\n          || file.type === 'image/gif'\r\n          || file.type === 'image/bmp'\r\n          || file.type === 'image/jpg';\r\n      if (!isType) {\r\n        this.$message.error('上传图片格式不对!')\r\n        this.addMaterialLoading = false\r\n        return false;\r\n      }\r\n      const isLt = file.size / 1024 / 1024 < 2\r\n      if (!isLt) {\r\n        this.$message.error('上传图片大小不能超过 2M!')\r\n        this.addMaterialLoading = false\r\n        return false;\r\n      }\r\n      // 校验通过\r\n      return true;\r\n    },\r\n    handleUploadSuccess(response, file, fileList) {\r\n      this.addMaterialLoading = false // 关闭 loading\r\n      if (response.code !== 0) {\r\n        this.$message.error('上传出错：' + response.msg)\r\n        return false;\r\n      }\r\n\r\n      // 重置上传文件的表单\r\n      this.fileList = []\r\n\r\n      // 设置草稿的封面字段\r\n      this.articlesAdd[this.isActiveAddNews].thumbMediaId = response.data.mediaId\r\n      this.articlesAdd[this.isActiveAddNews].thumbUrl = response.data.url\r\n    },\r\n    // 选择 or 上传完素材，设置回草稿\r\n    selectMaterial(item) {\r\n      this.dialogImageVisible = false\r\n      this.articlesAdd[this.isActiveAddNews].thumbMediaId = item.mediaId\r\n      this.articlesAdd[this.isActiveAddNews].thumbUrl = item.url\r\n    },\r\n    // 打开素材选择\r\n    openMaterial() {\r\n      this.dialogImageVisible = true\r\n      try {\r\n        this.$refs['materialSelect'].queryParams.accountId = this.queryParams.accountId // 强制设置下 accountId，避免二次查询不对\r\n        this.$refs['materialSelect'].handleQuery(); // 刷新列表，失败也无所谓\r\n      } catch (e) {}\r\n    },\r\n\r\n    // ======================== 草稿箱发布 ========================\r\n    handlePublish(item) {\r\n      const accountId = this.queryParams.accountId;\r\n      const mediaId = item.mediaId;\r\n      const content = '你正在通过发布的方式发表内容。 发布不占用群发次数，一天可多次发布。已发布内容不会推送给用户，也不会展示在公众号主页中。 发布后，你可以前往发表记录获取链接，也可以将发布内容添加到自定义菜单、自动回复、话题和页面模板中。';\r\n      this.$modal.confirm(content).then(function() {\r\n        return submitFreePublish(accountId, mediaId);\r\n      }).then(() => {\r\n        this.getList();\r\n        this.$modal.msgSuccess(\"发布成功\");\r\n      }).catch(() => {});\r\n    },\r\n    handleDelete(item) {\r\n      const accountId = this.queryParams.accountId;\r\n      const mediaId = item.mediaId;\r\n      this.$modal.confirm('此操作将永久删除该草稿, 是否继续?').then(function() {\r\n        return deleteDraft(accountId, mediaId);\r\n      }).then(() => {\r\n        this.getList();\r\n        this.$modal.msgSuccess(\"删除成功\");\r\n      }).catch(() => {});\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.pagination {\r\n  float: right;\r\n  margin-right: 25px;\r\n}\r\n\r\n.add_but {\r\n  padding: 10px;\r\n}\r\n\r\n.ope-row {\r\n  margin-top: 5px;\r\n  text-align: center;\r\n  border-top: 1px solid #eaeaea;\r\n  padding-top: 5px;\r\n}\r\n\r\n.item-name {\r\n  font-size: 12px;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n  text-align: center;\r\n}\r\n\r\n.el-upload__tip {\r\n  margin-left: 5px;\r\n}\r\n\r\n/*新增图文*/\r\n.left {\r\n  display: inline-block;\r\n  width: 35%;\r\n  vertical-align: top;\r\n  margin-top: 200px;\r\n}\r\n\r\n.right {\r\n  display: inline-block;\r\n  width: 60%;\r\n  margin-top: -40px;\r\n}\r\n\r\n.avatar-uploader {\r\n  width: 20%;\r\n  display: inline-block;\r\n}\r\n\r\n.avatar-uploader .el-upload {\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\r\n  text-align: unset !important;\r\n}\r\n\r\n.avatar-uploader .el-upload:hover {\r\n  border-color: #165dff;\r\n}\r\n\r\n.avatar-uploader-icon {\r\n  border: 1px solid #d9d9d9;\r\n  font-size: 28px;\r\n  color: #8c939d;\r\n  width: 120px;\r\n  height: 120px;\r\n  line-height: 120px;\r\n  text-align: center;\r\n}\r\n\r\n.avatar {\r\n  width: 230px;\r\n  height: 120px;\r\n}\r\n\r\n.avatar1 {\r\n  width: 120px;\r\n  height: 120px;\r\n}\r\n\r\n.digest {\r\n  width: 60%;\r\n  display: inline-block;\r\n  vertical-align: top;\r\n}\r\n\r\n/*新增图文*/\r\n/*瀑布流样式*/\r\n.waterfall {\r\n  width: 100%;\r\n  column-gap: 10px;\r\n  column-count: 5;\r\n  margin: 0 auto;\r\n}\r\n\r\n.waterfall-item {\r\n  padding: 10px;\r\n  margin-bottom: 10px;\r\n  break-inside: avoid;\r\n  border: 1px solid #eaeaea;\r\n}\r\n\r\np {\r\n  line-height: 30px;\r\n}\r\n\r\n@media (min-width: 992px) and (max-width: 1300px) {\r\n  .waterfall {\r\n    column-count: 3;\r\n  }\r\n  p {\r\n    color: red;\r\n  }\r\n}\r\n\r\n@media (min-width: 768px) and (max-width: 991px) {\r\n  .waterfall {\r\n    column-count: 2;\r\n  }\r\n  p {\r\n    color: orange;\r\n  }\r\n}\r\n\r\n@media (max-width: 767px) {\r\n  .waterfall {\r\n    column-count: 1;\r\n  }\r\n}\r\n\r\n/*瀑布流样式*/\r\n.news-main {\r\n  background-color: #FFFFFF;\r\n  width: 100%;\r\n  margin: auto;\r\n  height: 120px;\r\n}\r\n\r\n.news-content {\r\n  background-color: #acadae;\r\n  width: 100%;\r\n  height: 120px;\r\n  position: relative;\r\n}\r\n\r\n.news-content-title {\r\n  display: inline-block;\r\n  font-size: 15px;\r\n  color: #FFFFFF;\r\n  position: absolute;\r\n  left: 0px;\r\n  bottom: 0px;\r\n  background-color: black;\r\n  width: 98%;\r\n  padding: 1%;\r\n  opacity: 0.65;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n  height: 25px;\r\n}\r\n\r\n.news-main-item {\r\n  background-color: #FFFFFF;\r\n  padding: 5px 0px;\r\n  border-top: 1px solid #eaeaea;\r\n  width: 100%;\r\n  margin: auto;\r\n}\r\n\r\n.news-content-item {\r\n  position: relative;\r\n  margin-left: -3px\r\n}\r\n\r\n.news-content-item-title {\r\n  display: inline-block;\r\n  font-size: 12px;\r\n  width: 70%;\r\n}\r\n\r\n.news-content-item-img {\r\n  display: inline-block;\r\n  width: 25%;\r\n  background-color: #acadae\r\n}\r\n\r\n.input-tt {\r\n  padding: 5px;\r\n}\r\n\r\n.activeAddNews {\r\n  border: 5px solid #2bb673;\r\n}\r\n\r\n.news-main-plus {\r\n  width: 280px;\r\n  text-align: center;\r\n  margin: auto;\r\n  height: 50px;\r\n}\r\n\r\n.icon-plus {\r\n  margin: 10px;\r\n  font-size: 25px;\r\n}\r\n\r\n.select-item {\r\n  width: 60%;\r\n  padding: 10px;\r\n  margin: 0 auto 10px auto;\r\n  border: 1px solid #eaeaea;\r\n}\r\n\r\n.father .child {\r\n  display: none;\r\n  text-align: center;\r\n  position: relative;\r\n  bottom: 25px;\r\n}\r\n\r\n.father:hover .child {\r\n  display: block;\r\n}\r\n\r\n.thumb-div {\r\n  display: inline-block;\r\n  width: 30%;\r\n  text-align: center;\r\n}\r\n\r\n.thumb-but {\r\n  margin: 5px;\r\n}\r\n\r\n.material-img {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n</style>\r\n"]}]}