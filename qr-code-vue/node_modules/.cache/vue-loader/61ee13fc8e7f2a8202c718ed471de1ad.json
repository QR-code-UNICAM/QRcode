{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\layout\\components\\Message\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\layout\\components\\Message\\index.vue","mtime":1704630437789},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQge2dldFVucmVhZE5vdGlmeU1lc3NhZ2VDb3VudCwgZ2V0VW5yZWFkTm90aWZ5TWVzc2FnZUxpc3R9IGZyb20gIkAvYXBpL3N5c3RlbS9ub3RpZnkvbWVzc2FnZSI7DQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ05vdGlmeU1lc3NhZ2UnLA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICAvLyDpga7nvanlsYINCiAgICAgIGxvYWRpbmc6IGZhbHNlLA0KICAgICAgLy8g5YiX6KGoDQogICAgICBsaXN0OiBbXSwNCiAgICAgIC8vIOacquivu+aVsOmHjywNCiAgICAgIHVucmVhZENvdW50OiAwLA0KICAgIH0NCiAgfSwNCiAgY3JlYXRlZCgpIHsNCiAgICAvLyDpppbmrKHliqDovb3lsI/nuqLngrkNCiAgICB0aGlzLmdldFVucmVhZENvdW50KCkNCiAgICAvLyDova7or6LliLfmlrDlsI/nuqLngrkNCiAgICBzZXRJbnRlcnZhbCgoKSA9PiB7DQogICAgICB0aGlzLmdldFVucmVhZENvdW50KCkNCiAgICB9LDEwMDAgKiA2MCAqIDIpDQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBnZXRMaXN0OiBmdW5jdGlvbigpIHsNCiAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7DQogICAgICBnZXRVbnJlYWROb3RpZnlNZXNzYWdlTGlzdCgpLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICB0aGlzLmxpc3QgPSByZXNwb25zZS5kYXRhOw0KICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsNCiAgICAgICAgLy8g5by65Yi26K6+572uIHVucmVhZENvdW50IOS4uiAw77yM6YG/5YWN5bCP57qi54K55Zug5Li66L2u6K+i5aSq5oWi77yM5LiN5raI6ZmkDQogICAgICAgIHRoaXMudW5yZWFkQ291bnQgPSAwDQogICAgICB9KTsNCiAgICB9LA0KICAgIGdldFVucmVhZENvdW50OiBmdW5jdGlvbigpIHsNCiAgICAgIGdldFVucmVhZE5vdGlmeU1lc3NhZ2VDb3VudCgpLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICB0aGlzLnVucmVhZENvdW50ID0gcmVzcG9uc2UuZGF0YTsNCiAgICAgIH0pDQogICAgfSwNCiAgICBnb015TGlzdDogZnVuY3Rpb24oKSB7DQogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7DQogICAgICAgIG5hbWU6ICdNeU5vdGlmeU1lc3NhZ2UnDQogICAgICB9KTsNCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAiCA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/layout/components/Message","sourcesContent":["<template>\r\n  <div>\r\n    <el-popover placement=\"bottom\" width=\"600\" trigger=\"click\">\r\n      <!-- icon 展示 -->\r\n      <el-badge slot=\"reference\" :is-dot=\"unreadCount > 0\" type=\"danger\">\r\n         <svg-icon icon-class=\"message\" @click=\"getList\"/>\r\n      </el-badge>\r\n\r\n      <!-- 弹出列表 -->\r\n      <el-table v-loading=\"loading\" :data=\"list\">\r\n        <el-table-column width=\"120\" property=\"templateNickname\" label=\"发送人\" />\r\n        <el-table-column width=\"180\" property=\"createTime\" label=\"发送时间\">\r\n          <template v-slot=\"scope\">\r\n            <span>{{ parseTime(scope.row.createTime) }}</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"类型\" align=\"center\" prop=\"templateType\" width=\"100\">\r\n          <template v-slot=\"scope\">\r\n            <dict-tag :type=\"DICT_TYPE.SYSTEM_NOTIFY_TEMPLATE_TYPE\" :value=\"scope.row.templateType\" />\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column property=\"templateContent\" label=\"内容\" />\r\n      </el-table>\r\n\r\n      <!-- 更多 -->\r\n      <div style=\"text-align: right; margin-top: 10px\">\r\n        <el-button type=\"primary\" size=\"mini\" @click=\"goMyList\">查看全部</el-button>\r\n      </div>\r\n    </el-popover>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {getUnreadNotifyMessageCount, getUnreadNotifyMessageList} from \"@/api/system/notify/message\";\r\n\r\nexport default {\r\n  name: 'NotifyMessage',\r\n  data() {\r\n    return {\r\n      // 遮罩层\r\n      loading: false,\r\n      // 列表\r\n      list: [],\r\n      // 未读数量,\r\n      unreadCount: 0,\r\n    }\r\n  },\r\n  created() {\r\n    // 首次加载小红点\r\n    this.getUnreadCount()\r\n    // 轮询刷新小红点\r\n    setInterval(() => {\r\n      this.getUnreadCount()\r\n    },1000 * 60 * 2)\r\n  },\r\n  methods: {\r\n    getList: function() {\r\n      this.loading = true;\r\n      getUnreadNotifyMessageList().then(response => {\r\n        this.list = response.data;\r\n        this.loading = false;\r\n        // 强制设置 unreadCount 为 0，避免小红点因为轮询太慢，不消除\r\n        this.unreadCount = 0\r\n      });\r\n    },\r\n    getUnreadCount: function() {\r\n      getUnreadNotifyMessageCount().then(response => {\r\n        this.unreadCount = response.data;\r\n      })\r\n    },\r\n    goMyList: function() {\r\n      this.$router.push({\r\n        name: 'MyNotifyMessage'\r\n      });\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style>\r\n.el-badge__content.is-fixed {\r\n  top: 10px; /* 保证徽章的位置 */\r\n}\r\n</style>\r\n"]}]}