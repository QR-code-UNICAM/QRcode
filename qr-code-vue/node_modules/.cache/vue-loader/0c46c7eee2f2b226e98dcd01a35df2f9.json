{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\components\\bpmnProcessDesigner\\package\\penal\\task\\task-components\\ReceiveTask.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\components\\bpmnProcessDesigner\\package\\penal\\task\\task-components\\ReceiveTask.vue","mtime":1704630437728},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJSZWNlaXZlVGFzayIsDQogIHByb3BzOiB7DQogICAgaWQ6IFN0cmluZywNCiAgICB0eXBlOiBTdHJpbmcNCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgYmluZE1lc3NhZ2VJZDogIiIsDQogICAgICBuZXdNZXNzYWdlRm9ybToge30sDQogICAgICBtZXNzYWdlTWFwOiB7fSwNCiAgICAgIG1lc3NhZ2VNb2RlbFZpc2libGU6IGZhbHNlDQogICAgfTsNCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICBpZDogew0KICAgICAgaW1tZWRpYXRlOiB0cnVlLA0KICAgICAgaGFuZGxlcigpIHsNCiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gdGhpcy5nZXRCaW5kTWVzc2FnZSgpKTsNCiAgICAgIH0NCiAgICB9DQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgdGhpcy5icG1uTWVzc2FnZVJlZnNNYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOw0KICAgIHRoaXMuYnBtblJvb3RFbGVtZW50cyA9IHdpbmRvdy5icG1uSW5zdGFuY2VzLm1vZGVsZXIuZ2V0RGVmaW5pdGlvbnMoKS5yb290RWxlbWVudHM7DQogICAgdGhpcy5icG1uUm9vdEVsZW1lbnRzDQogICAgICAuZmlsdGVyKGVsID0+IGVsLiR0eXBlID09PSAiYnBtbjpNZXNzYWdlIikNCiAgICAgIC5mb3JFYWNoKG0gPT4gew0KICAgICAgICB0aGlzLmJwbW5NZXNzYWdlUmVmc01hcFttLmlkXSA9IG07DQogICAgICAgIHRoaXMuJHNldCh0aGlzLm1lc3NhZ2VNYXAsIG0uaWQsIG0ubmFtZSk7DQogICAgICB9KTsNCiAgICB0aGlzLiRzZXQodGhpcy5tZXNzYWdlTWFwLCAiLTEiLCAi5pegIik7IC8vIOa3u+WKoOS4gOS4quepuuWvueixoe+8jOS/neivgeWPr+S7peWPlua2iOWOn+a2iOaBr+e7keWumg0KICB9LA0KICBtZXRob2RzOiB7DQogICAgZ2V0QmluZE1lc3NhZ2UoKSB7DQogICAgICB0aGlzLmJwbW5FbGVtZW50ID0gd2luZG93LmJwbW5JbnN0YW5jZXMuYnBtbkVsZW1lbnQ7DQogICAgICB0aGlzLmJpbmRNZXNzYWdlSWQgPSB0aGlzLmJwbW5FbGVtZW50LmJ1c2luZXNzT2JqZWN0Py5tZXNzYWdlUmVmPy5pZCB8fCAiLTEiOw0KICAgIH0sDQogICAgb3Blbk1lc3NhZ2VNb2RlbCgpIHsNCiAgICAgIHRoaXMubWVzc2FnZU1vZGVsVmlzaWJsZSA9IHRydWU7DQogICAgICB0aGlzLm5ld01lc3NhZ2VGb3JtID0ge307DQogICAgfSwNCiAgICBjcmVhdGVOZXdNZXNzYWdlKCkgew0KICAgICAgaWYgKHRoaXMubWVzc2FnZU1hcFt0aGlzLm5ld01lc3NhZ2VGb3JtLmlkXSkgew0KICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLor6Xmtojmga/lt7LlrZjlnKjvvIzor7fkv67mlLlpZOWQjumHjeaWsOS/neWtmCIpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICBjb25zdCBuZXdNZXNzYWdlID0gd2luZG93LmJwbW5JbnN0YW5jZXMubW9kZGxlLmNyZWF0ZSgiYnBtbjpNZXNzYWdlIiwgdGhpcy5uZXdNZXNzYWdlRm9ybSk7DQogICAgICB0aGlzLmJwbW5Sb290RWxlbWVudHMucHVzaChuZXdNZXNzYWdlKTsNCiAgICAgIHRoaXMuJHNldCh0aGlzLm1lc3NhZ2VNYXAsIHRoaXMubmV3TWVzc2FnZUZvcm0uaWQsIHRoaXMubmV3TWVzc2FnZUZvcm0ubmFtZSk7DQogICAgICB0aGlzLmJwbW5NZXNzYWdlUmVmc01hcFt0aGlzLm5ld01lc3NhZ2VGb3JtLmlkXSA9IG5ld01lc3NhZ2U7DQogICAgICB0aGlzLm1lc3NhZ2VNb2RlbFZpc2libGUgPSBmYWxzZTsNCiAgICB9LA0KICAgIHVwZGF0ZVRhc2tNZXNzYWdlKG1lc3NhZ2VJZCkgew0KICAgICAgaWYgKG1lc3NhZ2VJZCA9PT0gIi0xIikgew0KICAgICAgICB3aW5kb3cuYnBtbkluc3RhbmNlcy5tb2RlbGluZy51cGRhdGVQcm9wZXJ0aWVzKHRoaXMuYnBtbkVsZW1lbnQsIHsNCiAgICAgICAgICBtZXNzYWdlUmVmOiBudWxsDQogICAgICAgIH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgd2luZG93LmJwbW5JbnN0YW5jZXMubW9kZWxpbmcudXBkYXRlUHJvcGVydGllcyh0aGlzLmJwbW5FbGVtZW50LCB7DQogICAgICAgICAgbWVzc2FnZVJlZjogdGhpcy5icG1uTWVzc2FnZVJlZnNNYXBbbWVzc2FnZUlkXQ0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9DQogIH0sDQogIGJlZm9yZURlc3Ryb3koKSB7DQogICAgdGhpcy5icG1uRWxlbWVudCA9IG51bGw7DQogIH0NCn07DQo="},{"version":3,"sources":["ReceiveTask.vue"],"names":[],"mappings":";AA2BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ReceiveTask.vue","sourceRoot":"src/components/bpmnProcessDesigner/package/penal/task/task-components","sourcesContent":["<template>\r\n  <div style=\"margin-top: 16px\">\r\n    <el-form-item label=\"消息实例\">\r\n      <div style=\"display: flex; align-items: center; justify-content: space-between; flex-wrap: nowrap\">\r\n        <el-select v-model=\"bindMessageId\" @change=\"updateTaskMessage\">\r\n          <el-option v-for=\"id in Object.keys(messageMap)\" :value=\"id\" :label=\"messageMap[id]\" :key=\"id\" />\r\n        </el-select>\r\n        <el-button size=\"mini\" type=\"primary\" icon=\"el-icon-plus\" style=\"margin-left: 8px\" @click=\"openMessageModel\" />\r\n      </div>\r\n    </el-form-item>\r\n    <el-dialog :visible.sync=\"messageModelVisible\" :close-on-click-modal=\"false\" title=\"创建新消息\" width=\"400px\" append-to-body destroy-on-close>\r\n      <el-form :model=\"newMessageForm\" size=\"mini\" label-width=\"90px\" @submit.native.prevent>\r\n        <el-form-item label=\"消息ID\">\r\n          <el-input v-model=\"newMessageForm.id\" clearable />\r\n        </el-form-item>\r\n        <el-form-item label=\"消息名称\">\r\n          <el-input v-model=\"newMessageForm.name\" clearable />\r\n        </el-form-item>\r\n      </el-form>\r\n      <template slot=\"footer\">\r\n        <el-button size=\"mini\" type=\"primary\" @click=\"createNewMessage\">确 认</el-button>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"ReceiveTask\",\r\n  props: {\r\n    id: String,\r\n    type: String\r\n  },\r\n  data() {\r\n    return {\r\n      bindMessageId: \"\",\r\n      newMessageForm: {},\r\n      messageMap: {},\r\n      messageModelVisible: false\r\n    };\r\n  },\r\n  watch: {\r\n    id: {\r\n      immediate: true,\r\n      handler() {\r\n        this.$nextTick(() => this.getBindMessage());\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.bpmnMessageRefsMap = Object.create(null);\r\n    this.bpmnRootElements = window.bpmnInstances.modeler.getDefinitions().rootElements;\r\n    this.bpmnRootElements\r\n      .filter(el => el.$type === \"bpmn:Message\")\r\n      .forEach(m => {\r\n        this.bpmnMessageRefsMap[m.id] = m;\r\n        this.$set(this.messageMap, m.id, m.name);\r\n      });\r\n    this.$set(this.messageMap, \"-1\", \"无\"); // 添加一个空对象，保证可以取消原消息绑定\r\n  },\r\n  methods: {\r\n    getBindMessage() {\r\n      this.bpmnElement = window.bpmnInstances.bpmnElement;\r\n      this.bindMessageId = this.bpmnElement.businessObject?.messageRef?.id || \"-1\";\r\n    },\r\n    openMessageModel() {\r\n      this.messageModelVisible = true;\r\n      this.newMessageForm = {};\r\n    },\r\n    createNewMessage() {\r\n      if (this.messageMap[this.newMessageForm.id]) {\r\n        this.$message.error(\"该消息已存在，请修改id后重新保存\");\r\n        return;\r\n      }\r\n      const newMessage = window.bpmnInstances.moddle.create(\"bpmn:Message\", this.newMessageForm);\r\n      this.bpmnRootElements.push(newMessage);\r\n      this.$set(this.messageMap, this.newMessageForm.id, this.newMessageForm.name);\r\n      this.bpmnMessageRefsMap[this.newMessageForm.id] = newMessage;\r\n      this.messageModelVisible = false;\r\n    },\r\n    updateTaskMessage(messageId) {\r\n      if (messageId === \"-1\") {\r\n        window.bpmnInstances.modeling.updateProperties(this.bpmnElement, {\r\n          messageRef: null\r\n        });\r\n      } else {\r\n        window.bpmnInstances.modeling.updateProperties(this.bpmnElement, {\r\n          messageRef: this.bpmnMessageRefsMap[messageId]\r\n        });\r\n      }\r\n    }\r\n  },\r\n  beforeDestroy() {\r\n    this.bpmnElement = null;\r\n  }\r\n};\r\n</script>\r\n"]}]}