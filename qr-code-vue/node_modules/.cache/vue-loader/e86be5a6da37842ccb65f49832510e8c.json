{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\system\\user\\profile\\userSocial.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\system\\user\\profile\\userSocial.vue","mtime":1704630438101},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoNCmltcG9ydCB7U3lzdGVtVXNlclNvY2lhbFR5cGVFbnVtfSBmcm9tICJAL3V0aWxzL2NvbnN0YW50cyI7DQppbXBvcnQge3NvY2lhbEF1dGhSZWRpcmVjdH0gZnJvbSAiQC9hcGkvbG9naW4iOw0KaW1wb3J0IHtzb2NpYWxCaW5kLCBzb2NpYWxVbmJpbmR9IGZyb20gIkAvYXBpL3N5c3RlbS9zb2NpYWxVc2VyIjsNCg0KZXhwb3J0IGRlZmF1bHQgew0KICBwcm9wczogew0KICAgIHVzZXI6IHsNCiAgICAgIHR5cGU6IE9iamVjdA0KICAgIH0sDQogICAgZ2V0VXNlcjogeyAvLyDliLfmlrDnlKjmiLcNCiAgICAgIHR5cGU6IEZ1bmN0aW9uDQogICAgfSwNCiAgICBzZXRBY3RpdmVUYWI6IHsgLy8g6K6+572u5r+A5rS755qEDQogICAgICB0eXBlOiBGdW5jdGlvbg0KICAgIH0NCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgIH07DQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgc29jaWFsVXNlcnMgKCl7DQogICAgICBjb25zdCBzb2NpYWxVc2VycyA9IFtdOw0KICAgICAgZm9yIChjb25zdCBpIGluIFN5c3RlbVVzZXJTb2NpYWxUeXBlRW51bSkgew0KICAgICAgICBjb25zdCBzb2NpYWxVc2VyID0gey4uLlN5c3RlbVVzZXJTb2NpYWxUeXBlRW51bVtpXX07DQogICAgICAgIHNvY2lhbFVzZXJzLnB1c2goc29jaWFsVXNlcik7DQogICAgICAgIGlmICh0aGlzLnVzZXIuc29jaWFsVXNlcnMpIHsNCiAgICAgICAgICBmb3IgKGNvbnN0IGogaW4gdGhpcy51c2VyLnNvY2lhbFVzZXJzKSB7DQogICAgICAgICAgICBpZiAoc29jaWFsVXNlci50eXBlID09PSB0aGlzLnVzZXIuc29jaWFsVXNlcnNbal0udHlwZSkgew0KICAgICAgICAgICAgICBzb2NpYWxVc2VyLm9wZW5pZCA9IHRoaXMudXNlci5zb2NpYWxVc2Vyc1tqXS5vcGVuaWQ7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHNvY2lhbFVzZXJzOw0KICAgIH0NCiAgfSwNCiAgY3JlYXRlZCgpIHsNCiAgICAvLyDnpL7kuqTnu5HlrpoNCiAgICBjb25zdCB0eXBlID0gdGhpcy4kcm91dGUucXVlcnkudHlwZTsNCiAgICBjb25zdCBjb2RlID0gdGhpcy4kcm91dGUucXVlcnkuY29kZTsNCiAgICBjb25zdCBzdGF0ZSA9IHRoaXMuJHJvdXRlLnF1ZXJ5LnN0YXRlOw0KICAgIGlmICghY29kZSkgew0KICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICBzb2NpYWxCaW5kKHR5cGUsIGNvZGUsIHN0YXRlKS50aGVuKHJlc3AgPT4gew0KICAgICAgdGhpcy4kbW9kYWwubXNnU3VjY2Vzcygi57uR5a6a5oiQ5YqfIik7DQogICAgICB0aGlzLiRyb3V0ZXIucmVwbGFjZSgnL3VzZXIvcHJvZmlsZScpOw0KICAgICAgLy8g6LCD55So54i257uE5Lu2LCDliLfmlrANCiAgICAgIHRoaXMuZ2V0VXNlcigpOw0KICAgICAgdGhpcy5zZXRBY3RpdmVUYWIoJ3VzZXJTb2NpYWwnKTsNCiAgICB9KTsNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIGJpbmQoc29jaWFsVXNlcikgew0KICAgICAgLy8g6K6h566XIHJlZGlyZWN0VXJpDQogICAgICBjb25zdCByZWRpcmVjdFVyaSA9IGxvY2F0aW9uLm9yaWdpbiArICcvdXNlci9wcm9maWxlP3R5cGU9JyArIHNvY2lhbFVzZXIudHlwZTsNCiAgICAgIC8vIOi/m+ihjOi3s+i9rA0KICAgICAgc29jaWFsQXV0aFJlZGlyZWN0KHNvY2lhbFVzZXIudHlwZSwgZW5jb2RlVVJJQ29tcG9uZW50KHJlZGlyZWN0VXJpKSkudGhlbigocmVzKSA9PiB7DQogICAgICAgIC8vIGNvbnNvbGUubG9nKHJlcy51cmwpOw0KICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHJlcy5kYXRhOw0KICAgICAgfSk7DQogICAgfSwNCiAgICB1bmJpbmQoc29jaWFsVXNlcikgew0KICAgICAgc29jaWFsVW5iaW5kKHNvY2lhbFVzZXIudHlwZSwgc29jaWFsVXNlci5vcGVuaWQpLnRoZW4ocmVzcCA9PiB7DQogICAgICAgIHRoaXMuJG1vZGFsLm1zZ1N1Y2Nlc3MoIuino+e7keaIkOWKnyIpOw0KICAgICAgICBzb2NpYWxVc2VyLm9wZW5pZCA9IHVuZGVmaW5lZDsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgY2xvc2UoKSB7DQogICAgICB0aGlzLiR0YWIuY2xvc2VQYWdlKCk7DQogICAgfQ0KICB9DQp9Ow0K"},{"version":3,"sources":["userSocial.vue"],"names":[],"mappings":";;AAwBA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"userSocial.vue","sourceRoot":"src/views/system/user/profile","sourcesContent":["<template>\r\n  <el-table :data=\"socialUsers\" :show-header=\"false\">\r\n    <el-table-column label=\"社交平台\" align=\"left\" width=\"120\">\r\n      <template v-slot=\"scope\">\r\n        <img style=\"height:20px;vertical-align: middle;\" :src=\"scope.row.img\" /> {{ scope.row.title }}\r\n      </template>\r\n    </el-table-column>\r\n    <el-table-column label=\"操作\" align=\"left\" >\r\n      <template v-slot=\"scope\">\r\n        <div v-if=\"scope.row.openid\">\r\n          已绑定\r\n          <el-button size=\"large\" type=\"text\" @click=\"unbind(scope.row)\">(解绑)</el-button>\r\n        </div>\r\n        <div v-else>\r\n          未绑定\r\n          <el-button size=\"large\" type=\"text\" @click=\"bind(scope.row)\">(绑定)</el-button>\r\n        </div>\r\n      </template>\r\n    </el-table-column>\r\n  </el-table>\r\n</template>\r\n\r\n<script>\r\n\r\nimport {SystemUserSocialTypeEnum} from \"@/utils/constants\";\r\nimport {socialAuthRedirect} from \"@/api/login\";\r\nimport {socialBind, socialUnbind} from \"@/api/system/socialUser\";\r\n\r\nexport default {\r\n  props: {\r\n    user: {\r\n      type: Object\r\n    },\r\n    getUser: { // 刷新用户\r\n      type: Function\r\n    },\r\n    setActiveTab: { // 设置激活的\r\n      type: Function\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n    };\r\n  },\r\n  computed: {\r\n    socialUsers (){\r\n      const socialUsers = [];\r\n      for (const i in SystemUserSocialTypeEnum) {\r\n        const socialUser = {...SystemUserSocialTypeEnum[i]};\r\n        socialUsers.push(socialUser);\r\n        if (this.user.socialUsers) {\r\n          for (const j in this.user.socialUsers) {\r\n            if (socialUser.type === this.user.socialUsers[j].type) {\r\n              socialUser.openid = this.user.socialUsers[j].openid;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return socialUsers;\r\n    }\r\n  },\r\n  created() {\r\n    // 社交绑定\r\n    const type = this.$route.query.type;\r\n    const code = this.$route.query.code;\r\n    const state = this.$route.query.state;\r\n    if (!code) {\r\n      return;\r\n    }\r\n    socialBind(type, code, state).then(resp => {\r\n      this.$modal.msgSuccess(\"绑定成功\");\r\n      this.$router.replace('/user/profile');\r\n      // 调用父组件, 刷新\r\n      this.getUser();\r\n      this.setActiveTab('userSocial');\r\n    });\r\n  },\r\n  methods: {\r\n    bind(socialUser) {\r\n      // 计算 redirectUri\r\n      const redirectUri = location.origin + '/user/profile?type=' + socialUser.type;\r\n      // 进行跳转\r\n      socialAuthRedirect(socialUser.type, encodeURIComponent(redirectUri)).then((res) => {\r\n        // console.log(res.url);\r\n        window.location.href = res.data;\r\n      });\r\n    },\r\n    unbind(socialUser) {\r\n      socialUnbind(socialUser.type, socialUser.openid).then(resp => {\r\n        this.$modal.msgSuccess(\"解绑成功\");\r\n        socialUser.openid = undefined;\r\n      });\r\n    },\r\n    close() {\r\n      this.$tab.closePage();\r\n    }\r\n  }\r\n};\r\n</script>\r\n"]}]}