{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\bpm\\processInstance\\create.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\bpm\\processInstance\\create.vue","mtime":1704630437845},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQge2dldFByb2Nlc3NEZWZpbml0aW9uQnBtblhNTCwgZ2V0UHJvY2Vzc0RlZmluaXRpb25MaXN0fSBmcm9tICJAL2FwaS9icG0vZGVmaW5pdGlvbiI7DQppbXBvcnQge0RJQ1RfVFlQRSwgZ2V0RGljdERhdGFzfSBmcm9tICJAL3V0aWxzL2RpY3QiOw0KaW1wb3J0IHtkZWNvZGVGaWVsZHN9IGZyb20gIkAvdXRpbHMvZm9ybUdlbmVyYXRvciI7DQppbXBvcnQgUGFyc2VyIGZyb20gJ0AvY29tcG9uZW50cy9wYXJzZXIvUGFyc2VyJw0KaW1wb3J0IHtjcmVhdGVQcm9jZXNzSW5zdGFuY2V9IGZyb20gIkAvYXBpL2JwbS9wcm9jZXNzSW5zdGFuY2UiOw0KDQovLyDmtYHnqIvlrp7kvovnmoTlj5HotbcNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogIlByb2Nlc3NJbnN0YW5jZUNyZWF0ZSIsDQogIGNvbXBvbmVudHM6IHsNCiAgICBQYXJzZXINCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgLy8g6YGu572p5bGCDQogICAgICBsb2FkaW5nOiB0cnVlLA0KICAgICAgLy8g6KGo5qC85pWw5o2uDQogICAgICBsaXN0OiBbXSwNCg0KICAgICAgLy8g5rWB56iL6KGo5Y2V6K+m5oOFDQogICAgICBkZXRhaWxGb3JtOiB7DQogICAgICAgIGZpZWxkczogW10NCiAgICAgIH0sDQoNCiAgICAgIC8vIEJQTU4g5pWw5o2uDQogICAgICBicG1uWE1MOiBudWxsLA0KICAgICAgYnBtbkNvbnRyb2xGb3JtOiB7DQogICAgICAgIHByZWZpeDogImZsb3dhYmxlIg0KICAgICAgfSwNCg0KICAgICAgLy8g5rWB56iL6KGo5Y2VDQogICAgICBzZWxlY3RQcm9jZXNzSW5zdGFuY2U6IHVuZGVmaW5lZCwgLy8g6YCJ5oup55qE5rWB56iL5a6e5L6LDQoNCiAgICAgIC8vIOaVsOaNruWtl+WFuA0KICAgICAgY2F0ZWdvcnlEaWN0RGF0YXM6IGdldERpY3REYXRhcyhESUNUX1RZUEUuQlBNX01PREVMX0NBVEVHT1JZKSwNCiAgICB9Ow0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuZ2V0TGlzdCgpOw0KICB9LA0KICBtZXRob2RzOiB7DQogICAgLyoqIOafpeivoua1geeoi+WumuS5ieWIl+ihqCAqLw0KICAgIGdldExpc3QoKSB7DQogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOw0KICAgICAgZ2V0UHJvY2Vzc0RlZmluaXRpb25MaXN0KHsNCiAgICAgICAgc3VzcGVuc2lvblN0YXRlOiAxDQogICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgICB0aGlzLmxpc3QgPSByZXNwb25zZS5kYXRhDQogICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2UNCiAgICAgICAgfQ0KICAgICAgKTsNCiAgICB9LA0KICAgIC8qKiDlpITnkIbpgInmi6nmtYHnqIvnmoTmjInpkq7mk43kvZwgKiovDQogICAgaGFuZGxlU2VsZWN0KHJvdykgew0KICAgICAgLy8g6K6+572u6YCJ5oup55qE5rWB56iLDQogICAgICB0aGlzLnNlbGVjdFByb2Nlc3NJbnN0YW5jZSA9IHJvdzsNCg0KICAgICAgLy8g5rWB56iL6KGo5Y2VDQogICAgICBpZiAocm93LmZvcm1JZCkgew0KICAgICAgICAvLyDorr7nva7lr7nlupTnmoTooajljZUNCiAgICAgICAgdGhpcy5kZXRhaWxGb3JtID0gew0KICAgICAgICAgIC4uLkpTT04ucGFyc2Uocm93LmZvcm1Db25mKSwNCiAgICAgICAgICBmaWVsZHM6IGRlY29kZUZpZWxkcyhyb3cuZm9ybUZpZWxkcykNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIOWKoOi9vea1geeoi+Wbvg0KICAgICAgICBnZXRQcm9jZXNzRGVmaW5pdGlvbkJwbW5YTUwocm93LmlkKS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgICB0aGlzLmJwbW5YTUwgPSByZXNwb25zZS5kYXRhDQogICAgICAgIH0pDQogICAgICB9IGVsc2UgaWYgKHJvdy5mb3JtQ3VzdG9tQ3JlYXRlUGF0aCkgew0KICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IHBhdGg6IHJvdy5mb3JtQ3VzdG9tQ3JlYXRlUGF0aH0pOw0KICAgICAgICAvLyDov5nph4zmmoLml7bml6DpnIDliqDovb3mtYHnqIvlm77vvIzlm6DkuLrot7Plh7rliLDlj6blpJbkuKogVGFi77ybDQogICAgICB9DQogICAgfSwNCiAgICAvKiog5o+Q5Lqk5oyJ6ZKuICovDQogICAgc3VibWl0Rm9ybShwYXJhbXMpIHsNCiAgICAgIGlmICghcGFyYW1zKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIC8vIOiuvue9ruihqOWNleemgeeUqA0KICAgICAgY29uc3QgY29uZiA9IHBhcmFtcy5jb25mOw0KICAgICAgY29uZi5kaXNhYmxlZCA9IHRydWU7IC8vIOihqOWNleemgeeUqA0KICAgICAgY29uZi5mb3JtQnRucyA9IGZhbHNlOyAvLyDmjInpkq7pmpDol48NCg0KICAgICAgLy8g5o+Q5Lqk6KGo5Y2V77yM5Yib5bu65rWB56iLDQogICAgICBjb25zdCB2YXJpYWJsZXMgPSBwYXJhbXMudmFsdWVzOw0KICAgICAgY3JlYXRlUHJvY2Vzc0luc3RhbmNlKHsNCiAgICAgICAgcHJvY2Vzc0RlZmluaXRpb25JZDogdGhpcy5zZWxlY3RQcm9jZXNzSW5zdGFuY2UuaWQsDQogICAgICAgIHZhcmlhYmxlczogdmFyaWFibGVzDQogICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgdGhpcy4kbW9kYWwubXNnU3VjY2Vzcygi5Y+R6LW35rWB56iL5oiQ5YqfIik7DQogICAgICAgIC8vIOWFs+mXreW9k+WJjeeql+WPow0KICAgICAgICB0aGlzLiR0YWIuY2xvc2VPcGVuUGFnZSgpOw0KICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpOw0KICAgICAgfSkuY2F0Y2goKCkgPT4gew0KICAgICAgICBjb25mLmRpc2FibGVkID0gZmFsc2U7IC8vIOihqOWNleW8gOWQrw0KICAgICAgICBjb25mLmZvcm1CdG5zID0gdHJ1ZTsgLy8g5oyJ6ZKu5bGV56S6DQogICAgICB9KQ0KICAgIH0sDQogIH0NCn07DQo="},{"version":3,"sources":["create.vue"],"names":[],"mappings":";AAuDA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"create.vue","sourceRoot":"src/views/bpm/processInstance","sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <!-- 第一步，通过流程定义的列表，选择对应的流程 -->\r\n    <div v-if=\"!selectProcessInstance\">\r\n      <el-table v-loading=\"loading\" :data=\"list\">\r\n        <el-table-column label=\"流程名称\" align=\"center\" prop=\"name\" width=\"200\">\r\n          <template v-slot=\"scope\">\r\n            <el-button type=\"text\" @click=\"handleBpmnDetail(scope.row)\">\r\n              <span>{{ scope.row.name }}</span>\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"流程分类\" align=\"center\" prop=\"category\" width=\"100\">\r\n          <template v-slot=\"scope\">\r\n            <dict-tag :type=\"DICT_TYPE.BPM_MODEL_CATEGORY\" :value=\"scope.row.category\" />\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"流程版本\" align=\"center\" prop=\"processDefinition.version\" width=\"80\">\r\n          <template v-slot=\"scope\">\r\n            <el-tag size=\"medium\" v-if=\"scope.row\">v{{ scope.row.version }}</el-tag>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"流程描述\" align=\"center\" prop=\"description\" width=\"300\" show-overflow-tooltip />\r\n        <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\">\r\n          <template v-slot=\"scope\">\r\n            <el-button type=\"text\" size=\"small\" icon=\"el-icon-plus\" @click=\"handleSelect(scope.row)\">选择</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </div>\r\n    <!-- 第二步，填写表单，进行流程的提交 -->\r\n    <div v-else>\r\n      <el-card class=\"box-card\" >\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span class=\"el-icon-document\">申请信息【{{ selectProcessInstance.name }}】</span>\r\n          <el-button style=\"float: right;\" type=\"primary\" @click=\"selectProcessInstance = undefined\">选择其它流程</el-button>\r\n        </div>\r\n        <el-col :span=\"16\" :offset=\"6\">\r\n          <div>\r\n            <parser :key=\"new Date().getTime()\" :form-conf=\"detailForm\" @submit=\"submitForm\" />\r\n          </div>\r\n        </el-col>\r\n      </el-card>\r\n      <el-card class=\"box-card\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span class=\"el-icon-picture-outline\">流程图</span>\r\n        </div>\r\n        <my-process-viewer key=\"designer\" v-model=\"bpmnXML\" v-bind=\"bpmnControlForm\" />\r\n      </el-card>\r\n    </div>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {getProcessDefinitionBpmnXML, getProcessDefinitionList} from \"@/api/bpm/definition\";\r\nimport {DICT_TYPE, getDictDatas} from \"@/utils/dict\";\r\nimport {decodeFields} from \"@/utils/formGenerator\";\r\nimport Parser from '@/components/parser/Parser'\r\nimport {createProcessInstance} from \"@/api/bpm/processInstance\";\r\n\r\n// 流程实例的发起\r\nexport default {\r\n  name: \"ProcessInstanceCreate\",\r\n  components: {\r\n    Parser\r\n  },\r\n  data() {\r\n    return {\r\n      // 遮罩层\r\n      loading: true,\r\n      // 表格数据\r\n      list: [],\r\n\r\n      // 流程表单详情\r\n      detailForm: {\r\n        fields: []\r\n      },\r\n\r\n      // BPMN 数据\r\n      bpmnXML: null,\r\n      bpmnControlForm: {\r\n        prefix: \"flowable\"\r\n      },\r\n\r\n      // 流程表单\r\n      selectProcessInstance: undefined, // 选择的流程实例\r\n\r\n      // 数据字典\r\n      categoryDictDatas: getDictDatas(DICT_TYPE.BPM_MODEL_CATEGORY),\r\n    };\r\n  },\r\n  created() {\r\n    this.getList();\r\n  },\r\n  methods: {\r\n    /** 查询流程定义列表 */\r\n    getList() {\r\n      this.loading = true;\r\n      getProcessDefinitionList({\r\n        suspensionState: 1\r\n      }).then(response => {\r\n          this.list = response.data\r\n          this.loading = false\r\n        }\r\n      );\r\n    },\r\n    /** 处理选择流程的按钮操作 **/\r\n    handleSelect(row) {\r\n      // 设置选择的流程\r\n      this.selectProcessInstance = row;\r\n\r\n      // 流程表单\r\n      if (row.formId) {\r\n        // 设置对应的表单\r\n        this.detailForm = {\r\n          ...JSON.parse(row.formConf),\r\n          fields: decodeFields(row.formFields)\r\n        }\r\n\r\n        // 加载流程图\r\n        getProcessDefinitionBpmnXML(row.id).then(response => {\r\n          this.bpmnXML = response.data\r\n        })\r\n      } else if (row.formCustomCreatePath) {\r\n        this.$router.push({ path: row.formCustomCreatePath});\r\n        // 这里暂时无需加载流程图，因为跳出到另外个 Tab；\r\n      }\r\n    },\r\n    /** 提交按钮 */\r\n    submitForm(params) {\r\n      if (!params) {\r\n        return;\r\n      }\r\n      // 设置表单禁用\r\n      const conf = params.conf;\r\n      conf.disabled = true; // 表单禁用\r\n      conf.formBtns = false; // 按钮隐藏\r\n\r\n      // 提交表单，创建流程\r\n      const variables = params.values;\r\n      createProcessInstance({\r\n        processDefinitionId: this.selectProcessInstance.id,\r\n        variables: variables\r\n      }).then(response => {\r\n        this.$modal.msgSuccess(\"发起流程成功\");\r\n        // 关闭当前窗口\r\n        this.$tab.closeOpenPage();\r\n        this.$router.go(-1);\r\n      }).catch(() => {\r\n        conf.disabled = false; // 表单开启\r\n        conf.formBtns = true; // 按钮展示\r\n      })\r\n    },\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.my-process-designer {\r\n  height: calc(100vh - 200px);\r\n}\r\n\r\n.box-card {\r\n  width: 100%;\r\n  margin-bottom: 20px;\r\n}\r\n</style>\r\n"]}]}