{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\components\\bpmnProcessDesigner\\package\\penal\\flow-condition\\FlowCondition.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\components\\bpmnProcessDesigner\\package\\penal\\flow-condition\\FlowCondition.vue","mtime":1704630437714},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJGbG93Q29uZGl0aW9uIiwNCiAgcHJvcHM6IHsNCiAgICBidXNpbmVzc09iamVjdDogT2JqZWN0LA0KICAgIHR5cGU6IFN0cmluZw0KICB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBmbG93Q29uZGl0aW9uRm9ybToge30NCiAgICB9Ow0KICB9LA0KICB3YXRjaDogew0KICAgIGJ1c2luZXNzT2JqZWN0OiB7DQogICAgICBpbW1lZGlhdGU6IHRydWUsDQogICAgICBoYW5kbGVyKCkgew0KICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB0aGlzLnJlc2V0Rmxvd0NvbmRpdGlvbigpKTsNCiAgICAgIH0NCiAgICB9DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICByZXNldEZsb3dDb25kaXRpb24oKSB7DQogICAgICB0aGlzLmJwbW5FbGVtZW50ID0gd2luZG93LmJwbW5JbnN0YW5jZXMuYnBtbkVsZW1lbnQ7DQogICAgICB0aGlzLmJwbW5FbGVtZW50U291cmNlID0gdGhpcy5icG1uRWxlbWVudC5zb3VyY2U7DQogICAgICB0aGlzLmJwbW5FbGVtZW50U291cmNlUmVmID0gdGhpcy5icG1uRWxlbWVudC5idXNpbmVzc09iamVjdC5zb3VyY2VSZWY7DQogICAgICBpZiAodGhpcy5icG1uRWxlbWVudFNvdXJjZVJlZiAmJiB0aGlzLmJwbW5FbGVtZW50U291cmNlUmVmLmRlZmF1bHQgJiYgdGhpcy5icG1uRWxlbWVudFNvdXJjZVJlZi5kZWZhdWx0LmlkID09PSB0aGlzLmJwbW5FbGVtZW50LmlkKSB7DQogICAgICAgIC8vIOm7mOiupA0KICAgICAgICB0aGlzLmZsb3dDb25kaXRpb25Gb3JtID0geyB0eXBlOiAiZGVmYXVsdCIgfTsNCiAgICAgIH0gZWxzZSBpZiAoIXRoaXMuYnBtbkVsZW1lbnQuYnVzaW5lc3NPYmplY3QuY29uZGl0aW9uRXhwcmVzc2lvbikgew0KICAgICAgICAvLyDmma7pgJoNCiAgICAgICAgdGhpcy5mbG93Q29uZGl0aW9uRm9ybSA9IHsgdHlwZTogIm5vcm1hbCIgfTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vIOW4puadoeS7tg0KICAgICAgICBjb25zdCBjb25kaXRpb25FeHByZXNzaW9uID0gdGhpcy5icG1uRWxlbWVudC5idXNpbmVzc09iamVjdC5jb25kaXRpb25FeHByZXNzaW9uOw0KICAgICAgICB0aGlzLmZsb3dDb25kaXRpb25Gb3JtID0geyAuLi5jb25kaXRpb25FeHByZXNzaW9uLCB0eXBlOiAiY29uZGl0aW9uIiB9Ow0KICAgICAgICAvLyByZXNvdXJjZSDlj6/nm7TmjqXmoIfor4Yg5piv5ZCm5piv5aSW6YOo6LWE5rqQ6ISa5pysDQogICAgICAgIGlmICh0aGlzLmZsb3dDb25kaXRpb25Gb3JtLnJlc291cmNlKSB7DQogICAgICAgICAgdGhpcy4kc2V0KHRoaXMuZmxvd0NvbmRpdGlvbkZvcm0sICJjb25kaXRpb25UeXBlIiwgInNjcmlwdCIpOw0KICAgICAgICAgIHRoaXMuJHNldCh0aGlzLmZsb3dDb25kaXRpb25Gb3JtLCAic2NyaXB0VHlwZSIsICJleHRlcm5hbFNjcmlwdCIpOw0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoY29uZGl0aW9uRXhwcmVzc2lvbi5sYW5ndWFnZSkgew0KICAgICAgICAgIHRoaXMuJHNldCh0aGlzLmZsb3dDb25kaXRpb25Gb3JtLCAiY29uZGl0aW9uVHlwZSIsICJzY3JpcHQiKTsNCiAgICAgICAgICB0aGlzLiRzZXQodGhpcy5mbG93Q29uZGl0aW9uRm9ybSwgInNjcmlwdFR5cGUiLCAiaW5saW5lU2NyaXB0Iik7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuJHNldCh0aGlzLmZsb3dDb25kaXRpb25Gb3JtLCAiY29uZGl0aW9uVHlwZSIsICJleHByZXNzaW9uIik7DQogICAgICB9DQogICAgfSwNCiAgICB1cGRhdGVGbG93VHlwZShmbG93VHlwZSkgew0KICAgICAgLy8g5q2j5bi45p2h5Lu257G7DQogICAgICBpZiAoZmxvd1R5cGUgPT09ICJjb25kaXRpb24iKSB7DQogICAgICAgIHRoaXMuZmxvd0NvbmRpdGlvblJlZiA9IHdpbmRvdy5icG1uSW5zdGFuY2VzLm1vZGRsZS5jcmVhdGUoImJwbW46Rm9ybWFsRXhwcmVzc2lvbiIpOw0KICAgICAgICB3aW5kb3cuYnBtbkluc3RhbmNlcy5tb2RlbGluZy51cGRhdGVQcm9wZXJ0aWVzKHRoaXMuYnBtbkVsZW1lbnQsIHsNCiAgICAgICAgICBjb25kaXRpb25FeHByZXNzaW9uOiB0aGlzLmZsb3dDb25kaXRpb25SZWYNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIC8vIOm7mOiupOi3r+W+hA0KICAgICAgaWYgKGZsb3dUeXBlID09PSAiZGVmYXVsdCIpIHsNCiAgICAgICAgd2luZG93LmJwbW5JbnN0YW5jZXMubW9kZWxpbmcudXBkYXRlUHJvcGVydGllcyh0aGlzLmJwbW5FbGVtZW50LCB7DQogICAgICAgICAgY29uZGl0aW9uRXhwcmVzc2lvbjogbnVsbA0KICAgICAgICB9KTsNCiAgICAgICAgd2luZG93LmJwbW5JbnN0YW5jZXMubW9kZWxpbmcudXBkYXRlUHJvcGVydGllcyh0aGlzLmJwbW5FbGVtZW50U291cmNlLCB7DQogICAgICAgICAgZGVmYXVsdDogdGhpcy5icG1uRWxlbWVudA0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgICAgLy8g5q2j5bi46Lev5b6E77yM5aaC5p6c5p2l5rqQ6IqC54K555qE6buY6K6k6Lev5b6E5piv5b2T5YmN6L+e57q/5pe277yM5riF6Zmk54i25YWD57Sg55qE6buY6K6k6Lev5b6E6YWN572uDQogICAgICBpZiAodGhpcy5icG1uRWxlbWVudFNvdXJjZVJlZi5kZWZhdWx0ICYmIHRoaXMuYnBtbkVsZW1lbnRTb3VyY2VSZWYuZGVmYXVsdC5pZCA9PT0gdGhpcy5icG1uRWxlbWVudC5pZCkgew0KICAgICAgICB3aW5kb3cuYnBtbkluc3RhbmNlcy5tb2RlbGluZy51cGRhdGVQcm9wZXJ0aWVzKHRoaXMuYnBtbkVsZW1lbnRTb3VyY2UsIHsNCiAgICAgICAgICBkZWZhdWx0OiBudWxsDQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgICAgd2luZG93LmJwbW5JbnN0YW5jZXMubW9kZWxpbmcudXBkYXRlUHJvcGVydGllcyh0aGlzLmJwbW5FbGVtZW50LCB7DQogICAgICAgIGNvbmRpdGlvbkV4cHJlc3Npb246IG51bGwNCiAgICAgIH0pOw0KICAgIH0sDQogICAgdXBkYXRlRmxvd0NvbmRpdGlvbigpIHsNCiAgICAgIGxldCB7IGNvbmRpdGlvblR5cGUsIHNjcmlwdFR5cGUsIGJvZHksIHJlc291cmNlLCBsYW5ndWFnZSB9ID0gdGhpcy5mbG93Q29uZGl0aW9uRm9ybTsNCiAgICAgIGxldCBjb25kaXRpb247DQogICAgICBpZiAoY29uZGl0aW9uVHlwZSA9PT0gImV4cHJlc3Npb24iKSB7DQogICAgICAgIGNvbmRpdGlvbiA9IHdpbmRvdy5icG1uSW5zdGFuY2VzLm1vZGRsZS5jcmVhdGUoImJwbW46Rm9ybWFsRXhwcmVzc2lvbiIsIHsgYm9keSB9KTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlmIChzY3JpcHRUeXBlID09PSAiaW5saW5lU2NyaXB0Iikgew0KICAgICAgICAgIGNvbmRpdGlvbiA9IHdpbmRvdy5icG1uSW5zdGFuY2VzLm1vZGRsZS5jcmVhdGUoImJwbW46Rm9ybWFsRXhwcmVzc2lvbiIsIHsgYm9keSwgbGFuZ3VhZ2UgfSk7DQogICAgICAgICAgdGhpcy4kc2V0KHRoaXMuZmxvd0NvbmRpdGlvbkZvcm0sICJyZXNvdXJjZSIsICIiKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aGlzLiRzZXQodGhpcy5mbG93Q29uZGl0aW9uRm9ybSwgImJvZHkiLCAiIik7DQogICAgICAgICAgY29uZGl0aW9uID0gd2luZG93LmJwbW5JbnN0YW5jZXMubW9kZGxlLmNyZWF0ZSgiYnBtbjpGb3JtYWxFeHByZXNzaW9uIiwgeyByZXNvdXJjZSwgbGFuZ3VhZ2UgfSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHdpbmRvdy5icG1uSW5zdGFuY2VzLm1vZGVsaW5nLnVwZGF0ZVByb3BlcnRpZXModGhpcy5icG1uRWxlbWVudCwgeyBjb25kaXRpb25FeHByZXNzaW9uOiBjb25kaXRpb24gfSk7DQogICAgfQ0KICB9LA0KICBiZWZvcmVEZXN0cm95KCkgew0KICAgIHRoaXMuYnBtbkVsZW1lbnQgPSBudWxsOw0KICAgIHRoaXMuYnBtbkVsZW1lbnRTb3VyY2UgPSBudWxsOw0KICAgIHRoaXMuYnBtbkVsZW1lbnRTb3VyY2VSZWYgPSBudWxsOw0KICB9DQp9Ow0K"},{"version":3,"sources":["FlowCondition.vue"],"names":[],"mappings":";AAyCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"FlowCondition.vue","sourceRoot":"src/components/bpmnProcessDesigner/package/penal/flow-condition","sourcesContent":["<template>\r\n  <div class=\"panel-tab__content\">\r\n    <el-form :model=\"flowConditionForm\" label-width=\"90px\" size=\"mini\" @submit.native.prevent>\r\n      <el-form-item label=\"流转类型\">\r\n        <el-select v-model=\"flowConditionForm.type\" @change=\"updateFlowType\">\r\n          <el-option label=\"普通流转路径\" value=\"normal\" />\r\n          <el-option label=\"默认流转路径\" value=\"default\" />\r\n          <el-option label=\"条件流转路径\" value=\"condition\" />\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item label=\"条件格式\" v-if=\"flowConditionForm.type === 'condition'\" key=\"condition\">\r\n        <el-select v-model=\"flowConditionForm.conditionType\">\r\n          <el-option label=\"表达式\" value=\"expression\" />\r\n          <el-option label=\"脚本\" value=\"script\" />\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item label=\"表达式\" v-if=\"flowConditionForm.conditionType && flowConditionForm.conditionType === 'expression'\" key=\"express\">\r\n        <el-input v-model=\"flowConditionForm.body\" style=\"width:192px;\"  clearable @change=\"updateFlowCondition\" />\r\n      </el-form-item>\r\n      <template v-if=\"flowConditionForm.conditionType && flowConditionForm.conditionType === 'script'\">\r\n        <el-form-item label=\"脚本语言\" key=\"language\">\r\n          <el-input v-model=\"flowConditionForm.language\" clearable @change=\"updateFlowCondition\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"脚本类型\" key=\"scriptType\">\r\n          <el-select v-model=\"flowConditionForm.scriptType\">\r\n            <el-option label=\"内联脚本\" value=\"inlineScript\" />\r\n            <el-option label=\"外部脚本\" value=\"externalScript\" />\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"脚本\" v-if=\"flowConditionForm.scriptType === 'inlineScript'\" key=\"body\">\r\n          <el-input v-model=\"flowConditionForm.body\" type=\"textarea\" clearable @change=\"updateFlowCondition\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"资源地址\" v-if=\"flowConditionForm.scriptType === 'externalScript'\" key=\"resource\">\r\n          <el-input v-model=\"flowConditionForm.resource\" clearable @change=\"updateFlowCondition\" />\r\n        </el-form-item>\r\n      </template>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"FlowCondition\",\r\n  props: {\r\n    businessObject: Object,\r\n    type: String\r\n  },\r\n  data() {\r\n    return {\r\n      flowConditionForm: {}\r\n    };\r\n  },\r\n  watch: {\r\n    businessObject: {\r\n      immediate: true,\r\n      handler() {\r\n        this.$nextTick(() => this.resetFlowCondition());\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    resetFlowCondition() {\r\n      this.bpmnElement = window.bpmnInstances.bpmnElement;\r\n      this.bpmnElementSource = this.bpmnElement.source;\r\n      this.bpmnElementSourceRef = this.bpmnElement.businessObject.sourceRef;\r\n      if (this.bpmnElementSourceRef && this.bpmnElementSourceRef.default && this.bpmnElementSourceRef.default.id === this.bpmnElement.id) {\r\n        // 默认\r\n        this.flowConditionForm = { type: \"default\" };\r\n      } else if (!this.bpmnElement.businessObject.conditionExpression) {\r\n        // 普通\r\n        this.flowConditionForm = { type: \"normal\" };\r\n      } else {\r\n        // 带条件\r\n        const conditionExpression = this.bpmnElement.businessObject.conditionExpression;\r\n        this.flowConditionForm = { ...conditionExpression, type: \"condition\" };\r\n        // resource 可直接标识 是否是外部资源脚本\r\n        if (this.flowConditionForm.resource) {\r\n          this.$set(this.flowConditionForm, \"conditionType\", \"script\");\r\n          this.$set(this.flowConditionForm, \"scriptType\", \"externalScript\");\r\n          return;\r\n        }\r\n        if (conditionExpression.language) {\r\n          this.$set(this.flowConditionForm, \"conditionType\", \"script\");\r\n          this.$set(this.flowConditionForm, \"scriptType\", \"inlineScript\");\r\n          return;\r\n        }\r\n        this.$set(this.flowConditionForm, \"conditionType\", \"expression\");\r\n      }\r\n    },\r\n    updateFlowType(flowType) {\r\n      // 正常条件类\r\n      if (flowType === \"condition\") {\r\n        this.flowConditionRef = window.bpmnInstances.moddle.create(\"bpmn:FormalExpression\");\r\n        window.bpmnInstances.modeling.updateProperties(this.bpmnElement, {\r\n          conditionExpression: this.flowConditionRef\r\n        });\r\n        return;\r\n      }\r\n      // 默认路径\r\n      if (flowType === \"default\") {\r\n        window.bpmnInstances.modeling.updateProperties(this.bpmnElement, {\r\n          conditionExpression: null\r\n        });\r\n        window.bpmnInstances.modeling.updateProperties(this.bpmnElementSource, {\r\n          default: this.bpmnElement\r\n        });\r\n        return;\r\n      }\r\n      // 正常路径，如果来源节点的默认路径是当前连线时，清除父元素的默认路径配置\r\n      if (this.bpmnElementSourceRef.default && this.bpmnElementSourceRef.default.id === this.bpmnElement.id) {\r\n        window.bpmnInstances.modeling.updateProperties(this.bpmnElementSource, {\r\n          default: null\r\n        });\r\n      }\r\n      window.bpmnInstances.modeling.updateProperties(this.bpmnElement, {\r\n        conditionExpression: null\r\n      });\r\n    },\r\n    updateFlowCondition() {\r\n      let { conditionType, scriptType, body, resource, language } = this.flowConditionForm;\r\n      let condition;\r\n      if (conditionType === \"expression\") {\r\n        condition = window.bpmnInstances.moddle.create(\"bpmn:FormalExpression\", { body });\r\n      } else {\r\n        if (scriptType === \"inlineScript\") {\r\n          condition = window.bpmnInstances.moddle.create(\"bpmn:FormalExpression\", { body, language });\r\n          this.$set(this.flowConditionForm, \"resource\", \"\");\r\n        } else {\r\n          this.$set(this.flowConditionForm, \"body\", \"\");\r\n          condition = window.bpmnInstances.moddle.create(\"bpmn:FormalExpression\", { resource, language });\r\n        }\r\n      }\r\n      window.bpmnInstances.modeling.updateProperties(this.bpmnElement, { conditionExpression: condition });\r\n    }\r\n  },\r\n  beforeDestroy() {\r\n    this.bpmnElement = null;\r\n    this.bpmnElementSource = null;\r\n    this.bpmnElementSourceRef = null;\r\n  }\r\n};\r\n</script>\r\n"]}]}