{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\mall\\product\\spu\\save.vue?vue&type=style&index=0&id=12333a05&lang=scss","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\mall\\product\\spu\\save.vue","mtime":1704630437938},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouY29udGFpbmVyew0KICBwYWRkaW5nOiAyMHB4Ow0KfQ0KDQouZHluYW1pYy1zcGVjIHsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2YyZjJmMjsNCiAgd2lkdGg6IDg1JTsNCiAgbWFyZ2luOiBhdXRvOw0KICBtYXJnaW4tYm90dG9tOiAxMHB4Ow0KDQogIC5zcGVjLWhlYWRlciB7DQogICAgcGFkZGluZzogMzBweDsNCiAgICBwYWRkaW5nLWJvdHRvbTogMjBweDsNCg0KICAgIC5zcGVjLW5hbWUgew0KICAgICAgZGlzcGxheTogaW5saW5lOw0KDQogICAgICBpbnB1dCB7DQogICAgICAgIHdpZHRoOiAzMCU7DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgLnNwZWMtdmFsdWVzIHsNCiAgICB3aWR0aDogODQlOw0KICAgIHBhZGRpbmc6IDI1cHg7DQogICAgbWFyZ2luOiBhdXRvOw0KICAgIHBhZGRpbmctdG9wOiA1cHg7DQoNCiAgICAuc3BlYy12YWx1ZSB7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICBtYXJnaW4tcmlnaHQ6IDEwcHg7DQogICAgICBtYXJnaW4tYm90dG9tOiAxMHB4Ow0KICAgICAgd2lkdGg6IDEzJTsNCg0KICAgIH0NCiAgfQ0KDQogIC5zcGVjLWRlbGV0ZSB7DQogICAgZmxvYXQ6IHJpZ2h0Ow0KICAgIG1hcmdpbi10b3A6IDEwcHg7DQogICAgbWFyZ2luLXJpZ2h0OiAxMHB4Ow0KICB9DQp9DQoNCi50YWJzIHsNCiAgYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkICNmMmYyZjI7DQoNCiAgLmVsLXRhYi1wYW5lIHsNCiAgICBvdmVyZmxvdy15OiBhdXRvOw0KICB9DQp9DQoNCi8vIOW6k+WtmOS7t+agvOWbvueJh+agt+W8j+S/ruaUuQ0KLnJhdGVzIHsNCiAgLmNvbXBvbmVudC11cGxvYWQtaW1hZ2Ugew0KICAgIG1hcmdpbjogYXV0bzsNCiAgfQ0KDQogIC5lbC11cGxvYWQtLXBpY3R1cmUtY2FyZCB7DQogICAgd2lkdGg6IDEwMHB4Ow0KICAgIGhlaWdodDogNTBweDsNCiAgICBsaW5lLWhlaWdodDogNjBweDsNCiAgICBtYXJnaW46IGF1dG87DQogIH0NCg0KICAuZWwtdXBsb2FkLWxpc3RfX2l0ZW0gew0KICAgIHdpZHRoOiAxMDBweCAhaW1wb3J0YW50Ow0KICAgIGhlaWdodDogNTBweCAhaW1wb3J0YW50Ow0KICB9DQp9DQoNCi5idXR0b25zIHsNCiAgbWFyZ2luLXRvcDogMjBweDsNCiAgaGVpZ2h0OiAzNnB4Ow0KDQogIGJ1dHRvbiB7DQogICAgZmxvYXQ6IHJpZ2h0Ow0KICAgIG1hcmdpbi1sZWZ0OiAxNXB4Ow0KICB9DQp9DQoNCi5tYWxsLWltYWdlIHsNCiAgLmVsLXVwbG9hZC0tcGljdHVyZS1jYXJkIHsNCiAgICB3aWR0aDogODBweDsNCiAgICBoZWlnaHQ6IDgwcHg7DQogICAgbGluZS1oZWlnaHQ6IDkwcHg7DQogIH0NCg0KICAuZWwtdXBsb2FkLWxpc3RfX2l0ZW0gew0KICAgIHdpZHRoOiA4MHB4Ow0KICAgIGhlaWdodDogODBweDsNCiAgfQ0KfQ0KDQo="},{"version":3,"sources":["save.vue"],"names":[],"mappings":";AAoeA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"save.vue","sourceRoot":"src/views/mall/product/spu","sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <!-- TODO 样式优化：表单宽度、表单项对齐、hr 粗细； -->\r\n    <el-tabs v-model=\"activeName\" class=\"tabs\">\r\n      <!-- 基础设置 -->\r\n      <!-- TODO @luowenfeng：基础设置，分成基础信息、配送信息 -->\r\n      <el-tab-pane label=\"基础设置\" name=\"basic\">\r\n        <el-form ref=\"basic\" :model=\"baseForm\" :rules=\"rules\" label-width=\"100px\" style=\"width: 95%\">\r\n          <el-form-item label=\"商品名称\" prop=\"name\">\r\n            <el-input v-model=\"baseForm.name\" placeholder=\"请输入商品名称\" />\r\n          </el-form-item>\r\n          <el-form-item label=\"促销语\">\r\n            <el-input type=\"textarea\" v-model=\"baseForm.sellPoint\" placeholder=\"请输入促销语\"/>\r\n          </el-form-item>\r\n          <el-form-item label=\"商品主图\" prop=\"picUrls\">\r\n            <ImageUpload v-model=\"baseForm.picUrls\" :value=\"baseForm.picUrls\" :limit=\"10\" class=\"mall-image\"/>\r\n          </el-form-item>\r\n          <el-form-item label=\"商品视频\" prop=\"videoUrl\">\r\n            <VideoUpload v-model=\"baseForm.videoUrl\" :value=\"baseForm.videoUrl\"/>\r\n          </el-form-item>\r\n          <el-form-item label=\"商品品牌\" prop=\"brandId\">\r\n            <el-select v-model=\"baseForm.brandId\" placeholder=\"请选择商品品牌\">\r\n              <el-option v-for=\"item in brandList\" :key=\"item.id\" :label=\"item.name\" :value=\"item.id\"/>\r\n            </el-select>\r\n          </el-form-item>\r\n          <el-form-item label=\"商品分类\" prop=\"categoryIds\">\r\n            <el-cascader v-model=\"baseForm.categoryIds\" placeholder=\"商品分类\" style=\"width: 100%\"\r\n                         :options=\"categoryList\" :props=\"propName\" clearable/>\r\n          </el-form-item>\r\n          <el-form-item label=\"是否上架\" prop=\"status\">\r\n            <el-radio-group v-model=\"baseForm.status\">\r\n              <el-radio :label=\"1\">立即上架</el-radio>\r\n              <el-radio :label=\"0\">放入仓库</el-radio>\r\n            </el-radio-group>\r\n          </el-form-item>\r\n        </el-form>\r\n      </el-tab-pane>\r\n\r\n      <!-- 价格库存 -->\r\n      <!-- TODO @luowenfeng：rates=》priceStack 会更好哈 -->\r\n      <el-tab-pane label=\"价格库存\" name=\"rates\" class=\"rates\">\r\n        <el-form ref=\"rates\" :model=\"ratesForm\" :rules=\"rules\">\r\n          <el-form-item label=\"启用多规格\">\r\n            <el-switch v-model=\"specSwitch\" @change=\"changeSpecSwitch\"/>\r\n          </el-form-item>\r\n          <!-- 动态添加规格属性 -->\r\n          <div v-show=\"ratesForm.spec === 2\">\r\n            <div v-for=\"(specs, index) in dynamicSpec\" :key=\"index\" class=\"dynamic-spec\">\r\n              <!-- 删除按钮 -->\r\n              <el-button type=\"danger\" icon=\"el-icon-delete\" circle class=\"spec-delete\" @click=\"removeSpec(index)\"/>\r\n              <div class=\"spec-header\">\r\n                规格项：\r\n                <el-select v-model=\"specs.specId\" filterable placeholder=\"请选择\" @change=\"changeSpec\">\r\n                  <el-option v-for=\"item in propertyPageList\" :key=\"item.id\" :label=\"item.name\" :value=\"item.id\"/>\r\n                </el-select>\r\n              </div>\r\n              <div class=\"spec-values\">\r\n                <template v-for=\"(v, i) in specs.specValue\">\r\n                  <el-input v-model=\"v.name\" class=\"spec-value\" :key=\"i\" disabled/>\r\n                </template>\r\n              </div>\r\n            </div>\r\n            <el-button type=\"primary\" @click=\"dynamicSpec.push({specValue: []}); ratesForm.rates = []\">添加规格项目</el-button>\r\n          </div>\r\n\r\n          <!-- 规格明细 -->\r\n          <el-form-item label=\"规格明细\">\r\n            <el-table :data=\"ratesForm.rates\" border style=\"width: 100%\" ref=\"ratesTable\">\r\n              <template v-if=\"this.specSwitch\">\r\n                <el-table-column :key=\"index\" v-for=\"(item, index) in dynamicSpec.filter(v => v.specName !== undefined)\"\r\n                                 :label=\"item.specName\">\r\n                  <template v-slot=\"scope\">\r\n                    <el-input v-if=\"scope.row.spec\" v-model=\"scope.row.spec[index]\" disabled/>\r\n                  </template>\r\n                </el-table-column>\r\n              </template>\r\n              <el-table-column label=\"规格图片\" width=\"120px\" :render-header=\"addRedStar\" key=\"90\">\r\n                <template v-slot=\"scope\">\r\n                  <ImageUpload v-model=\"scope.row.picUrl\" :limit=\"1\" :isShowTip=\"false\" style=\"width: 100px; height: 50px\"/>\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column label=\"市场价(元)\" :render-header=\"addRedStar\" key=\"92\">\r\n                <template v-slot=\"scope\">\r\n                  <el-form-item :prop=\"'rates.'+ scope.$index + '.marketPrice'\" :rules=\"[{required: true, trigger: 'change'}]\">\r\n                    <el-input v-model=\"scope.row.marketPrice\"\r\n                              oninput=\"value= value.match(/\\d+(\\.\\d{0,2})?/) ? value.match(/\\d+(\\.\\d{0,2})?/)[0] : ''\"/>\r\n                  </el-form-item>\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column label=\"销售价(元)\" :render-header=\"addRedStar\" key=\"93\">\r\n                <template v-slot=\"scope\">\r\n                  <el-form-item :prop=\"'rates.'+ scope.$index + '.price'\"\r\n                                :rules=\"[{required: true, trigger: 'change'}]\">\r\n                    <el-input v-model=\"scope.row.price\"\r\n                              oninput=\"value= value.match(/\\d+(\\.\\d{0,2})?/) ? value.match(/\\d+(\\.\\d{0,2})?/)[0] : ''\" />\r\n                  </el-form-item>\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column label=\"成本价\" :render-header=\"addRedStar\" key=\"94\">\r\n                <template v-slot=\"scope\">\r\n                  <el-form-item :prop=\"'rates.'+ scope.$index + '.costPrice'\"\r\n                                :rules=\"[{required: true, trigger: 'change'}]\">\r\n                    <el-input v-model=\"scope.row.costPrice\"\r\n                              oninput=\"value= value.match(/\\d+(\\.\\d{0,2})?/) ? value.match(/\\d+(\\.\\d{0,2})?/)[0] : ''\" />\r\n                  </el-form-item>\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column label=\"库存\" :render-header=\"addRedStar\" key=\"95\">\r\n                <template v-slot=\"scope\">\r\n                  <el-form-item :prop=\"'rates.'+ scope.$index + '.stock'\" :rules=\"[{required: true, trigger: 'change'}]\">\r\n                    <el-input v-model=\"scope.row.stock\" oninput=\"value=value.replace(/^(0+)|[^\\d]+/g,'')\"></el-input>\r\n                  </el-form-item>\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column label=\"预警库存\" key=\"96\">\r\n                <template v-slot=\"scope\">\r\n                  <el-input v-model=\"scope.row.warnStock\" oninput=\"value=value.replace(/^(0+)|[^\\d]+/g,'')\"></el-input>\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column label=\"体积\" key=\"97\">\r\n                <template v-slot=\"scope\">\r\n                  <el-input v-model=\"scope.row.volume\" />\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column label=\"重量\" key=\"98\">\r\n                <template v-slot=\"scope\">\r\n                  <el-input v-model=\"scope.row.weight\" />\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column label=\"条码\" key=\"99\">\r\n                <template v-slot=\"scope\">\r\n                  <el-input v-model=\"scope.row.barCode\" />\r\n                </template>\r\n              </el-table-column>\r\n              <template v-if=\"this.specSwitch\">\r\n                <el-table-column fixed=\"right\" label=\"操作\" width=\"50\" key=\"100\">\r\n                  <template v-slot=\"scope\">\r\n                    <el-button @click=\"scope.row.status = 1\" type=\"text\" size=\"small\"\r\n                               v-show=\"scope.row.status === undefined || scope.row.status === 0 \">禁用\r\n                    </el-button>\r\n                    <el-button @click=\"scope.row.status = 0\" type=\"text\" size=\"small\" v-show=\"scope.row.status === 1\">\r\n                      启用\r\n                    </el-button>\r\n                  </template>\r\n                </el-table-column>\r\n              </template>\r\n            </el-table>\r\n          </el-form-item>\r\n          <el-form-item label=\"虚拟销量\" prop=\"virtualSalesCount\">\r\n            <el-input v-model=\"baseForm.virtualSalesCount\" placeholder=\"请输入虚拟销量\"\r\n                      oninput=\"value=value.replace(/^(0+)|[^\\d]+/g,'')\"/>\r\n          </el-form-item>\r\n        </el-form>\r\n      </el-tab-pane>\r\n\r\n      <!-- 商品详情 -->\r\n      <el-tab-pane label=\"商品详情\" name=\"detail\">\r\n        <el-form ref=\"detail\" :model=\"baseForm\" :rules=\"rules\">\r\n          <el-form-item prop=\"description\">\r\n            <editor v-model=\"baseForm.description\" :min-height=\"380\"/>\r\n          </el-form-item>\r\n        </el-form>\r\n      </el-tab-pane>\r\n\r\n      <!-- 销售设置 -->\r\n      <el-tab-pane label=\"高级设置\" name=\"senior\">\r\n        <el-form ref=\"senior\" :model=\"baseForm\" :rules=\"rules\" label-width=\"100px\" style=\"width: 95%\">\r\n          <el-form-item label=\"排序字段\">\r\n            <el-input v-model=\"baseForm.sort\" placeholder=\"请输入排序字段\" oninput=\"value=value.replace(/^(0+)|[^\\d]+/g,'')\"/>\r\n          </el-form-item>\r\n          <el-form-item label=\"是否展示库存\" prop=\"showStock\">\r\n            <el-radio-group v-model=\"baseForm.showStock\">\r\n              <el-radio :label=\"true\">是</el-radio>\r\n              <el-radio :label=\"false\">否</el-radio>\r\n            </el-radio-group>\r\n          </el-form-item>\r\n        </el-form>\r\n      </el-tab-pane>\r\n    </el-tabs>\r\n\r\n    <div class=\"buttons\">\r\n      <el-button type=\"info\" round @click=\"cancel\">取消</el-button>\r\n      <el-button type=\"success\" round @click=\"submit\">确认</el-button>\r\n    </div>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {getBrandList} from \"@/api/mall/product/brand\";\r\nimport {getProductCategoryList} from \"@/api/mall/product/category\";\r\nimport {createSpu, getSpuDetail, updateSpu} from \"@/api/mall/product/spu\";\r\nimport {getPropertyListAndValue,} from \"@/api/mall/product/property\";\r\nimport Editor from \"@/components/Editor\";\r\nimport ImageUpload from \"@/components/ImageUpload\";\r\nimport VideoUpload from \"@/components/VideoUpload\";\r\n\r\nexport default {\r\n  name: \"ProductSave\",\r\n  components: {\r\n    Editor,\r\n    ImageUpload,\r\n    VideoUpload\r\n  },\r\n  data() {\r\n    return {\r\n      specSwitch: false,\r\n      activeName: \"basic\",\r\n      propName: {\r\n        checkStrictly: true,\r\n        label: \"name\",\r\n        value: \"id\",\r\n      },\r\n      // 基础设置\r\n      baseForm: {\r\n        id: null,\r\n        name: null,\r\n        sellPoint: null,\r\n        categoryIds: null,\r\n        sort: null,\r\n        description: null,\r\n        picUrls: null,\r\n        videoUrl: null,\r\n        status: 0,\r\n        virtualSalesCount: 0,\r\n        showStock: true,\r\n        brandId: null,\r\n      },\r\n\r\n      categoryList: [],\r\n      // 价格库存\r\n      ratesForm: {\r\n        spec: 1,\r\n        // 规格明细\r\n        rates: [{}]\r\n      },\r\n      dynamicSpec: [\r\n        // {\r\n        //   specId: 86,\r\n        //   specName: \"颜色\",\r\n        //   specValue:[{\r\n        //      name: \"红色\",\r\n        //      id: 225,\r\n        //   }]\r\n        // },\r\n      ],\r\n      propertyPageList: [],\r\n      brandList: [],\r\n      specValue: null,\r\n\r\n      // 表单校验\r\n      rules: {\r\n        name: [{required: true, message: \"商品名称不能为空\", trigger: \"blur\"},],\r\n        description: [{required: true, message: \"描述不能为空\", trigger: \"blur\"},],\r\n        categoryIds: [{required: true, message: \"分类id不能为空\", trigger: \"blur\"},],\r\n        status: [{required: true, message: \"商品状态不能为空\", trigger: \"blur\"}],\r\n        brandId: [{required: true, message: \"商品品牌不能为空\", trigger: \"blur\"}],\r\n        picUrls: [{required: true, message: \"商品轮播图地址不能为空\", trigger: \"blur\"}],\r\n      },\r\n    };\r\n  },\r\n  created() {\r\n    this.getListBrand();\r\n    this.getListCategory();\r\n    this.getPropertyPageList();\r\n    const spuId = this.$route.params && this.$route.params.spuId;\r\n    if (spuId != null) {\r\n      this.updateType(spuId)\r\n    }\r\n  },\r\n  methods: {\r\n    removeSpec(index) {\r\n      this.dynamicSpec.splice(index, 1);\r\n      this.changeSpecSwitch()\r\n    },\r\n    // 必选标识\r\n    addRedStar(h, {column}) {\r\n      return [\r\n        h('span', {style: 'color: #F56C6C'}, '*'),\r\n        h('span', ' ' + column.label)\r\n      ];\r\n    },\r\n    changeSpecSwitch() {\r\n      this.specSwitch ? this.ratesForm.spec = 2 : this.ratesForm.spec = 1;\r\n      this.$refs.ratesTable.doLayout();\r\n      if (this.ratesForm.spec === 1) {\r\n        this.ratesForm.rates = [{}]\r\n      } else {\r\n        this.ratesForm.rates = []\r\n        if (this.dynamicSpec.length > 0) {\r\n          this.buildRatesFormRates()\r\n        }\r\n      }\r\n    },\r\n    // 构建规格明细笛卡尔积\r\n    buildRatesFormRates() {\r\n      let rates = [];\r\n      this.dynamicSpec.map(v => v.specValue.map(m => m.name))\r\n        .reduce((last, current) => {\r\n          const array = [];\r\n          last.forEach(par1 => {\r\n            current.forEach(par2 => {\r\n              let v\r\n              // 当两个对象合并时，需使用[1,2]方式生成数组，而当数组和对象合并时，需使用concat\r\n              if (par1 instanceof Array) {\r\n                v = par1.concat(par2)\r\n              } else {\r\n                v = [par1, par2];\r\n              }\r\n              array.push(v)\r\n            });\r\n          });\r\n          return array;\r\n        })\r\n        .forEach(v => {\r\n          let spec = v;\r\n          // 当v为单个规格项时，会变成字符串。造成表格只截取第一个字符串，而不是数组的第一个元素\r\n          if (typeof v == 'string') {\r\n            spec = Array.of(v)\r\n          }\r\n          rates.push({spec: spec, status: 0, name: Array.of(v).join()})\r\n        });\r\n      this.ratesForm.rates = rates\r\n    },\r\n    /** 查询分类 */\r\n    getListCategory() {\r\n      // 执行查询\r\n      getProductCategoryList().then((response) => {\r\n        this.categoryList = this.handleTree(response.data, \"id\", \"parentId\");\r\n      });\r\n    },\r\n    /** 查询品牌列表 */\r\n    getListBrand() {\r\n      // 执行查询\r\n      getBrandList().then((response) => {\r\n        this.brandList = response.data;\r\n      });\r\n    },\r\n    // 取消按钮\r\n    cancel() {\r\n      var currentView = this.$store.state.tagsView.visitedViews[0]\r\n      for (currentView of this.$store.state.tagsView.visitedViews) {\r\n        if (currentView.path === this.$route.path) {\r\n          break\r\n        }\r\n      }\r\n      this.$store.dispatch('tagsView/delView', currentView)\r\n        .then(() => {\r\n          this.$router.push(\"/product/spu\")\r\n        })\r\n    },\r\n    submit() {\r\n      this.$refs[this.activeName].validate((valid) => {\r\n        if (!valid) {\r\n          return;\r\n        }\r\n        let rates = JSON.parse(JSON.stringify(this.ratesForm.rates));\r\n\r\n        // 价格元转分\r\n        rates.forEach(r => {\r\n          r.marketPrice = r.marketPrice * 100;\r\n          r.price = r.price * 100;\r\n          r.costPrice = r.costPrice * 100;\r\n        })\r\n\r\n        // 动态规格调整字段\r\n        if (this.specSwitch) {\r\n          rates.forEach(r => {\r\n            let properties = []\r\n            Array.of(r.spec).forEach(s => {\r\n              let obj;\r\n              if (s instanceof Array) {\r\n                obj = s;\r\n              } else {\r\n                obj = Array.of(s);\r\n              }\r\n              obj.forEach((v, i) => {\r\n                let specValue = this.dynamicSpec[i].specValue.find(o => o.name === v);\r\n                let propertie = {};\r\n                propertie.propertyId = this.dynamicSpec[i].specId;\r\n                propertie.valueId = specValue.id;\r\n                properties.push(propertie);\r\n              })\r\n            })\r\n            r.properties = properties;\r\n          })\r\n        } else {\r\n          rates[0].name = this.baseForm.name;\r\n          rates[0].status = this.baseForm.status;\r\n        }\r\n        let form = this.baseForm\r\n        if (form.picUrls instanceof Array) {\r\n          form.picUrls = form.picUrls.flatMap(m => m.split(','))\r\n        } else if (form.picUrls.split(',') instanceof Array) {\r\n          form.picUrls = form.picUrls.split(',').flatMap(m => m.split(','))\r\n        } else {\r\n          form.picUrls = Array.of(form.picUrls)\r\n        }\r\n        form.skus = rates;\r\n        form.specType = this.ratesForm.spec;\r\n\r\n        let category = form.categoryIds instanceof Array ? form.categoryIds: Array.of(form.categoryIds)\r\n        console.log(category)\r\n        form.categoryId = category[category.length - 1];\r\n\r\n        if (form.id == null) {\r\n          createSpu(form).then(() => {\r\n            this.$modal.msgSuccess(\"新增成功\");\r\n          }).then(()=>{\r\n            this.cancel();\r\n          })\r\n        } else {\r\n          updateSpu(form).then(() => {\r\n            this.$modal.msgSuccess(\"修改成功\");\r\n          }).then(()=>{\r\n            this.cancel();\r\n          })\r\n        }\r\n      });\r\n\r\n    },\r\n    /** 查询规格 */\r\n    getPropertyPageList() {\r\n      // 执行查询\r\n      getPropertyListAndValue().then((response) => {\r\n        this.propertyPageList = response.data;\r\n      });\r\n    },\r\n    // 添加规格项目\r\n    changeSpec(val) {\r\n      let obj = this.propertyPageList.find(o => o.id === val);\r\n      let spec = this.dynamicSpec.find(o => o.specId === val)\r\n      spec.specId = obj.id;\r\n      spec.specName = obj.name;\r\n      spec.specValue = obj.values;\r\n      this.buildRatesFormRates();\r\n    },\r\n    updateType(id) {\r\n      getSpuDetail(id).then((response) => {\r\n        let data = response.data;\r\n        this.baseForm.id = data.id;\r\n        this.baseForm.name = data.name;\r\n        this.baseForm.sellPoint = data.sellPoint;\r\n        this.baseForm.categoryIds = data.categoryId;\r\n        this.baseForm.videoUrl = data.videoUrl;\r\n        this.baseForm.sort = data.sort;\r\n        this.baseForm.description = data.description;\r\n        this.baseForm.picUrls = data.picUrls;\r\n        this.baseForm.status = data.status;\r\n        this.baseForm.virtualSalesCount = data.virtualSalesCount;\r\n        this.baseForm.showStock = data.showStock;\r\n        this.baseForm.brandId = data.brandId;\r\n        this.ratesForm.spec = data.specType;\r\n        data.skus.forEach(r => {\r\n          r.marketPrice = this.divide(r.marketPrice, 100)\r\n          r.price = this.divide(r.price, 100)\r\n          r.costPrice = this.divide(r.costPrice, 100)\r\n        })\r\n        if (this.ratesForm.spec === 2) {\r\n          this.specSwitch = true;\r\n          data.productPropertyViews.forEach(p => {\r\n            let obj = {};\r\n            obj.specId = p.propertyId;\r\n            obj.specName = p.name;\r\n            obj.specValue = p.propertyValues;\r\n            this.dynamicSpec.push(obj);\r\n          })\r\n          data.skus.forEach(s => {\r\n            s.spec = [];\r\n            s.properties.forEach(sp => {\r\n              let spec = data.productPropertyViews.find(o => o.propertyId === sp.propertyId).propertyValues.find(v => v.id === sp.valueId).name;\r\n              s.spec.push(spec)\r\n            })\r\n          })\r\n        }\r\n        this.ratesForm.rates = data.skus\r\n      })\r\n    },\r\n\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.container{\r\n  padding: 20px;\r\n}\r\n\r\n.dynamic-spec {\r\n  background-color: #f2f2f2;\r\n  width: 85%;\r\n  margin: auto;\r\n  margin-bottom: 10px;\r\n\r\n  .spec-header {\r\n    padding: 30px;\r\n    padding-bottom: 20px;\r\n\r\n    .spec-name {\r\n      display: inline;\r\n\r\n      input {\r\n        width: 30%;\r\n      }\r\n    }\r\n  }\r\n\r\n  .spec-values {\r\n    width: 84%;\r\n    padding: 25px;\r\n    margin: auto;\r\n    padding-top: 5px;\r\n\r\n    .spec-value {\r\n      display: inline-block;\r\n      margin-right: 10px;\r\n      margin-bottom: 10px;\r\n      width: 13%;\r\n\r\n    }\r\n  }\r\n\r\n  .spec-delete {\r\n    float: right;\r\n    margin-top: 10px;\r\n    margin-right: 10px;\r\n  }\r\n}\r\n\r\n.tabs {\r\n  border-bottom: 2px solid #f2f2f2;\r\n\r\n  .el-tab-pane {\r\n    overflow-y: auto;\r\n  }\r\n}\r\n\r\n// 库存价格图片样式修改\r\n.rates {\r\n  .component-upload-image {\r\n    margin: auto;\r\n  }\r\n\r\n  .el-upload--picture-card {\r\n    width: 100px;\r\n    height: 50px;\r\n    line-height: 60px;\r\n    margin: auto;\r\n  }\r\n\r\n  .el-upload-list__item {\r\n    width: 100px !important;\r\n    height: 50px !important;\r\n  }\r\n}\r\n\r\n.buttons {\r\n  margin-top: 20px;\r\n  height: 36px;\r\n\r\n  button {\r\n    float: right;\r\n    margin-left: 15px;\r\n  }\r\n}\r\n\r\n.mall-image {\r\n  .el-upload--picture-card {\r\n    width: 80px;\r\n    height: 80px;\r\n    line-height: 90px;\r\n  }\r\n\r\n  .el-upload-list__item {\r\n    width: 80px;\r\n    height: 80px;\r\n  }\r\n}\r\n\r\n</style>\r\n"]}]}