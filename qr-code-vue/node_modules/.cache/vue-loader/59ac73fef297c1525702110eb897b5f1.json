{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\bpm\\processInstance\\detail.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\bpm\\processInstance\\detail.vue","mtime":1704630437846},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQge2dldFByb2Nlc3NEZWZpbml0aW9uQnBtblhNTH0gZnJvbSAiQC9hcGkvYnBtL2RlZmluaXRpb24iOw0KaW1wb3J0IHN0b3JlIGZyb20gIkAvc3RvcmUiOw0KaW1wb3J0IHtkZWNvZGVGaWVsZHN9IGZyb20gIkAvdXRpbHMvZm9ybUdlbmVyYXRvciI7DQppbXBvcnQgUGFyc2VyIGZyb20gJ0AvY29tcG9uZW50cy9wYXJzZXIvUGFyc2VyJw0KaW1wb3J0IHtnZXRQcm9jZXNzSW5zdGFuY2V9IGZyb20gIkAvYXBpL2JwbS9wcm9jZXNzSW5zdGFuY2UiOw0KaW1wb3J0IHsNCiAgYXBwcm92ZVRhc2ssDQogIGRlbGVnYXRlVGFzaywNCiAgZ2V0UmV0dXJuTGlzdCwNCiAgZ2V0VGFza0xpc3RCeVByb2Nlc3NJbnN0YW5jZUlkLA0KICByZWplY3RUYXNrLA0KICByZXR1cm5UYXNrLA0KICB1cGRhdGVUYXNrQXNzaWduZWUsDQp9IGZyb20gIkAvYXBpL2JwbS90YXNrIjsNCmltcG9ydCB7Z2V0RGF0ZX0gZnJvbSAiQC91dGlscy9kYXRlVXRpbHMiOw0KaW1wb3J0IHtsaXN0U2ltcGxlVXNlcnN9IGZyb20gIkAvYXBpL3N5c3RlbS91c2VyIjsNCmltcG9ydCB7Z2V0QWN0aXZpdHlMaXN0fSBmcm9tICJAL2FwaS9icG0vYWN0aXZpdHkiOw0KaW1wb3J0IFZ1ZSBmcm9tICJ2dWUiOw0KDQovLyDmtYHnqIvlrp7kvovnmoTor6bmg4XpobXvvIzlj6/nlKjkuo7lrqHmibkNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogIlByb2Nlc3NJbnN0YW5jZURldGFpbCIsDQogIGNvbXBvbmVudHM6IHsNCiAgICBQYXJzZXINCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgLy8g6YGu572p5bGCDQogICAgICBwcm9jZXNzSW5zdGFuY2VMb2FkaW5nOiB0cnVlLA0KICAgICAgLy8g5rWB56iL5a6e5L6LDQogICAgICBpZDogdW5kZWZpbmVkLCAvLyDmtYHnqIvlrp7kvovnmoTnvJblj7cNCiAgICAgIHByb2Nlc3NJbnN0YW5jZToge30sDQogICAgICBmb3JtTG9hZGluZzogZmFsc2UsDQogICAgICAvLyDmtYHnqIvooajljZXor6bmg4UNCiAgICAgIGRldGFpbEZvcm06IHsNCiAgICAgICAgZmllbGRzOiBbXQ0KICAgICAgfSwNCiAgICAgIC8v5Zue6YCA5YiX6KGo5pWw5o2uDQogICAgICByZXR1cm5MaXN0OiBbXSwNCiAgICAgIGZvcm1EYXRhOiB7DQogICAgICAgIGlkOiAnJywNCiAgICAgICAgdGFyZ2V0RGVmaW5pdGlvbktleTogdW5kZWZpbmVkLA0KICAgICAgICByZWFzb246ICcnDQogICAgICB9LA0KICAgICAgZm9ybVJ1bGVzOiB7DQogICAgICAgIHRhcmdldERlZmluaXRpb25LZXk6IFt7cmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICflv4XpobvpgInmi6nlm57pgIDoioLngrknLCB0cmlnZ2VyOiAnY2hhbmdlJ31dLA0KICAgICAgICByZWFzb246IFt7cmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICflm57pgIDnkIbnlLHkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnYmx1cid9XQ0KICAgICAgfSwNCiAgICAgIHJldHVybk9wZW46IGZhbHNlLA0KICAgICAgLy8gQlBNTiDmlbDmja4NCiAgICAgIGJwbW5YTUw6IG51bGwsDQogICAgICBicG1uQ29udHJvbEZvcm06IHsNCiAgICAgICAgcHJlZml4OiAiZmxvd2FibGUiDQogICAgICB9LA0KICAgICAgYWN0aXZpdHlMaXN0OiBbXSwNCg0KICAgICAgLy8g5a6h5om56K6w5b2VDQogICAgICB0YXNrc0xvYWQ6IHRydWUsDQogICAgICB0YXNrczogW10sDQoNCiAgICAgIC8vIOWuoeaJueihqOWNlQ0KICAgICAgcnVubmluZ1Rhc2tzOiBbXSwNCiAgICAgIGF1ZGl0Rm9ybXM6IFtdLA0KICAgICAgYXVkaXRSdWxlOiB7DQogICAgICAgIHJlYXNvbjogW3tyZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogIuWuoeaJueW7uuiuruS4jeiDveS4uuepuiIsIHRyaWdnZXI6ICJibHVyIn1dLA0KICAgICAgfSwNCiAgICAgIC8vIOi9rOa0vuWuoeaJueS6ug0KICAgICAgdXNlck9wdGlvbnM6IFtdLA0KICAgICAgdXBkYXRlQXNzaWduZWU6IHsNCiAgICAgICAgb3BlbjogZmFsc2UsDQogICAgICAgIGZvcm06IHsNCiAgICAgICAgICBhc3NpZ25lZVVzZXJJZDogdW5kZWZpbmVkLA0KICAgICAgICB9LA0KICAgICAgICBydWxlczogew0KICAgICAgICAgIGFzc2lnbmVlVXNlcklkOiBbe3JlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi5paw5a6h5om55Lq65LiN6IO95Li656m6IiwgdHJpZ2dlcjogImNoYW5nZSJ9XSwNCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgIHVwZGF0ZURlbGVnYXRlOiB7DQogICAgICAgIG9wZW46IGZhbHNlLA0KICAgICAgICBmb3JtOiB7DQogICAgICAgICAgZGVsZWdhdGVVc2VySWQ6IHVuZGVmaW5lZCwNCiAgICAgICAgICByZWFzb246ICcnDQogICAgICAgIH0sDQogICAgICAgIHJ1bGVzOiB7DQogICAgICAgICAgZGVsZWdhdGVVc2VySWQ6IFt7cmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICLmlrDlrqHmibnkurrkuI3og73kuLrnqboiLCB0cmlnZ2VyOiAiY2hhbmdlIn1dLA0KICAgICAgICAgIHJlYXNvbjogW3tyZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+WnlOa0vueQhueUseS4jeiDveS4uuepuicsIHRyaWdnZXI6ICdibHVyJ31dDQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9Ow0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuaWQgPSB0aGlzLiRyb3V0ZS5xdWVyeS5pZDsNCiAgICBpZiAoIXRoaXMuaWQpIHsNCiAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+acquS8oOmAkiBpZCDlj4LmlbDvvIzml6Dms5Xmn6XnnIvmtYHnqIvkv6Hmga8nKTsNCiAgICAgIHJldHVybjsNCiAgICB9DQogICAgdGhpcy5nZXREZXRhaWwoKTsNCg0KICAgIC8vIOiOt+W+l+eUqOaIt+WIl+ihqA0KICAgIHRoaXMudXNlck9wdGlvbnMgPSBbXTsNCiAgICBsaXN0U2ltcGxlVXNlcnMoKS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgIHRoaXMudXNlck9wdGlvbnMucHVzaCguLi5yZXNwb25zZS5kYXRhKTsNCiAgICB9KTsNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIC8qKiDojrflvpfmtYHnqIvlrp7kvosgKi8NCiAgICBnZXREZXRhaWwoKSB7DQogICAgICAvLyDojrflvpfmtYHnqIvlrp7kvovnm7jlhbMNCiAgICAgIHRoaXMucHJvY2Vzc0luc3RhbmNlTG9hZGluZyA9IHRydWU7DQogICAgICBnZXRQcm9jZXNzSW5zdGFuY2UodGhpcy5pZCkudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgIGlmICghcmVzcG9uc2UuZGF0YSkgew0KICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+afpeivouS4jeWIsOa1geeoi+S/oeaBr++8gScpOw0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICAvLyDorr7nva7mtYHnqIvkv6Hmga8NCiAgICAgICAgdGhpcy5wcm9jZXNzSW5zdGFuY2UgPSByZXNwb25zZS5kYXRhOw0KDQogICAgICAgIC8v5bCG5Lia5Yqh6KGo5Y2V77yM5rOo5YaM5Li65Yqo5oCB57uE5Lu2DQogICAgICAgIGNvbnN0IHBhdGggPSB0aGlzLnByb2Nlc3NJbnN0YW5jZS5wcm9jZXNzRGVmaW5pdGlvbi5mb3JtQ3VzdG9tVmlld1BhdGg7DQogICAgICAgIFZ1ZS5jb21wb25lbnQoImFzeW5jLWJpei1mb3JtLWNvbXBvbmVudCIsIGZ1bmN0aW9uIChyZXNvbHZlKSB7DQogICAgICAgICAgcmVxdWlyZShbYEAvdmlld3Mke3BhdGh9YF0sIHJlc29sdmUpOw0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyDorr7nva7ooajljZXkv6Hmga8NCiAgICAgICAgaWYgKHRoaXMucHJvY2Vzc0luc3RhbmNlLnByb2Nlc3NEZWZpbml0aW9uLmZvcm1UeXBlID09PSAxMCkgew0KICAgICAgICAgIHRoaXMuZGV0YWlsRm9ybSA9IHsNCiAgICAgICAgICAgIC4uLkpTT04ucGFyc2UodGhpcy5wcm9jZXNzSW5zdGFuY2UucHJvY2Vzc0RlZmluaXRpb24uZm9ybUNvbmYpLA0KICAgICAgICAgICAgZGlzYWJsZWQ6IHRydWUsIC8vIOihqOWNleemgeeUqA0KICAgICAgICAgICAgZm9ybUJ0bnM6IGZhbHNlLCAvLyDmjInpkq7pmpDol48NCiAgICAgICAgICAgIGZpZWxkczogZGVjb2RlRmllbGRzKHRoaXMucHJvY2Vzc0luc3RhbmNlLnByb2Nlc3NEZWZpbml0aW9uLmZvcm1GaWVsZHMpDQogICAgICAgICAgfQ0KICAgICAgICAgIC8vIOiuvue9ruihqOWNleeahOWAvA0KICAgICAgICAgIHRoaXMuZGV0YWlsRm9ybS5maWVsZHMuZm9yRWFjaChpdGVtID0+IHsNCiAgICAgICAgICAgIGNvbnN0IHZhbCA9IHRoaXMucHJvY2Vzc0luc3RhbmNlLmZvcm1WYXJpYWJsZXNbaXRlbS5fX3ZNb2RlbF9fXQ0KICAgICAgICAgICAgaWYgKHZhbCkgew0KICAgICAgICAgICAgICBpdGVtLl9fY29uZmlnX18uZGVmYXVsdFZhbHVlID0gdmFsDQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyDliqDovb3mtYHnqIvlm74NCiAgICAgICAgZ2V0UHJvY2Vzc0RlZmluaXRpb25CcG1uWE1MKHRoaXMucHJvY2Vzc0luc3RhbmNlLnByb2Nlc3NEZWZpbml0aW9uLmlkKS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgICB0aGlzLmJwbW5YTUwgPSByZXNwb25zZS5kYXRhDQogICAgICAgIH0pOw0KICAgICAgICAvLyDliqDovb3mtLvliqjliJfooagNCiAgICAgICAgZ2V0QWN0aXZpdHlMaXN0KHsNCiAgICAgICAgICBwcm9jZXNzSW5zdGFuY2VJZDogdGhpcy5wcm9jZXNzSW5zdGFuY2UuaWQNCiAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgICAgdGhpcy5hY3Rpdml0eUxpc3QgPSByZXNwb25zZS5kYXRhOw0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyDlj5bmtojliqDovb3kuK0NCiAgICAgICAgdGhpcy5wcm9jZXNzSW5zdGFuY2VMb2FkaW5nID0gZmFsc2U7DQogICAgICB9KTsNCg0KICAgICAgLy8g6I635b6X5rWB56iL5Lu75Yqh5YiX6KGo77yI5a6h5om56K6w5b2V77yJDQogICAgICB0aGlzLnRhc2tzTG9hZCA9IHRydWU7DQogICAgICB0aGlzLnJ1bm5pbmdUYXNrcyA9IFtdOw0KICAgICAgdGhpcy5hdWRpdEZvcm1zID0gW107DQogICAgICBnZXRUYXNrTGlzdEJ5UHJvY2Vzc0luc3RhbmNlSWQodGhpcy5pZCkudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgIC8vIOWuoeaJueiusOW9lQ0KICAgICAgICB0aGlzLnRhc2tzID0gW107DQogICAgICAgIC8vIOenu+mZpOW3suWPlua2iOeahOWuoeaJuQ0KICAgICAgICByZXNwb25zZS5kYXRhLmZvckVhY2godGFzayA9PiB7DQogICAgICAgICAgaWYgKHRhc2sucmVzdWx0ICE9PSA0KSB7DQogICAgICAgICAgICB0aGlzLnRhc2tzLnB1c2godGFzayk7DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgLy8g5o6S5bqP77yM5bCG5pyq5a6M5oiQ55qE5o6S5Zyo5YmN6Z2i77yM5bey5a6M5oiQ55qE5o6S5Zyo5ZCO6Z2i77ybDQogICAgICAgIHRoaXMudGFza3Muc29ydCgoYSwgYikgPT4gew0KICAgICAgICAgIC8vIOacieW3suWujOaIkOeahOaDheWGte+8jOaMieeFp+WujOaIkOaXtumXtOWAkuW6jw0KICAgICAgICAgIGlmIChhLmVuZFRpbWUgJiYgYi5lbmRUaW1lKSB7DQogICAgICAgICAgICByZXR1cm4gYi5lbmRUaW1lIC0gYS5lbmRUaW1lOw0KICAgICAgICAgIH0gZWxzZSBpZiAoYS5lbmRUaW1lKSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgICB9IGVsc2UgaWYgKGIuZW5kVGltZSkgew0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICAgICAgLy8g6YO95piv5pyq5a6M5oiQ77yM5oyJ54Wn5Yib5bu65pe26Ze05YCS5bqPDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBiLmNyZWF0ZVRpbWUgLSBhLmNyZWF0ZVRpbWU7DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyDpnIDopoHlrqHmoLjnmoTorrDlvZUNCiAgICAgICAgY29uc3QgdXNlcklkID0gc3RvcmUuZ2V0dGVycy51c2VySWQ7DQogICAgICAgIHRoaXMudGFza3MuZm9yRWFjaCh0YXNrID0+IHsNCiAgICAgICAgICBpZiAodGFzay5yZXN1bHQgIT09IDEgJiYgdGFzay5yZXN1bHQgIT09IDYpIHsgLy8g5Y+q5pyJ5b6F5aSE55CG5omN6ZyA6KaBDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmICghdGFzay5hc3NpZ25lZVVzZXIgfHwgdGFzay5hc3NpZ25lZVVzZXIuaWQgIT09IHVzZXJJZCkgeyAvLyDoh6rlt7HkuI3mmK/lpITnkIbkuroNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQogICAgICAgICAgdGhpcy5ydW5uaW5nVGFza3MucHVzaCh7Li4udGFza30pOw0KICAgICAgICAgIHRoaXMuYXVkaXRGb3Jtcy5wdXNoKHsNCiAgICAgICAgICAgIHJlYXNvbjogJycNCiAgICAgICAgICB9KQ0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyDlj5bmtojliqDovb3kuK0NCiAgICAgICAgdGhpcy50YXNrc0xvYWQgPSBmYWxzZTsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgZ2V0RGF0ZVN0YXIobXMpIHsNCiAgICAgIHJldHVybiBnZXREYXRlKG1zKTsNCiAgICB9LA0KICAgIGdldFRpbWVsaW5lSXRlbUljb24oaXRlbSkgew0KICAgICAgaWYgKGl0ZW0ucmVzdWx0ID09PSAxKSB7DQogICAgICAgIHJldHVybiAnZWwtaWNvbi10aW1lJzsNCiAgICAgIH0NCiAgICAgIGlmIChpdGVtLnJlc3VsdCA9PT0gMikgew0KICAgICAgICByZXR1cm4gJ2VsLWljb24tY2hlY2snOw0KICAgICAgfQ0KICAgICAgaWYgKGl0ZW0ucmVzdWx0ID09PSAzKSB7DQogICAgICAgIHJldHVybiAnZWwtaWNvbi1jbG9zZSc7DQogICAgICB9DQogICAgICBpZiAoaXRlbS5yZXN1bHQgPT09IDQpIHsNCiAgICAgICAgcmV0dXJuICdlbC1pY29uLXJlbW92ZS1vdXRsaW5lJzsNCiAgICAgIH0NCiAgICAgIGlmIChpdGVtLnJlc3VsdCA9PT0gNSkgew0KICAgICAgICByZXR1cm4gJ2VsLWljb24tYmFjaycNCiAgICAgIH0NCiAgICAgIHJldHVybiAnJzsNCiAgICB9LA0KICAgIGdldFRpbWVsaW5lSXRlbVR5cGUoaXRlbSkgew0KICAgICAgaWYgKGl0ZW0ucmVzdWx0ID09PSAxKSB7DQogICAgICAgIHJldHVybiAncHJpbWFyeSc7DQogICAgICB9DQogICAgICBpZiAoaXRlbS5yZXN1bHQgPT09IDIpIHsNCiAgICAgICAgcmV0dXJuICdzdWNjZXNzJzsNCiAgICAgIH0NCiAgICAgIGlmIChpdGVtLnJlc3VsdCA9PT0gMykgew0KICAgICAgICByZXR1cm4gJ2Rhbmdlcic7DQogICAgICB9DQogICAgICBpZiAoaXRlbS5yZXN1bHQgPT09IDQpIHsNCiAgICAgICAgcmV0dXJuICdpbmZvJzsNCiAgICAgIH0NCiAgICAgIGlmIChpdGVtLnJlc3VsdCA9PT0gNSkgew0KICAgICAgICByZXR1cm4gJ3dhcm5pbmcnOw0KICAgICAgfQ0KICAgICAgaWYgKGl0ZW0ucmVzdWx0ID09PSA2KSB7DQogICAgICAgIHJldHVybiAnZGVmYXVsdCcNCiAgICAgIH0NCiAgICAgIHJldHVybiAnJzsNCiAgICB9LA0KICAgIC8qKiDlpITnkIblrqHmibnpgJrov4flkozkuI3pgJrov4fnmoTmk43kvZwgKi8NCiAgICBoYW5kbGVBdWRpdCh0YXNrLCBwYXNzKSB7DQogICAgICBjb25zdCBpbmRleCA9IHRoaXMucnVubmluZ1Rhc2tzLmluZGV4T2YodGFzayk7DQogICAgICB0aGlzLiRyZWZzWydmb3JtJyArIGluZGV4XVswXS52YWxpZGF0ZSh2YWxpZCA9PiB7DQogICAgICAgIGlmICghdmFsaWQpIHsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgZGF0YSA9IHsNCiAgICAgICAgICBpZDogdGFzay5pZCwNCiAgICAgICAgICByZWFzb246IHRoaXMuYXVkaXRGb3Jtc1tpbmRleF0ucmVhc29uDQogICAgICAgIH0NCiAgICAgICAgaWYgKHBhc3MpIHsNCiAgICAgICAgICBhcHByb3ZlVGFzayhkYXRhKS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgICAgIHRoaXMuJG1vZGFsLm1zZ1N1Y2Nlc3MoIuWuoeaJuemAmui/h+aIkOWKn++8gSIpOw0KICAgICAgICAgICAgdGhpcy5nZXREZXRhaWwoKTsgLy8g6I635b6X5pyA5paw6K+m5oOFDQogICAgICAgICAgfSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmVqZWN0VGFzayhkYXRhKS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgICAgIHRoaXMuJG1vZGFsLm1zZ1N1Y2Nlc3MoIuWuoeaJueS4jemAmui/h+aIkOWKn++8gSIpOw0KICAgICAgICAgICAgdGhpcy5nZXREZXRhaWwoKTsgLy8g6I635b6X5pyA5paw6K+m5oOFDQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0sDQogICAgLyoqIOWkhOeQhui9rOWKnuWuoeaJueS6uiAqLw0KICAgIGhhbmRsZVVwZGF0ZUFzc2lnbmVlKHRhc2spIHsNCiAgICAgIC8vIOiuvue9ruihqOWNlQ0KICAgICAgdGhpcy5yZXNldFVwZGF0ZUFzc2lnbmVlRm9ybSgpOw0KICAgICAgdGhpcy51cGRhdGVBc3NpZ25lZS5mb3JtLmlkID0gdGFzay5pZDsNCiAgICAgIC8vIOiuvue9ruS4uuaJk+W8gA0KICAgICAgdGhpcy51cGRhdGVBc3NpZ25lZS5vcGVuID0gdHJ1ZTsNCiAgICB9LA0KICAgIC8qKiDmj5DkuqTovazlip7lrqHmibnkurogKi8NCiAgICBzdWJtaXRVcGRhdGVBc3NpZ25lZUZvcm0oKSB7DQogICAgICB0aGlzLiRyZWZzWyd1cGRhdGVBc3NpZ25lZUZvcm0nXS52YWxpZGF0ZSh2YWxpZCA9PiB7DQogICAgICAgIGlmICghdmFsaWQpIHsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdXBkYXRlVGFza0Fzc2lnbmVlKHRoaXMudXBkYXRlQXNzaWduZWUuZm9ybSkudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgICAgdGhpcy4kbW9kYWwubXNnU3VjY2Vzcygi6L2s5Yqe5Lu75Yqh5oiQ5Yqf77yBIik7DQogICAgICAgICAgdGhpcy51cGRhdGVBc3NpZ25lZS5vcGVuID0gZmFsc2U7DQogICAgICAgICAgdGhpcy5nZXREZXRhaWwoKTsgLy8g6I635b6X5pyA5paw6K+m5oOFDQogICAgICAgIH0pOw0KICAgICAgfSk7DQogICAgfSwNCiAgICAvKiog5Y+W5raI6L2s5Yqe5a6h5om55Lq6ICovDQogICAgY2FuY2VsVXBkYXRlQXNzaWduZWVGb3JtKCkgew0KICAgICAgdGhpcy51cGRhdGVBc3NpZ25lZS5vcGVuID0gZmFsc2U7DQogICAgICB0aGlzLnJlc2V0VXBkYXRlQXNzaWduZWVGb3JtKCk7DQogICAgfSwNCiAgICAvKiog6YeN572u6L2s5Yqe5a6h5om55Lq6ICovDQogICAgcmVzZXRVcGRhdGVBc3NpZ25lZUZvcm0oKSB7DQogICAgICB0aGlzLnVwZGF0ZUFzc2lnbmVlLmZvcm0gPSB7DQogICAgICAgIGlkOiB1bmRlZmluZWQsDQogICAgICAgIGFzc2lnbmVlVXNlcklkOiB1bmRlZmluZWQsDQogICAgICB9Ow0KICAgICAgdGhpcy5yZXNldEZvcm0oInVwZGF0ZUFzc2lnbmVlRm9ybSIpOw0KICAgIH0sDQogICAgLyoqIOWkhOeQhuWuoeaJueWnlOa0vueahOaTjeS9nCAqLw0KICAgIGhhbmRsZURlbGVnYXRlKHRhc2spIHsNCiAgICAgIC8vdGhpcy4kbW9kYWwubXNnRXJyb3IoIuaaguS4jeaUr+aMgeOAkOWnlOa0vuOAkeWKn+iDve+8jOWPr+S7peS9v+eUqOOAkOi9rOa0vuOAkeabv+S7o++8gSIpOw0KICAgICAgdGhpcy5yZXNldFVwZGF0ZURlbGVnYXRlRm9ybSgpOw0KICAgICAgdGhpcy51cGRhdGVEZWxlZ2F0ZS5mb3JtLmlkID0gdGFzay5pZDsNCiAgICAgIC8vIOiuvue9ruS4uuaJk+W8gA0KICAgICAgdGhpcy51cGRhdGVEZWxlZ2F0ZS5vcGVuID0gdHJ1ZTsNCiAgICB9LA0KICAgIC8qKiDmj5DkuqTlp5TmtL7lrqHmibnkurogKi8NCiAgICBzdWJtaXRVcGRhdGVEZWxlZ2F0ZUZvcm0oKSB7DQogICAgICB0aGlzLiRyZWZzWyd1cGRhdGVEZWxlZ2F0ZUZvcm0nXS52YWxpZGF0ZSh2YWxpZCA9PiB7DQogICAgICAgIGlmICghdmFsaWQpIHsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgZGVsZWdhdGVUYXNrKHRoaXMudXBkYXRlRGVsZWdhdGUuZm9ybSkudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgICAgdGhpcy4kbW9kYWwubXNnU3VjY2Vzcygi5aeU5rS+5Lu75Yqh5oiQ5Yqf77yBIik7DQogICAgICAgICAgdGhpcy51cGRhdGVEZWxlZ2F0ZS5vcGVuID0gZmFsc2U7DQogICAgICAgICAgdGhpcy5nZXREZXRhaWwoKTsgLy8g6I635b6X5pyA5paw6K+m5oOFDQogICAgICAgIH0pOw0KICAgICAgfSk7DQogICAgfSwNCiAgICAvKiog5Y+W5raI5aeU5rS+5a6h5om55Lq6ICovDQogICAgY2FuY2VsVXBkYXRlRGVsZWdhdGVGb3JtKCkgew0KICAgICAgdGhpcy51cGRhdGVEZWxlZ2F0ZS5vcGVuID0gZmFsc2U7DQogICAgICB0aGlzLnJlc2V0VXBkYXRlRGVsZWdhdGVGb3JtKCk7DQogICAgfSwNCiAgICAvKiog6YeN572u5aeU5rS+5a6h5om55Lq6ICovDQogICAgcmVzZXRVcGRhdGVEZWxlZ2F0ZUZvcm0oKSB7DQogICAgICB0aGlzLnVwZGF0ZURlbGVnYXRlLmZvcm0gPSB7DQogICAgICAgIGlkOiB1bmRlZmluZWQsDQogICAgICAgIGRlbGVnYXRlVXNlcklkOiB1bmRlZmluZWQsDQogICAgICB9Ow0KICAgICAgdGhpcy5yZXNldEZvcm0oInVwZGF0ZURlbGVnYXRlRm9ybSIpOw0KICAgIH0sDQogICAgLyoqIOWkhOeQhuWuoeaJuemAgOWbnueahOaTjeS9nCAqLw0KICAgIC8qKiDov5Tlm57pgIDlm57oioLngrnliJfooaggKi8NCiAgICBoYW5kbGVCYWNrTGlzdCh0YXNrKSB7DQogICAgICAvLyDlj6/lj4LogIMgaHR0cDovL2Jsb2cud3lhMS5jb20vYXJ0aWNsZS82MzY2OTcwMzAvZGV0YWlscy83Mjk2DQogICAgICBnZXRSZXR1cm5MaXN0KHRhc2suaWQpLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICB0aGlzLnJldHVybkxpc3QgPSByZXNwb25zZS5kYXRhOw0KICAgICAgICBpZiAodGhpcy5yZXR1cm5MaXN0Lmxlbmd0aCA9PSAwKSB7DQogICAgICAgICAgdGhpcy4kbW9kYWwubXNnRXJyb3IoIuW9k+WJjeayoeacieWPr+WbnumAgOeahOiKgueCue+8gSIpOw0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmZvcm1EYXRhLmlkID0gdGFzay5pZDsNCiAgICAgICAgdGhpcy5yZXR1cm5PcGVuID0gdHJ1ZTsNCiAgICAgIH0pOw0KDQogICAgfSwNCiAgICAvKiog5o+Q5Lqk6YCA5Zue5Lu75YqhICovDQogICAgc3VibWl0UmV0dXJuKCkgew0KICAgICAgaWYgKCF0aGlzLmZvcm1EYXRhLnRhcmdldERlZmluaXRpb25LZXkpIHsNCiAgICAgICAgdGhpcy4kbW9kYWwubXNnRXJyb3IoIuivt+mAieaLqemAgOWbnuiKgueCue+8gSIpOw0KICAgICAgfQ0KICAgICAgdGhpcy4kcmVmc1snZm9ybVJlZiddLnZhbGlkYXRlKHZhbGlkID0+IHsNCiAgICAgICAgaWYgKCF2YWxpZCkgew0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm5UYXNrKHRoaXMuZm9ybURhdGEpLnRoZW4ocmVzID0+IHsNCiAgICAgICAgICBpZiAocmVzLmRhdGEpIHsNCiAgICAgICAgICAgIHRoaXMuJG1vZGFsLm1zZ1N1Y2Nlc3MoIuWbnumAgOaIkOWKn++8gSIpOw0KICAgICAgICAgICAgdGhpcy5yZXR1cm5PcGVuID0gZmFsc2U7DQogICAgICAgICAgICB0aGlzLmdldERldGFpbCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICB9KTsNCiAgICB9DQogIH0NCn07DQo="},{"version":3,"sources":["detail.vue"],"names":[],"mappings":";AAyJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"detail.vue","sourceRoot":"src/views/bpm/processInstance","sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <!-- 审批信息 -->\r\n    <el-card class=\"box-card\" v-loading=\"processInstanceLoading\" v-for=\"(item, index) in runningTasks\" :key=\"index\">\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <span class=\"el-icon-picture-outline\">审批任务【{{ item.name }}】</span>\r\n      </div>\r\n      <el-col :span=\"16\" :offset=\"6\">\r\n        <el-form :ref=\"'form' + index\" :model=\"auditForms[index]\" :rules=\"auditRule\" label-width=\"100px\">\r\n          <el-form-item label=\"流程名\" v-if=\"processInstance && processInstance.name\">\r\n            {{ processInstance.name }}\r\n          </el-form-item>\r\n          <el-form-item label=\"流程发起人\" v-if=\"processInstance && processInstance.startUser\">\r\n            {{ processInstance.startUser.nickname }}\r\n            <el-tag type=\"info\" size=\"mini\">{{ processInstance.startUser.deptName }}</el-tag>\r\n          </el-form-item>\r\n          <el-form-item label=\"审批建议\" prop=\"reason\">\r\n            <el-input type=\"textarea\" v-model=\"auditForms[index].reason\" placeholder=\"请输入审批建议\"/>\r\n          </el-form-item>\r\n        </el-form>\r\n        <div style=\"margin-left: 10%; margin-bottom: 20px; font-size: 14px;\">\r\n          <el-button icon=\"el-icon-edit-outline\" type=\"success\" size=\"mini\" @click=\"handleAudit(item, true)\">通过\r\n          </el-button>\r\n          <el-button icon=\"el-icon-circle-close\" type=\"danger\" size=\"mini\" @click=\"handleAudit(item, false)\">不通过\r\n          </el-button>\r\n          <el-button icon=\"el-icon-edit-outline\" type=\"primary\" size=\"mini\" @click=\"handleUpdateAssignee(item)\">转办\r\n          </el-button>\r\n          <el-button icon=\"el-icon-edit-outline\" type=\"primary\" size=\"mini\" @click=\"handleDelegate(item)\">委派\r\n          </el-button>\r\n          <el-button icon=\"el-icon-refresh-left\" type=\"warning\" size=\"mini\" @click=\"handleBackList(item)\">退回\r\n          </el-button>\r\n        </div>\r\n      </el-col>\r\n    </el-card>\r\n    <!-- 申请信息 -->\r\n    <el-card class=\"box-card\" v-loading=\"processInstanceLoading\">\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <span class=\"el-icon-document\">申请信息【{{ processInstance.name }}】</span>\r\n      </div>\r\n      <el-col v-if=\"this.processInstance.processDefinition && this.processInstance.processDefinition.formType === 10\"\r\n              :span=\"16\" :offset=\"6\">\r\n        <div>\r\n          <parser :key=\"new Date().getTime()\" :form-conf=\"detailForm\"/>\r\n        </div>\r\n      </el-col>\r\n      <div v-if=\"this.processInstance.processDefinition && this.processInstance.processDefinition.formType === 20\">\r\n        <async-biz-form-component :id=\"this.processInstance.businessKey\"></async-biz-form-component>\r\n      </div>\r\n    </el-card>\r\n\r\n    <!-- 审批记录 -->\r\n    <el-card class=\"box-card\" v-loading=\"tasksLoad\">\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <span class=\"el-icon-picture-outline\">审批记录</span>\r\n      </div>\r\n      <el-col :span=\"16\" :offset=\"4\">\r\n        <div class=\"block\">\r\n          <el-timeline>\r\n            <el-timeline-item v-for=\"(item, index) in tasks\" :key=\"index\"\r\n                              :icon=\"getTimelineItemIcon(item)\" :type=\"getTimelineItemType(item)\">\r\n              <p style=\"font-weight: 700\">任务：{{ item.name }}</p>\r\n              <el-card :body-style=\"{ padding: '10px' }\">\r\n                <label v-if=\"item.assigneeUser\" style=\"font-weight: normal; margin-right: 30px;\">\r\n                  审批人：{{ item.assigneeUser.nickname }}\r\n                  <el-tag type=\"info\" size=\"mini\">{{ item.assigneeUser.deptName }}</el-tag>\r\n                </label>\r\n                <label style=\"font-weight: normal\" v-if=\"item.createTime\">创建时间：</label>\r\n                <label style=\"color:#8a909c; font-weight: normal\">{{ parseTime(item.createTime) }}</label>\r\n                <label v-if=\"item.endTime\" style=\"margin-left: 30px;font-weight: normal\">审批时间：</label>\r\n                <label v-if=\"item.endTime\" style=\"color:#8a909c;font-weight: normal\"> {{\r\n                    parseTime(item.endTime)\r\n                  }}</label>\r\n                <label v-if=\"item.durationInMillis\" style=\"margin-left: 30px;font-weight: normal\">耗时：</label>\r\n                <label v-if=\"item.durationInMillis\" style=\"color:#8a909c;font-weight: normal\">\r\n                  {{ getDateStar(item.durationInMillis) }} </label>\r\n                <p v-if=\"item.reason\">\r\n                  <el-tag :type=\"getTimelineItemType(item)\">{{ item.reason }}</el-tag>\r\n                </p>\r\n              </el-card>\r\n            </el-timeline-item>\r\n          </el-timeline>\r\n        </div>\r\n      </el-col>\r\n    </el-card>\r\n\r\n    <!-- 高亮流程图 -->\r\n    <el-card class=\"box-card\" v-loading=\"processInstanceLoading\">\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <span class=\"el-icon-picture-outline\">流程图</span>\r\n      </div>\r\n      <my-process-viewer key=\"designer\" v-model=\"bpmnXML\" v-bind=\"bpmnControlForm\" :activityData=\"activityList\"\r\n                         :processInstanceData=\"processInstance\" :taskData=\"tasks\"/>\r\n    </el-card>\r\n\r\n    <!-- 对话框(转办审批人) -->\r\n    <el-dialog title=\"转办审批人\" :visible.sync=\"updateAssignee.open\" width=\"500px\" append-to-body>\r\n      <el-form ref=\"updateAssigneeForm\" :model=\"updateAssignee.form\" :rules=\"updateAssignee.rules\" label-width=\"110px\">\r\n        <el-form-item label=\"新审批人\" prop=\"assigneeUserId\">\r\n          <el-select v-model=\"updateAssignee.form.assigneeUserId\" clearable style=\"width: 100%\">\r\n            <el-option v-for=\"item in userOptions\" :key=\"parseInt(item.id)\" :label=\"item.nickname\"\r\n                       :value=\"parseInt(item.id)\"/>\r\n          </el-select>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button type=\"primary\" @click=\"submitUpdateAssigneeForm\">确 定</el-button>\r\n        <el-button @click=\"cancelUpdateAssigneeForm\">取 消</el-button>\r\n      </div>\r\n    </el-dialog>\r\n    <!-- 对话框(委派审批人) -->\r\n    <el-dialog title=\"委派审批人\" :visible.sync=\"updateDelegate.open\" width=\"500px\" append-to-body>\r\n      <el-form ref=\"updateDelegateForm\" :model=\"updateDelegate.form\" :rules=\"updateDelegate.rules\" label-width=\"110px\">\r\n        <el-form-item label=\"新审批人\" prop=\"assigneeUserId\">\r\n          <el-select v-model=\"updateDelegate.form.delegateUserId\" clearable style=\"width: 100%\">\r\n            <el-option v-for=\"item in userOptions\" :key=\"parseInt(item.id)\" :label=\"item.nickname\"\r\n                       :value=\"parseInt(item.id)\"/>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"委派理由\" prop=\"reason\">\r\n          <el-input v-model=\"updateDelegate.form.reason\" clearable placeholder=\"请输入委派理由\"/>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button type=\"primary\" @click=\"submitUpdateDelegateForm\">确 定</el-button>\r\n        <el-button @click=\"cancelUpdateDelegateForm\">取 消</el-button>\r\n      </div>\r\n    </el-dialog>\r\n    <!--退回流程-->\r\n    <el-dialog title=\"退回流程\" :visible.sync=\"returnOpen\" width=\"40%\" append-to-body>\r\n      <el-form ref=\"formRef\" v-loading=\"formLoading\" :model=\"formData\" :rules=\"formRules\" label-width=\"110px\">\r\n        <el-form-item label=\"退回节点\" prop=\"targetDefinitionKey\">\r\n          <el-select v-model=\"formData.targetDefinitionKey\" clearable style=\"width: 100%\">\r\n            <el-option\r\n              v-for=\"item in returnList\"\r\n              :key=\"item.definitionKey\"\r\n              :label=\"item.name\"\r\n              :value=\"item.definitionKey\"\r\n            />\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"回退理由\" prop=\"reason\">\r\n          <el-input v-model=\"formData.reason\" clearable placeholder=\"请输入回退理由\"/>\r\n        </el-form-item>\r\n      </el-form>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"returnOpen = false\">取 消</el-button>\r\n        <el-button :disabled=\"formLoading\" type=\"primary\" @click=\"submitReturn\">确 定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {getProcessDefinitionBpmnXML} from \"@/api/bpm/definition\";\r\nimport store from \"@/store\";\r\nimport {decodeFields} from \"@/utils/formGenerator\";\r\nimport Parser from '@/components/parser/Parser'\r\nimport {getProcessInstance} from \"@/api/bpm/processInstance\";\r\nimport {\r\n  approveTask,\r\n  delegateTask,\r\n  getReturnList,\r\n  getTaskListByProcessInstanceId,\r\n  rejectTask,\r\n  returnTask,\r\n  updateTaskAssignee,\r\n} from \"@/api/bpm/task\";\r\nimport {getDate} from \"@/utils/dateUtils\";\r\nimport {listSimpleUsers} from \"@/api/system/user\";\r\nimport {getActivityList} from \"@/api/bpm/activity\";\r\nimport Vue from \"vue\";\r\n\r\n// 流程实例的详情页，可用于审批\r\nexport default {\r\n  name: \"ProcessInstanceDetail\",\r\n  components: {\r\n    Parser\r\n  },\r\n  data() {\r\n    return {\r\n      // 遮罩层\r\n      processInstanceLoading: true,\r\n      // 流程实例\r\n      id: undefined, // 流程实例的编号\r\n      processInstance: {},\r\n      formLoading: false,\r\n      // 流程表单详情\r\n      detailForm: {\r\n        fields: []\r\n      },\r\n      //回退列表数据\r\n      returnList: [],\r\n      formData: {\r\n        id: '',\r\n        targetDefinitionKey: undefined,\r\n        reason: ''\r\n      },\r\n      formRules: {\r\n        targetDefinitionKey: [{required: true, message: '必须选择回退节点', trigger: 'change'}],\r\n        reason: [{required: true, message: '回退理由不能为空', trigger: 'blur'}]\r\n      },\r\n      returnOpen: false,\r\n      // BPMN 数据\r\n      bpmnXML: null,\r\n      bpmnControlForm: {\r\n        prefix: \"flowable\"\r\n      },\r\n      activityList: [],\r\n\r\n      // 审批记录\r\n      tasksLoad: true,\r\n      tasks: [],\r\n\r\n      // 审批表单\r\n      runningTasks: [],\r\n      auditForms: [],\r\n      auditRule: {\r\n        reason: [{required: true, message: \"审批建议不能为空\", trigger: \"blur\"}],\r\n      },\r\n      // 转派审批人\r\n      userOptions: [],\r\n      updateAssignee: {\r\n        open: false,\r\n        form: {\r\n          assigneeUserId: undefined,\r\n        },\r\n        rules: {\r\n          assigneeUserId: [{required: true, message: \"新审批人不能为空\", trigger: \"change\"}],\r\n        }\r\n      },\r\n      updateDelegate: {\r\n        open: false,\r\n        form: {\r\n          delegateUserId: undefined,\r\n          reason: ''\r\n        },\r\n        rules: {\r\n          delegateUserId: [{required: true, message: \"新审批人不能为空\", trigger: \"change\"}],\r\n          reason: [{required: true, message: '委派理由不能为空', trigger: 'blur'}]\r\n        }\r\n      }\r\n    };\r\n  },\r\n  created() {\r\n    this.id = this.$route.query.id;\r\n    if (!this.id) {\r\n      this.$message.error('未传递 id 参数，无法查看流程信息');\r\n      return;\r\n    }\r\n    this.getDetail();\r\n\r\n    // 获得用户列表\r\n    this.userOptions = [];\r\n    listSimpleUsers().then(response => {\r\n      this.userOptions.push(...response.data);\r\n    });\r\n  },\r\n  methods: {\r\n    /** 获得流程实例 */\r\n    getDetail() {\r\n      // 获得流程实例相关\r\n      this.processInstanceLoading = true;\r\n      getProcessInstance(this.id).then(response => {\r\n        if (!response.data) {\r\n          this.$message.error('查询不到流程信息！');\r\n          return;\r\n        }\r\n        // 设置流程信息\r\n        this.processInstance = response.data;\r\n\r\n        //将业务表单，注册为动态组件\r\n        const path = this.processInstance.processDefinition.formCustomViewPath;\r\n        Vue.component(\"async-biz-form-component\", function (resolve) {\r\n          require([`@/views${path}`], resolve);\r\n        });\r\n\r\n        // 设置表单信息\r\n        if (this.processInstance.processDefinition.formType === 10) {\r\n          this.detailForm = {\r\n            ...JSON.parse(this.processInstance.processDefinition.formConf),\r\n            disabled: true, // 表单禁用\r\n            formBtns: false, // 按钮隐藏\r\n            fields: decodeFields(this.processInstance.processDefinition.formFields)\r\n          }\r\n          // 设置表单的值\r\n          this.detailForm.fields.forEach(item => {\r\n            const val = this.processInstance.formVariables[item.__vModel__]\r\n            if (val) {\r\n              item.__config__.defaultValue = val\r\n            }\r\n          });\r\n        }\r\n\r\n        // 加载流程图\r\n        getProcessDefinitionBpmnXML(this.processInstance.processDefinition.id).then(response => {\r\n          this.bpmnXML = response.data\r\n        });\r\n        // 加载活动列表\r\n        getActivityList({\r\n          processInstanceId: this.processInstance.id\r\n        }).then(response => {\r\n          this.activityList = response.data;\r\n        });\r\n\r\n        // 取消加载中\r\n        this.processInstanceLoading = false;\r\n      });\r\n\r\n      // 获得流程任务列表（审批记录）\r\n      this.tasksLoad = true;\r\n      this.runningTasks = [];\r\n      this.auditForms = [];\r\n      getTaskListByProcessInstanceId(this.id).then(response => {\r\n        // 审批记录\r\n        this.tasks = [];\r\n        // 移除已取消的审批\r\n        response.data.forEach(task => {\r\n          if (task.result !== 4) {\r\n            this.tasks.push(task);\r\n          }\r\n        });\r\n        // 排序，将未完成的排在前面，已完成的排在后面；\r\n        this.tasks.sort((a, b) => {\r\n          // 有已完成的情况，按照完成时间倒序\r\n          if (a.endTime && b.endTime) {\r\n            return b.endTime - a.endTime;\r\n          } else if (a.endTime) {\r\n            return 1;\r\n          } else if (b.endTime) {\r\n            return -1;\r\n            // 都是未完成，按照创建时间倒序\r\n          } else {\r\n            return b.createTime - a.createTime;\r\n          }\r\n        });\r\n\r\n        // 需要审核的记录\r\n        const userId = store.getters.userId;\r\n        this.tasks.forEach(task => {\r\n          if (task.result !== 1 && task.result !== 6) { // 只有待处理才需要\r\n            return;\r\n          }\r\n          if (!task.assigneeUser || task.assigneeUser.id !== userId) { // 自己不是处理人\r\n            return;\r\n          }\r\n          this.runningTasks.push({...task});\r\n          this.auditForms.push({\r\n            reason: ''\r\n          })\r\n        });\r\n\r\n        // 取消加载中\r\n        this.tasksLoad = false;\r\n      });\r\n    },\r\n    getDateStar(ms) {\r\n      return getDate(ms);\r\n    },\r\n    getTimelineItemIcon(item) {\r\n      if (item.result === 1) {\r\n        return 'el-icon-time';\r\n      }\r\n      if (item.result === 2) {\r\n        return 'el-icon-check';\r\n      }\r\n      if (item.result === 3) {\r\n        return 'el-icon-close';\r\n      }\r\n      if (item.result === 4) {\r\n        return 'el-icon-remove-outline';\r\n      }\r\n      if (item.result === 5) {\r\n        return 'el-icon-back'\r\n      }\r\n      return '';\r\n    },\r\n    getTimelineItemType(item) {\r\n      if (item.result === 1) {\r\n        return 'primary';\r\n      }\r\n      if (item.result === 2) {\r\n        return 'success';\r\n      }\r\n      if (item.result === 3) {\r\n        return 'danger';\r\n      }\r\n      if (item.result === 4) {\r\n        return 'info';\r\n      }\r\n      if (item.result === 5) {\r\n        return 'warning';\r\n      }\r\n      if (item.result === 6) {\r\n        return 'default'\r\n      }\r\n      return '';\r\n    },\r\n    /** 处理审批通过和不通过的操作 */\r\n    handleAudit(task, pass) {\r\n      const index = this.runningTasks.indexOf(task);\r\n      this.$refs['form' + index][0].validate(valid => {\r\n        if (!valid) {\r\n          return;\r\n        }\r\n        const data = {\r\n          id: task.id,\r\n          reason: this.auditForms[index].reason\r\n        }\r\n        if (pass) {\r\n          approveTask(data).then(response => {\r\n            this.$modal.msgSuccess(\"审批通过成功！\");\r\n            this.getDetail(); // 获得最新详情\r\n          });\r\n        } else {\r\n          rejectTask(data).then(response => {\r\n            this.$modal.msgSuccess(\"审批不通过成功！\");\r\n            this.getDetail(); // 获得最新详情\r\n          });\r\n        }\r\n      });\r\n    },\r\n    /** 处理转办审批人 */\r\n    handleUpdateAssignee(task) {\r\n      // 设置表单\r\n      this.resetUpdateAssigneeForm();\r\n      this.updateAssignee.form.id = task.id;\r\n      // 设置为打开\r\n      this.updateAssignee.open = true;\r\n    },\r\n    /** 提交转办审批人 */\r\n    submitUpdateAssigneeForm() {\r\n      this.$refs['updateAssigneeForm'].validate(valid => {\r\n        if (!valid) {\r\n          return;\r\n        }\r\n        updateTaskAssignee(this.updateAssignee.form).then(response => {\r\n          this.$modal.msgSuccess(\"转办任务成功！\");\r\n          this.updateAssignee.open = false;\r\n          this.getDetail(); // 获得最新详情\r\n        });\r\n      });\r\n    },\r\n    /** 取消转办审批人 */\r\n    cancelUpdateAssigneeForm() {\r\n      this.updateAssignee.open = false;\r\n      this.resetUpdateAssigneeForm();\r\n    },\r\n    /** 重置转办审批人 */\r\n    resetUpdateAssigneeForm() {\r\n      this.updateAssignee.form = {\r\n        id: undefined,\r\n        assigneeUserId: undefined,\r\n      };\r\n      this.resetForm(\"updateAssigneeForm\");\r\n    },\r\n    /** 处理审批委派的操作 */\r\n    handleDelegate(task) {\r\n      //this.$modal.msgError(\"暂不支持【委派】功能，可以使用【转派】替代！\");\r\n      this.resetUpdateDelegateForm();\r\n      this.updateDelegate.form.id = task.id;\r\n      // 设置为打开\r\n      this.updateDelegate.open = true;\r\n    },\r\n    /** 提交委派审批人 */\r\n    submitUpdateDelegateForm() {\r\n      this.$refs['updateDelegateForm'].validate(valid => {\r\n        if (!valid) {\r\n          return;\r\n        }\r\n        delegateTask(this.updateDelegate.form).then(response => {\r\n          this.$modal.msgSuccess(\"委派任务成功！\");\r\n          this.updateDelegate.open = false;\r\n          this.getDetail(); // 获得最新详情\r\n        });\r\n      });\r\n    },\r\n    /** 取消委派审批人 */\r\n    cancelUpdateDelegateForm() {\r\n      this.updateDelegate.open = false;\r\n      this.resetUpdateDelegateForm();\r\n    },\r\n    /** 重置委派审批人 */\r\n    resetUpdateDelegateForm() {\r\n      this.updateDelegate.form = {\r\n        id: undefined,\r\n        delegateUserId: undefined,\r\n      };\r\n      this.resetForm(\"updateDelegateForm\");\r\n    },\r\n    /** 处理审批退回的操作 */\r\n    /** 返回退回节点列表 */\r\n    handleBackList(task) {\r\n      // 可参考 http://blog.wya1.com/article/636697030/details/7296\r\n      getReturnList(task.id).then(response => {\r\n        this.returnList = response.data;\r\n        if (this.returnList.length == 0) {\r\n          this.$modal.msgError(\"当前没有可回退的节点！\");\r\n          return;\r\n        }\r\n        this.formData.id = task.id;\r\n        this.returnOpen = true;\r\n      });\r\n\r\n    },\r\n    /** 提交退回任务 */\r\n    submitReturn() {\r\n      if (!this.formData.targetDefinitionKey) {\r\n        this.$modal.msgError(\"请选择退回节点！\");\r\n      }\r\n      this.$refs['formRef'].validate(valid => {\r\n        if (!valid) {\r\n          return;\r\n        }\r\n        returnTask(this.formData).then(res => {\r\n          if (res.data) {\r\n            this.$modal.msgSuccess(\"回退成功！\");\r\n            this.returnOpen = false;\r\n            this.getDetail();\r\n          }\r\n        });\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.my-process-designer {\r\n  height: calc(100vh - 200px);\r\n}\r\n\r\n.box-card {\r\n  width: 100%;\r\n  margin-bottom: 20px;\r\n}\r\n</style>\r\n"]}]}