{"remainingRequest":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\mp\\components\\wx-voice-play\\main.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\src\\views\\mp\\components\\wx-voice-play\\main.vue","mtime":1704630438016},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\89425\\IdeaProjects\\qr-code-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQovLyDlm6DkuLrlvq7kv6Hor63pn7PmmK8gYW1yIOagvOW8j++8jOaJgOS7pemcgOimgeeUqOWIsCBhbXIg6Kej56CB5Zmo77yaaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvYmVuei1hbXItcmVjb3JkZXINCmNvbnN0IEJlbnpBTVJSZWNvcmRlciA9IHJlcXVpcmUoJ2JlbnotYW1yLXJlY29yZGVyJykNCg0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAid3hWb2ljZVBsYXllciIsDQogIHByb3BzOiB7DQogICAgdXJsOiB7IC8vIOivremfs+WcsOWdgO+8jOS+i+WmguivtO+8mmh0dHBzOi8vd3d3LmlvY29kZXIuY24veHh4LmFtcg0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgICAgcmVxdWlyZWQ6IHRydWUNCiAgICB9LA0KICAgIGNvbnRlbnQ6IHsgLy8g6K+t6Z+z5paH5pysDQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgICByZXF1aXJlZDogZmFsc2UNCiAgICB9DQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGFtcjogdW5kZWZpbmVkLCAvLyBCZW56QU1SUmVjb3JkZXIg5a+56LGhDQogICAgICBwbGF5aW5nOiBmYWxzZSwgLy8g5piv5ZCm5Zyo5pKt5pS+5LitDQogICAgICBkdXJhdGlvbjogdW5kZWZpbmVkLCAvLyDmkq3mlL7ml7bplb8NCiAgICB9DQogIH0sDQogIG1ldGhvZHM6ew0KICAgIHBsYXlWb2ljZSgpIHsNCiAgICAgIGRlYnVnZ2VyDQogICAgICAvLyDmg4XlhrXkuIDvvJrmnKrliJ3lp4vljJbvvIzliJnliJvlu7ogQmVuekFNUlJlY29yZGVyDQogICAgICBpZiAodGhpcy5hbXIgPT09IHVuZGVmaW5lZCl7DQogICAgICAgIHRoaXMuYW1ySW5pdCgpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIGlmICh0aGlzLmFtci5pc1BsYXlpbmcoKSkgew0KICAgICAgICB0aGlzLmFtclN0b3AoKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuYW1yUGxheSgpOw0KICAgICAgfQ0KICAgIH0sDQogICAgYW1ySW5pdCgpIHsNCiAgICAgIGNvbnN0IGFtciA9IG5ldyBCZW56QU1SUmVjb3JkZXIoKTsNCiAgICAgIHRoaXMuYW1yID0gYW1yOw0KICAgICAgLy8g6K6+572u5pKt5pS+DQogICAgICBjb25zdCB0aGF0ID0gdGhpcw0KICAgICAgYW1yLmluaXRXaXRoVXJsKHRoaXMudXJsKS50aGVuKGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGF0LmFtclBsYXkoKQ0KICAgICAgICB0aGF0LmR1cmF0aW9uID0gYW1yLmdldER1cmF0aW9uKCk7DQogICAgICB9KQ0KICAgICAgLy8g55uR5ZCs5pqC5YGcDQogICAgICBhbXIub25FbmRlZChmdW5jdGlvbigpIHsNCiAgICAgICAgdGhhdC5wbGF5aW5nID0gZmFsc2U7DQogICAgICB9KQ0KICAgIH0sDQogICAgYW1yUGxheSgpIHsNCiAgICAgIHRoaXMucGxheWluZyA9IHRydWU7DQogICAgICB0aGlzLmFtci5wbGF5KCkNCiAgICB9LA0KICAgIGFtclN0b3AoKSB7DQogICAgICB0aGlzLnBsYXlpbmcgPSBmYWxzZTsNCiAgICAgIHRoaXMuYW1yLnN0b3AoKQ0KICAgIH0sDQogIH0NCn07DQo="},{"version":3,"sources":["main.vue"],"names":[],"mappings":";AAwBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"main.vue","sourceRoot":"src/views/mp/components/wx-voice-play","sourcesContent":["<!--\r\n  - Copyright (C) 2018-2019\r\n  - All rights reserved, Designed By www.joolun.com\r\n  【微信消息 - 语音】\r\n   芋道源码：\r\n  ① bug 修复：\r\n    1）joolun 的做法：使用 mediaId 从微信公众号，下载对应的 mp4 素材，从而播放内容；\r\n      存在的问题：mediaId 有效期是 3 天，超过时间后无法播放\r\n    2）重构后的做法：后端接收到微信公众号的视频消息后，将视频消息的 media_id 的文件内容保存到文件服务器中，这样前端可以直接使用 URL 播放。\r\n  ② 代码优化：将 props 中的 objData 调成为 data 中对应的属性，并补充相关注释\r\n-->\r\n<template>\r\n  <div class=\"wx-voice-div\" @click=\"playVoice\">\r\n    <i :class=\"playing !== true ? 'el-icon-video-play': 'el-icon-video-pause'\">\r\n      <span class=\"amr-duration\" v-if=\"duration\">{{ duration }} 秒</span>\r\n    </i>\r\n    <div v-if=\"content\">\r\n      <el-tag type=\"success\" size=\"mini\">语音识别</el-tag>\r\n      {{ content }}\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// 因为微信语音是 amr 格式，所以需要用到 amr 解码器：https://www.npmjs.com/package/benz-amr-recorder\r\nconst BenzAMRRecorder = require('benz-amr-recorder')\r\n\r\nexport default {\r\n  name: \"wxVoicePlayer\",\r\n  props: {\r\n    url: { // 语音地址，例如说：https://www.iocoder.cn/xxx.amr\r\n      type: String,\r\n      required: true\r\n    },\r\n    content: { // 语音文本\r\n      type: String,\r\n      required: false\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      amr: undefined, // BenzAMRRecorder 对象\r\n      playing: false, // 是否在播放中\r\n      duration: undefined, // 播放时长\r\n    }\r\n  },\r\n  methods:{\r\n    playVoice() {\r\n      debugger\r\n      // 情况一：未初始化，则创建 BenzAMRRecorder\r\n      if (this.amr === undefined){\r\n        this.amrInit();\r\n        return;\r\n      }\r\n\r\n      if (this.amr.isPlaying()) {\r\n        this.amrStop();\r\n      } else {\r\n        this.amrPlay();\r\n      }\r\n    },\r\n    amrInit() {\r\n      const amr = new BenzAMRRecorder();\r\n      this.amr = amr;\r\n      // 设置播放\r\n      const that = this\r\n      amr.initWithUrl(this.url).then(function() {\r\n        that.amrPlay()\r\n        that.duration = amr.getDuration();\r\n      })\r\n      // 监听暂停\r\n      amr.onEnded(function() {\r\n        that.playing = false;\r\n      })\r\n    },\r\n    amrPlay() {\r\n      this.playing = true;\r\n      this.amr.play()\r\n    },\r\n    amrStop() {\r\n      this.playing = false;\r\n      this.amr.stop()\r\n    },\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n  .wx-voice-div {\r\n    padding: 5px;\r\n    background-color: #eaeaea;\r\n    border-radius: 10px;\r\n  }\r\n  .amr-duration {\r\n    font-size: 11px;\r\n    margin-left: 5px;\r\n  }\r\n</style>\r\n"]}]}